{"ast":null,"code":"/*!\n    *\n    * Wijmo Library 5.20231.904\n    * http://wijmo.com/\n    *\n    * Copyright(c) GrapeCity, Inc.  All rights reserved.\n    *\n    * Licensed under the GrapeCity Commercial License.\n    * sales@wijmo.com\n    * wijmo.com/products/wijmo-5/license/\n    *\n    */\n\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n    var extendStatics = function (e, t) {\n      return (extendStatics = Object.setPrototypeOf || {\n        __proto__: []\n      } instanceof Array && function (e, t) {\n        e.__proto__ = t;\n      } || function (e, t) {\n        for (var l in t) t.hasOwnProperty(l) && (e[l] = t[l]);\n      })(e, t);\n    };\n    return function (e, t) {\n      extendStatics(e, t);\n      function __() {\n        this.constructor = e;\n      }\n      e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __());\n    };\n  }(),\n  __importStar = this && this.__importStar || function (e) {\n    if (e && e.__esModule) return e;\n    var t = {};\n    if (null != e) for (var l in e) Object.hasOwnProperty.call(e, l) && (t[l] = e[l]);\n    t.default = e;\n    return t;\n  };\nObject.defineProperty(exports, \"__esModule\", {\n  value: !0\n});\nvar wijmo_1 = require(\"wijmo/wijmo\"),\n  wjcCore = __importStar(require(\"wijmo/wijmo\")),\n  wjcGrid = __importStar(require(\"wijmo/wijmo.grid\")),\n  selfModule = __importStar(require(\"wijmo/wijmo.interop.grid\"));\nfunction softInput() {\n  return wijmo_1._getModule(\"wijmo.input\");\n}\nexports.softInput = softInput;\nfunction softGridDetail() {\n  return wijmo_1._getModule(\"wijmo.grid.detail\");\n}\nexports.softGridDetail = softGridDetail;\nvar __gridCFRef = wjcGrid && wjcGrid.CellFactory;\nif (!__gridCFRef) {\n  window.wijmo.grid = {};\n  window.wijmo.grid.CellFactory = function () {};\n}\nvar GridCellTemplateType,\n  DirectiveCellFactoryBase = function (e) {\n    __extends(DirectiveCellFactoryBase, e);\n    function DirectiveCellFactoryBase(t) {\n      var l = e.call(this) || this;\n      l._lastApplyTimeStamp = 0;\n      l._noApplyLag = !1;\n      l._startingEditing = !1;\n      l._cellStampCounter = 0;\n      l._composing = !1;\n      l._isCheckingHeight = !1;\n      l._backupHeight = -1;\n      l._cacheRow = null;\n      l.grid = t;\n      if (!DirectiveCellFactoryBase._templateTypes) {\n        DirectiveCellFactoryBase._templateTypes = [];\n        for (var i in GridCellTemplateType) isNaN(i) && DirectiveCellFactoryBase._templateTypes.push(i);\n      }\n      var r = l;\n      l._baseCf = t.cellFactory;\n      t.cellFactory = l;\n      l._evtInput = document.createEvent(\"HTMLEvents\");\n      l._evtInput.initEvent(\"input\", !0, !1);\n      l._evtBlur = document.createEvent(\"HTMLEvents\");\n      l._evtBlur.initEvent(\"blur\", !1, !1);\n      t.prepareCellForEdit.addHandler(function (e, t) {\n        r._noApplyLag = !0;\n      });\n      t.cellEditEnded.addHandler(function (e, l) {\n        var i = l.range,\n          o = i.col;\n        (o < 0 || o < t.columns.length && !t._getBindingColumn(t.cells, i.row, t.columns[o])[DirectiveCellFactoryBase.getTemplContextProp(GridCellTemplateType.CellEdit)]) && (r._editChar = null);\n        setTimeout(function () {\n          r._noApplyLag = !1;\n        }, 300);\n      });\n      t.beginningEdit.addHandler(function (e, t) {\n        r._startingEditing = !0;\n      });\n      t.hostElement.addEventListener(\"keydown\", function (e) {\n        r._startingEditing = !1;\n      }, !0);\n      t.hostElement.addEventListener(\"keypress\", function (e) {\n        var l = e.charCode > 32 ? String.fromCharCode(e.charCode) : null;\n        if (l && wjcCore.closest(e.target, \".wj-flexgrid\") === t.hostElement) if (!t.activeEditor || r._startingEditing) {\n          r._editChar = l;\n          setTimeout(function () {\n            t.activeEditor || (r._editChar = null);\n          }, 0);\n        } else r._editChar && (r._editChar += l);\n      }, !0);\n      t.hostElement.addEventListener(\"compositionstart\", function (e) {\n        r._composing = !0;\n      }, !0);\n      t.hostElement.addEventListener(\"compositionend\", function (e) {\n        r._composing = !1;\n      }, !0);\n      return l;\n    }\n    DirectiveCellFactoryBase.prototype.updateCell = function (e, t, l, i, r) {\n      var o = this;\n      this._cellStampCounter = (this._cellStampCounter + 1) % 1e7;\n      var n = i[DirectiveCellFactoryBase._cellStampProp] = this._cellStampCounter;\n      i.style.overflow && (i.style.overflow = \"\");\n      var a = t,\n        c = l;\n      if (r && !r.isSingleCell) {\n        t = r.row;\n        l = r.col;\n      }\n      var s,\n        p = this,\n        d = e.grid,\n        u = d.editRange,\n        C = e.rows[t],\n        m = C.dataItem,\n        f = !1,\n        _ = !1,\n        v = !1,\n        y = !1;\n      switch (e.cellType) {\n        case wjcGrid.CellType.Cell:\n          if (u && u.row === t && u.col === l) {\n            s = GridCellTemplateType.CellEdit;\n            _ = v = !0;\n          } else if (C instanceof wjcGrid.GroupRow) {\n            var g = !((y = m instanceof wjcCore.CollectionViewGroup) || C.hasChildren);\n            if (l == e.columns.firstVisibleIndex) s = g ? GridCellTemplateType.Cell : GridCellTemplateType.GroupHeader;else {\n              s = g ? GridCellTemplateType.Cell : GridCellTemplateType.Group;\n              _ = !0;\n            }\n          } else C instanceof wjcGrid._NewRowTemplate ? s = GridCellTemplateType.NewCellTemplate : softGridDetail() && softGridDetail().DetailRow && C instanceof softGridDetail().DetailRow || (s = GridCellTemplateType.Cell);\n          break;\n        case wjcGrid.CellType.ColumnHeader:\n          s = GridCellTemplateType.ColumnHeader;\n          break;\n        case wjcGrid.CellType.RowHeader:\n          s = d.collectionView && d.collectionView.currentEditItem === m ? GridCellTemplateType.RowHeaderEdit : GridCellTemplateType.RowHeader;\n          f = !0;\n          break;\n        case wjcGrid.CellType.TopLeft:\n          s = GridCellTemplateType.TopLeft;\n          f = !0;\n          break;\n        case wjcGrid.CellType.ColumnFooter:\n          s = GridCellTemplateType.ColumnFooter;\n          _ = !0;\n          break;\n        case wjcGrid.CellType.BottomLeft:\n          s = GridCellTemplateType.BottomLeft;\n          f = !0;\n      }\n      var h = !1;\n      if (null != s) {\n        var w = null;\n        y && s == GridCellTemplateType.GroupHeader ? w = d.getColumn(m.groupDescription.propertyName) : l >= 0 && l < e.columns.length && (w = e.cellType === wjcGrid.CellType.ColumnHeader && d._hasColumnGroups() ? d._getColumnGroup(t, l) : d._getBindingColumn(e, t, e.columns[l]));\n        if (w) {\n          var T = DirectiveCellFactoryBase.getTemplContextProp,\n            E = T(s),\n            F = (f ? d : w)[E];\n          if (!F) if (s === GridCellTemplateType.RowHeaderEdit) {\n            E = T(s = GridCellTemplateType.RowHeader);\n            F = d[E];\n          } else if ((s === GridCellTemplateType.Group || s === GridCellTemplateType.GroupHeader) && !y) {\n            E = T(s = GridCellTemplateType.Cell);\n            F = w[E];\n          }\n          if (F) {\n            var G;\n            _ && (G = e.getCellData(t, l, !1));\n            h = !0;\n            var j = i.getAttribute(wjcGrid.FlexGrid._WJS_MEASURE),\n              D = j && \"true\" === j.toLowerCase();\n            if (v) {\n              this.clearCell(i);\n              this._baseCf.updateCell(e, a, c, i, r, !0);\n            }\n            var B,\n              H = v && d.imeEnabled,\n              I = H && this._composing,\n              S = i[E],\n              b = {\n                cell: i,\n                column: w,\n                row: C,\n                panel: e,\n                rng: r,\n                isEdit: v,\n                isImeInput: H,\n                isTrueImeInput: I,\n                templateContext: F,\n                templateCache: S,\n                templateContextProperty: E,\n                cellStamp: n,\n                cellValue: G\n              };\n            if (this.shouldInstantiate(b)) {\n              if (v) {\n                var R = i.firstElementChild;\n                if (R) {\n                  H || i.focus();\n                  R.style.display = \"none\";\n                }\n              } else this.clearCell(i);\n              this._doDisposeCell(i);\n              this.renderTemplate(b, !0);\n              b.templateCache = S = i[E];\n              B = b.cellBindingsData;\n            } else {\n              this.renderTemplate(b, !1);\n              B = b.cellBindingsData;\n            }\n            F.cellOverflow && (i.style.overflow = F.cellOverflow);\n            D ? this.applyImmediately(b) : F.autoSizeRows && !H ? this.checkHeight(b) : v && setTimeout(function () {\n              H ? o._initImeEditInput(b.cell, F) : o._initEditInput(b.cell, F, null);\n            }, 0);\n            if (v) {\n              p._cellEditorVars = B.localVars;\n              var editEndingEH = function (e, t) {\n                  d.cellEditEnding.removeHandler(editEndingEH);\n                  if (!t.stayInEditMode) {\n                    var l = wjcCore.getActiveElement();\n                    l && l.dispatchEvent(p._evtBlur);\n                    wjcCore.contains(i, wjcCore.getActiveElement()) && i.focus();\n                  }\n                  p._triggerEditorEvents(i);\n                  if (!t.cancel && !t.stayInEditMode) for (var r = B.localVars, o = 0, n = Object.getOwnPropertyNames(B.bindings); o < n.length; o++) {\n                    var a = n[o];\n                    B.bindings[a].setValue(r, B.localVars.values[a]);\n                  }\n                  var c = i.querySelectorAll(\".wj-dropdown\");\n                  [].forEach.call(c, function (e) {\n                    var t = wjcCore.Control.getControl(e);\n                    t && softInput() && t instanceof softInput().DropDown && (t.isDroppedDown = !1);\n                  });\n                },\n                editEndedEH_1 = function (e, t) {\n                  d.cellEditEnded.removeHandler(editEndedEH_1);\n                  p._cellEditorVars = null;\n                };\n              d.cellEditEnding.addHandler(editEndingEH);\n              d.cellEditEnded.addHandler(editEndedEH_1);\n            } else this._baseCf.updateCell(e, a, c, i, r, !1);\n          }\n        }\n      }\n      if (!h) {\n        this._doDisposeCell(i);\n        this._baseCf.updateCell(e, a, c, i, r);\n      }\n    };\n    DirectiveCellFactoryBase.prototype.getEditorValue = function (t) {\n      if (this._cellEditorVars) {\n        var l = t.editRange;\n        l && l.isValid && this._triggerEditorEvents(t.cells.getCellElement(l.row, l.col));\n        return this._cellEditorVars.value;\n      }\n      return e.prototype.getEditorValue.call(this, t);\n    };\n    DirectiveCellFactoryBase.prototype.disposeCell = function (e) {\n      this._doDisposeCell(e);\n    };\n    DirectiveCellFactoryBase.prototype.disposeTemplate = function (e, t, l) {\n      if (t) {\n        t.rootElement = null;\n        t.column = null;\n        e[t.templateContextProperty] = null;\n        t.templateContextProperty = null;\n      }\n    };\n    DirectiveCellFactoryBase.prototype.setBindingsData = function (e, t, l, i, r, o) {\n      e.row = t;\n      e.col = l;\n      e.item = i;\n      var n = {},\n        a = e.cell || {},\n        c = {},\n        s = {\n          localVars: a,\n          bindings: c\n        };\n      a.row = t;\n      a.col = l;\n      a.item = i;\n      a.value = r;\n      a.values = n;\n      if (o) for (var p = 0, d = Object.getOwnPropertyNames(o); p < d.length; p++) {\n        var u = d[p],\n          C = new wjcCore.Binding(o[u]);\n        c[u] = C;\n        n[u] = C.getValue(a);\n      }\n      e.cell !== a && (e.cell = a);\n      return s;\n    };\n    DirectiveCellFactoryBase.prototype.checkHeight = function (e) {\n      var t = this;\n      this._isCheckingHeight || setTimeout(function () {\n        var l = e.cell;\n        if (e.cellStamp === l[DirectiveCellFactoryBase._cellStampProp]) {\n          var i = l.scrollHeight,\n            r = e.panel.rows,\n            o = e.row.index,\n            n = e.rng,\n            a = n && n.rowSpan || 1,\n            c = e.isEdit;\n          null != r.maxSize && (i = Math.min(i, r.maxSize));\n          if (o < r.length && r[o].renderHeight * a < i - 1) {\n            var s = r.defaultSize = i / a;\n            if (c) {\n              var p = t._isFullEdit(),\n                d = t.grid;\n              t._backupHeight = e.row.height;\n              e.row.height = s;\n              t._cacheRow = e.row;\n              t._isCheckingHeight = !0;\n              d.refresh();\n              d.startEditing(p);\n              t._isCheckingHeight = !1;\n              return;\n            }\n          } else c && (e.isImeInput ? t._initImeEditInput(e.cell, e.templateContext) : t._initEditInput(e.cell, e.templateContext, null));\n        }\n      }, 0);\n    };\n    DirectiveCellFactoryBase.prototype._restoreRowHeight = function () {\n      if (!this._isCheckingHeight && this._backupHeight > 0) {\n        this._cacheRow.height = this._backupHeight;\n        this._backupHeight = -1;\n        this._cacheRow = null;\n      }\n    };\n    DirectiveCellFactoryBase.prototype.doDisposeCell = function (e) {\n      for (var t = DirectiveCellFactoryBase._templateTypes, l = 0; l < t.length; l++) {\n        var i = DirectiveCellFactoryBase.getTemplContextProp(GridCellTemplateType[t[l]]),\n          r = e[i];\n        if (r) {\n          var o = (r.column || this.grid)[i];\n          this.disposeTemplate(e, r, o);\n          t[l] == GridCellTemplateType[GridCellTemplateType.CellEdit] && this._restoreRowHeight();\n        }\n      }\n    };\n    DirectiveCellFactoryBase.getTemplContextProp = function (e) {\n      return \"$__cellTempl\" + GridCellTemplateType[e];\n    };\n    DirectiveCellFactoryBase.prototype._doDisposeCell = function (e) {\n      this.doDisposeCell(e);\n    };\n    DirectiveCellFactoryBase.prototype._initEditInput = function (e, t, l) {\n      var i = this;\n      this.setEditorFocusFlag(!0);\n      var r = !1 !== this.getEditorFocusFlag();\n      this.setEditorFocusFlag(null);\n      this._setFullEdit(t);\n      r && setTimeout(function () {\n        var t = i._findInitialInput(e);\n        if (t) {\n          var inpFocusEh = function () {\n            t.removeEventListener(\"focus\", inpFocusEh);\n            setTimeout(function () {\n              setTimeout(function () {\n                var e = null != l ? l : i._editChar;\n                if (e) {\n                  t.value = e;\n                  i._editChar = null;\n                  DirectiveCellFactoryBase._setSelectionRange(t, e.length, e.length);\n                  t.dispatchEvent(i._evtInput);\n                }\n              }, 0);\n            }, DirectiveCellFactoryBase._FOCUS_INTERVAL);\n          };\n          t.addEventListener(\"focus\", inpFocusEh);\n          t.focus();\n        }\n      }, 100);\n    };\n    DirectiveCellFactoryBase.prototype._initImeEditInput = function (e, t) {\n      var l = this,\n        i = wjcCore.getActiveElement();\n      if (i && (i instanceof HTMLInputElement || i instanceof HTMLTextAreaElement) && wjcCore.hasClass(i, \"wj-grid-ime\")) {\n        var r = this._findInitialInput(e),\n          o = r && r.style.color,\n          n = this._composing,\n          compEndEh_1 = function () {\n            i.removeEventListener(\"compositionend\", compEndEh_1);\n            wjcCore.setCss(i, wjcGrid._ImeHandler._cssHidden);\n            l.setEditorFocusFlag(!0);\n            r && (r.style.color = o);\n            l._initEditInput(e, t, n ? i.value : null);\n          };\n        if (n) {\n          i.addEventListener(\"compositionend\", compEndEh_1);\n          if (r) {\n            var a = r.getBoundingClientRect(),\n              c = i.getBoundingClientRect(),\n              s = window.getComputedStyle(i),\n              p = parseFloat(s.left),\n              d = parseFloat(s.top);\n            wjcCore.setCss(i, {\n              left: p + a.left - c.left + \"px\",\n              top: d + a.top - c.top + \"px\",\n              width: a.width + \"px\",\n              height: a.height + \"px\"\n            });\n            r.style.color = \"transparent\";\n          }\n        } else setTimeout(function () {\n          return compEndEh_1();\n        }, DirectiveCellFactoryBase._FOCUS_INTERVAL);\n      }\n    };\n    DirectiveCellFactoryBase.prototype._findInitialInput = function (e) {\n      var t = e && e.rootElement && e.rootElement.querySelectorAll(\"input,textarea\") || e && e.querySelectorAll(\"input,textarea\");\n      if (t) for (var l = 0; l < t.length; l++) {\n        var i = t[l],\n          r = window.getComputedStyle(i);\n        if (\"none\" !== r.display && \"visible\" === r.visibility) return i;\n      }\n      return null;\n    };\n    DirectiveCellFactoryBase._setSelectionRange = function (e, t, l) {\n      void 0 === l && (l = t);\n      if (wjcCore.contains(document.body, e) && !e.disabled && \"none\" != e.style.display) try {\n        e.setSelectionRange(wjcCore.asNumber(t), wjcCore.asNumber(l), wjcCore.isIE() ? null : \"backward\");\n        e.focus();\n      } catch (e) {}\n    };\n    DirectiveCellFactoryBase.prototype._triggerEditorEvents = function (e) {\n      if (e) for (var t = e.querySelectorAll(\".wj-control\"), l = 0; l < t.length; l++) {\n        var i = t[l],\n          r = wjcCore.Control.getControl(i);\n        r && this.flushPendingEvents(r);\n      }\n    };\n    DirectiveCellFactoryBase.prototype._isFullEdit = function () {\n      var e = this.grid;\n      return !e.activeEditor || e._edtHdl._fullEdit;\n    };\n    DirectiveCellFactoryBase.prototype._setFullEdit = function (e) {\n      var t = this.grid;\n      e.forceFullEdit && t.activeEditor && (t._edtHdl._fullEdit = !0);\n    };\n    DirectiveCellFactoryBase._cellStampProp = \"__wjCellStamp\";\n    DirectiveCellFactoryBase._FOCUS_INTERVAL = wjcCore.Control._FOCUS_INTERVAL + 20;\n    return DirectiveCellFactoryBase;\n  }(wjcGrid.CellFactory);\nexports.DirectiveCellFactoryBase = DirectiveCellFactoryBase;\n__gridCFRef || (window.wijmo.grid = null);\n!function (e) {\n  e[e.Cell = 0] = \"Cell\";\n  e[e.CellEdit = 1] = \"CellEdit\";\n  e[e.ColumnHeader = 2] = \"ColumnHeader\";\n  e[e.RowHeader = 3] = \"RowHeader\";\n  e[e.RowHeaderEdit = 4] = \"RowHeaderEdit\";\n  e[e.TopLeft = 5] = \"TopLeft\";\n  e[e.GroupHeader = 6] = \"GroupHeader\";\n  e[e.Group = 7] = \"Group\";\n  e[e.NewCellTemplate = 8] = \"NewCellTemplate\";\n  e[e.ColumnFooter = 9] = \"ColumnFooter\";\n  e[e.BottomLeft = 10] = \"BottomLeft\";\n}(GridCellTemplateType = exports.GridCellTemplateType || (exports.GridCellTemplateType = {}));\nwijmo_1._registerModule(\"wijmo.interop.grid\", selfModule);","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}