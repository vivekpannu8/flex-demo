{"ast":null,"code":"/*!\n    *\n    * Wijmo Library 5.20231.904\n    * http://wijmo.com/\n    *\n    * Copyright(c) GrapeCity, Inc.  All rights reserved.\n    *\n    * Licensed under the GrapeCity Commercial License.\n    * sales@wijmo.com\n    * wijmo.com/products/wijmo-5/license/\n    *\n    */\n\nvar _a,\n  __extends = this && this.__extends || function () {\n    var extendStatics = function (e, t) {\n      return (extendStatics = Object.setPrototypeOf || {\n        __proto__: []\n      } instanceof Array && function (e, t) {\n        e.__proto__ = t;\n      } || function (e, t) {\n        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i]);\n      })(e, t);\n    };\n    return function (e, t) {\n      extendStatics(e, t);\n      function __() {\n        this.constructor = e;\n      }\n      e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __());\n    };\n  }();\nimport { isInt, asInt, _addCultureInfo, tryCast, format, Size, CancelEventArgs, asType, asBoolean, isFunction, Key, _getModule, asArray, assert, copy, isArray, isNumber, isString, toHeaderCase, NotifyCollectionChangedEventArgs, ObservableArray, Point, mouseToPage, closest, Control, SortDescription, isSafari, isIE, isIE9, closestClass, addClass, removeClass, setCss, getActiveElement, removeChild, createElement, setAttribute, _startDrag, clamp, hasClass, Event, EventArgs, _MaskProvider, asString, asCollectionView, toPlainText, _Map, asFunction, culture, Globalize, escapeHtml, isBoolean, toggleClass, contains, setChecked, setAriaLabel, disableAutoComplete, evalTemplate, DataType, isiOS, setSelectionRange, isUndefined, asNumber, asEnum, getType, _deprecated, Aggregate, Binding, CollectionViewGroup, uidGenerator, changeType, isFirefox, DateTime, Rect, CollectionView, NotifyCollectionChangedAction, getAggregate, isDate, showPopup, hidePopup, isEdge, Clipboard, Tooltip, isPrimitive, enable, setText, getTypes, hasItems, getElementRect, supportsFocusOptions, isIE10, isMobile, _registerModule } from \"@grapecity/wijmo\";\nimport { MultiSelect } from \"@grapecity/wijmo.input\";\nimport * as mInput from \"@grapecity/wijmo.input\";\nimport * as selfModule from \"@grapecity/wijmo.grid\";\nvar _safariVer = null;\nexport function _getSafariVer() {\n  return _safariVer;\n}\nif (isSafari()) {\n  var match = navigator.userAgent.match(/version\\/([\\d\\.]+)/i);\n  if (null != match) {\n    var version = match[1],\n      parts = (match = version.match(/(\\d+)/g)).map(function (e) {\n        return parseInt(e);\n      });\n    _safariVer = {\n      full: version,\n      major: parts[0],\n      minor: parts[1]\n    };\n  }\n}\nexport var DataMapEditor;\n!function (e) {\n  e[e.AutoComplete = 0] = \"AutoComplete\";\n  e[e.DropDownList = 1] = \"DropDownList\";\n  e[e.RadioButtons = 2] = \"RadioButtons\";\n}(DataMapEditor || (DataMapEditor = {}));\nvar DataMap = function () {\n  function DataMap(e, t, i) {\n    this._keyPath = \"\";\n    this._displayPath = \"\";\n    this._sortByVal = !0;\n    this._editable = !1;\n    this._serK = !0;\n    this.mapChanged = new Event();\n    if (isArray(e) && !t && !i) {\n      e = e.map(function (e) {\n        return {\n          value: e\n        };\n      });\n      t = i = \"value\";\n    }\n    this._cv = asCollectionView(e);\n    this._keyPath = asString(t, !1);\n    this._displayPath = asString(i, !1);\n    this._cv.collectionChanged.addHandler(this.onMapChanged, this);\n  }\n  Object.defineProperty(DataMap.prototype, \"sortByDisplayValues\", {\n    get: function () {\n      return this._sortByVal;\n    },\n    set: function (e) {\n      this._sortByVal = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(DataMap.prototype, \"serializeKeys\", {\n    get: function () {\n      return this._serK;\n    },\n    set: function (e) {\n      if ((e = asBoolean(e)) !== this._serK) {\n        var t = this._map,\n          i = t && t.size;\n        this._map = null;\n        this._serK = e;\n        i && this.onMapChanged(EventArgs.empty);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(DataMap.prototype, \"collectionView\", {\n    get: function () {\n      return this._cv;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(DataMap.prototype, \"selectedValuePath\", {\n    get: function () {\n      return this._keyPath;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(DataMap.prototype, \"displayMemberPath\", {\n    get: function () {\n      return this._displayPath;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  DataMap.prototype.getDataItem = function (e) {\n    var t = this;\n    if (!this._map) {\n      var i = this._cv.sourceCollection,\n        o = new _Map(this.serializeKeys);\n      isArray(i) && this._keyPath && i.forEach(function (e) {\n        var i = e[t._keyPath];\n        o.has(i) || o.set(i, e);\n      });\n      this._map = o;\n    }\n    return this._map.get(e);\n  };\n  DataMap.prototype.getDisplayValue = function (e) {\n    var t = this._displayPath,\n      i = this.getDataItem(e);\n    return t && i ? i[t] : e;\n  };\n  DataMap.prototype.getKeyValue = function (e, t) {\n    var i = this._displayPath,\n      o = this._indexOf(e, i, t, !0);\n    o < 0 && (o = this._indexOf(e, i, t, !1));\n    return o > -1 ? this._cv.sourceCollection[o][this._keyPath] : null;\n  };\n  DataMap.prototype.getDisplayValues = function (e) {\n    var t = this;\n    return this._cv && this._displayPath ? this._cv.items.map(function (e) {\n      return e[t._displayPath];\n    }) : [];\n  };\n  DataMap.prototype.getKeyValues = function () {\n    var e = this;\n    return this._cv && this._keyPath ? this._cv.items.map(function (t) {\n      return t[e._keyPath];\n    }) : [];\n  };\n  Object.defineProperty(DataMap.prototype, \"isEditable\", {\n    get: function () {\n      return this._editable;\n    },\n    set: function (e) {\n      this._editable = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(DataMap.prototype, \"search\", {\n    get: function () {\n      return this._search;\n    },\n    set: function (e) {\n      e && (this._search = asFunction(e));\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  DataMap.prototype.onMapChanged = function (e) {\n    this._map = null;\n    this.mapChanged.raise(this, e);\n  };\n  DataMap.prototype._indexOf = function (e, t, i, o) {\n    var n = -1,\n      l = -1;\n    if (this._cv && t) {\n      var r = null != e ? e.toString() : \"\";\n      r && i && (e = toPlainText(r));\n      for (var s = o ? r : r.toLowerCase(), a = this._cv.sourceCollection, u = 0; u < a.length; u++) {\n        var c = a[u],\n          d = c[t];\n        null != d && null != d || (d = \"\");\n        i && isString(d) && (d = toPlainText(d));\n        d == e ? n = u : o || d.length != s.length || d.toLowerCase() != s ? null != d && d.toString() == r && (n = u) : n = u;\n        if (n == u) {\n          if (!this._cv.filter || this._cv.filter(c)) return n;\n          l < 0 && (l = n);\n        }\n      }\n    }\n    return l;\n  };\n  return DataMap;\n}();\nexport { DataMap };\nvar CellRange = function () {\n  function CellRange(e, t, i, o) {\n    void 0 === e && (e = -1);\n    void 0 === t && (t = -1);\n    void 0 === i && (i = e);\n    void 0 === o && (o = t);\n    this.setRange(e, t, i, o);\n  }\n  CellRange.prototype.setRange = function (e, t, i, o) {\n    void 0 === e && (e = -1);\n    void 0 === t && (t = -1);\n    void 0 === i && (i = e);\n    void 0 === o && (o = t);\n    this._row = asInt(e);\n    this._col = asInt(t);\n    this._row2 = asInt(i);\n    this._col2 = asInt(o);\n  };\n  Object.defineProperty(CellRange.prototype, \"row\", {\n    get: function () {\n      return this._row;\n    },\n    set: function (e) {\n      this._row = asInt(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"col\", {\n    get: function () {\n      return this._col;\n    },\n    set: function (e) {\n      this._col = asInt(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"row2\", {\n    get: function () {\n      return this._row2;\n    },\n    set: function (e) {\n      this._row2 = asInt(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"col2\", {\n    get: function () {\n      return this._col2;\n    },\n    set: function (e) {\n      this._col2 = asInt(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  CellRange.prototype.clone = function () {\n    return new CellRange(this._row, this._col, this._row2, this._col2);\n  };\n  CellRange.prototype.copy = function (e) {\n    this.setRange(e._row, e._col, e._row2, e._col2);\n  };\n  Object.defineProperty(CellRange.prototype, \"rowSpan\", {\n    get: function () {\n      return Math.abs(this._row2 - this._row) + 1;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"columnSpan\", {\n    get: function () {\n      return Math.abs(this._col2 - this._col) + 1;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"topRow\", {\n    get: function () {\n      return Math.min(this._row, this._row2);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"bottomRow\", {\n    get: function () {\n      return Math.max(this._row, this._row2);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"leftCol\", {\n    get: function () {\n      return Math.min(this._col, this._col2);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"rightCol\", {\n    get: function () {\n      return Math.max(this._col, this._col2);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"isValid\", {\n    get: function () {\n      return this._row > -1 && this._col > -1 && this._row2 > -1 && this._col2 > -1;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRange.prototype, \"isSingleCell\", {\n    get: function () {\n      return this._row == this._row2 && this._col == this._col2;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  CellRange.prototype.contains = function (e, t) {\n    var i = tryCast(e, CellRange);\n    if (i) return i.topRow >= this.topRow && i.bottomRow <= this.bottomRow && i.leftCol >= this.leftCol && i.rightCol <= this.rightCol;\n    if (isInt(e) && isInt(t)) return e >= this.topRow && e <= this.bottomRow && t >= this.leftCol && t <= this.rightCol;\n    throw \"contains expects a CellRange or row/column indices.\";\n  };\n  CellRange.prototype.containsRow = function (e) {\n    return asInt(e) >= this.topRow && e <= this.bottomRow;\n  };\n  CellRange.prototype.containsColumn = function (e) {\n    return asInt(e) >= this.leftCol && e <= this.rightCol;\n  };\n  CellRange.prototype.intersects = function (e) {\n    return this.intersectsRow(e) && this.intersectsColumn(e);\n  };\n  CellRange.prototype.intersectsRow = function (e) {\n    return e && !(this.bottomRow < e.topRow || this.topRow > e.bottomRow);\n  };\n  CellRange.prototype.intersectsColumn = function (e) {\n    return e && !(this.rightCol < e.leftCol || this.leftCol > e.rightCol);\n  };\n  CellRange.prototype.getRenderSize = function (e) {\n    var t = new Size(0, 0);\n    if (this.isValid) {\n      for (var i = this.topRow; i <= this.bottomRow; i++) e.rows[i] && (t.height += e.rows[i].renderSize);\n      for (var o = this.leftCol; o <= this.rightCol; o++) e.columns[o] && (t.width += e.columns[o].renderSize);\n    }\n    return t;\n  };\n  CellRange.prototype.equals = function (e) {\n    return e instanceof CellRange && this._row == e._row && this._col == e._col && this._row2 == e._row2 && this._col2 == e._col2;\n  };\n  CellRange.prototype.combine = function (e) {\n    return e ? new CellRange(Math.min(this.topRow, e.topRow), Math.min(this.leftCol, e.leftCol), Math.max(this.bottomRow, e.bottomRow), Math.max(this.rightCol, e.rightCol)) : this;\n  };\n  CellRange.prototype.toString = function () {\n    return format(\"({row}, {col})-({row2}, {col2})\", this);\n  };\n  return CellRange;\n}();\nexport { CellRange };\nexport var CellType;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Cell = 1] = \"Cell\";\n  e[e.ColumnHeader = 2] = \"ColumnHeader\";\n  e[e.RowHeader = 3] = \"RowHeader\";\n  e[e.TopLeft = 4] = \"TopLeft\";\n  e[e.ColumnFooter = 5] = \"ColumnFooter\";\n  e[e.BottomLeft = 6] = \"BottomLeft\";\n}(CellType || (CellType = {}));\nvar GridPanel = function () {\n  function GridPanel(e, t, i, o, n) {\n    this._offsetY = 0;\n    this._rng = new CellRange();\n    this._g = asType(e, FlexGrid);\n    this._ct = asInt(t);\n    this._rows = asType(i, RowCollection);\n    this._cols = asType(o, ColumnCollection);\n    this._e = asType(n, HTMLElement);\n    this._vrb = new CellRange();\n    this._uid = uidGenerator();\n  }\n  Object.defineProperty(GridPanel.prototype, \"grid\", {\n    get: function () {\n      return this._g;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"cellType\", {\n    get: function () {\n      return this._ct;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"viewRange\", {\n    get: function () {\n      return this._getViewRange();\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"width\", {\n    get: function () {\n      return this._cols.getTotalSize();\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"height\", {\n    get: function () {\n      return this._rows.getTotalSize();\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"rows\", {\n    get: function () {\n      return this._rows;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GridPanel.prototype, \"columns\", {\n    get: function () {\n      return this._cols;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  GridPanel.prototype.getCellData = function (e, t, i) {\n    var o,\n      n = this._g,\n      l = this._rows[asNumber(e, !1, !0)],\n      r = null;\n    if (!l) return null;\n    t = this._toIndex(t);\n    o = this._cols[asNumber(t, !1, !0)];\n    var s = n ? n._getBindingColumn(this, e, o) : o,\n      a = null;\n    l instanceof GroupRow && l.dataItem instanceof CollectionViewGroup && !n.childItemsPath && (a = l.dataItem);\n    s.binding && l.dataItem && !a ? r = s._binding.getValue(l.dataItem) : l._ubv && (r = l._ubv[o._hash]);\n    if (null == r) {\n      var u = CellType;\n      switch (this._ct) {\n        case u.TopLeft:\n        case u.ColumnHeader:\n          e != this._rows.length - 1 && s == o || (r = s.header);\n          break;\n        case u.ColumnFooter:\n          if (l instanceof GroupRow && s.aggregate != Aggregate.None) {\n            var c = this._g.collectionView;\n            if (c) {\n              var d = tryCast(c, CollectionView);\n              r = d ? d.getAggregate(s.aggregate, s.binding) : getAggregate(s.aggregate, c.items, s.binding);\n            }\n          }\n          break;\n        case u.Cell:\n          l instanceof GroupRow && (t == this._cols.firstVisibleIndex ? r = l.getGroupHeader() : a && s.aggregate != Aggregate.None && (r = a.getAggregate(s.aggregate, s.binding, this._g.collectionView, this._g)));\n      }\n    }\n    if (i) {\n      var h = s.dataMap || l.dataMap;\n      if (this.cellType == CellType.Cell && s._edt && s._edt._ctl instanceof MultiSelect && r) {\n        var p = new Binding(s._edt._ctl.displayMemberPath),\n          f = p ? r.map(function (e) {\n            return p.getValue(e);\n          }) : r;\n        if (f.length > 0) if (f.length <= s._edt._ctl.maxHeaderItems) {\n          var g = f.join(\", \");\n          r = format(g || culture.MultiSelect.itemsSelected, {\n            count: f.length\n          });\n        } else r = format(s._edt._ctl.headerFormat || culture.MultiSelect.itemsSelected, {\n          count: f.length\n        });\n      } else this.cellType == CellType.Cell && h && (r = h.getDisplayValue(r));\n      r = null != r ? Globalize.format(r, s.format || l.format) : \"\";\n    }\n    return r;\n  };\n  GridPanel.prototype.setCellData = function (e, t, i, o, n, l) {\n    void 0 === o && (o = !0);\n    void 0 === n && (n = !0);\n    void 0 === l && (l = !1);\n    var r = this._g,\n      s = this._rows[asNumber(e, !1, !0)],\n      a = this._cols[asNumber(this._toIndex(t), !1, !0)],\n      u = DataType;\n    if (!s) return !1;\n    var c = r ? r._getBindingColumn(this, e, a) : a,\n      d = c.dataMap || s.dataMap;\n    if (this._ct == CellType.Cell) {\n      var h = c.getIsRequired(s),\n        p = c.isContentHtml || s.isContentHtml;\n      if (!l && d && null != i) {\n        var f = d.getKeyValue(i, p);\n        if (null == f && null == d.getDisplayValue(null)) {\n          if (d.getDisplayValue(i) != i) ;else if (!d.isEditable || d.displayMemberPath != d.selectedValuePath) {\n            if (\"\" != i || h || !r.commitEmptyEdits) return !1;\n            i = null;\n          }\n        } else i = f;\n      }\n      var g = u.Object,\n        _ = c.dataType || s.dataType,\n        m = this.getCellData(e, t, !1);\n      g = _ || getType(m);\n      if (null == i || \"\" === i && o && !d) {\n        if (h || !r.commitEmptyEdits && (null == m || \"\" === m)) return !1;\n        g != u.String && (i = null);\n        o = !1;\n      }\n      if (\"NaN\" == i && Number.isNaN(m) && !r.commitEmptyEdits) return !1;\n      if (o) {\n        var C = c.format || s.format;\n        C || g != u.Date || (C = \"d\");\n        c.mask && isString(i) && g != u.String && (i = i.replace(/_/g, \"\"));\n        i = changeType(i, g, C, m);\n        if (g != u.Object && getType(i) != g) return !1;\n      }\n    }\n    if (s.dataItem && c.binding) {\n      var w = c._binding,\n        v = s.dataItem,\n        y = w.getValue(v);\n      if (i !== y && (d && !d.serializeKeys || !DateTime.equals(i, y))) {\n        var b = r.collectionView,\n          R = b instanceof CollectionView && v != b.currentEditItem && b.trackChanges,\n          E = null;\n        R && (E = b._extend({}, v));\n        w.setValue(v, i);\n        if (R) {\n          var x = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change, v, b.items.indexOf(v));\n          b.onCollectionChanged(x);\n          b._trackItemChanged(v, E);\n        }\n      }\n    } else {\n      s._ubv || (s._ubv = {});\n      s._ubv[a._hash] = i;\n    }\n    n && r && r.invalidate();\n    return !0;\n  };\n  GridPanel.prototype.getCellBoundingRect = function (e, t, i) {\n    var o = this._g,\n      n = this.rows[e],\n      l = this.columns[this._toIndex(t)],\n      r = new Rect(l.pos, n.pos, l.renderSize, n.renderSize);\n    if (o.rightToLeft) {\n      r.left = this.hostElement.clientWidth - r.right;\n      isIE() || (r.left -= o._root.offsetWidth - o._root.clientWidth);\n    }\n    if (!i) {\n      var s = this.hostElement.getBoundingClientRect();\n      r.left += s.left;\n      r.top += s.top - this._offsetY;\n    }\n    e < this.rows.frozen && (r.top -= o.scrollPosition.y);\n    Number(t) < Number(this.columns.frozen) && (r.left -= o.scrollPosition.x * (o.rightToLeft ? -1 : 1));\n    return r;\n  };\n  GridPanel.prototype.getCellElement = function (e, t) {\n    var i = this.hostElement.children,\n      o = Math.min(e + 2, i.length);\n    t = this._toIndex(t);\n    for (var n = 0; n < o; n++) for (var l = i[n].children, r = Math.min(t + 2, l.length), s = 0; s < r; s++) {\n      var a = l[s],\n        u = a[GridPanel._INDEX_KEY];\n      if (u && (u.row == e && u.col == t || u.rng && u.rng.contains(e, t))) return a;\n    }\n    return null;\n  };\n  GridPanel.prototype.getSelectedState = function (e, t, i) {\n    var o = this._g,\n      n = o.selectionMode,\n      l = o._selHdl.selection,\n      r = SelectionMode,\n      s = SelectedState;\n    if (n == r.None) return s.None;\n    t = this._toIndex(t);\n    switch (this._ct) {\n      case CellType.Cell:\n        i || (i = o.getMergedRange(this, e, t));\n        var a = o._getAnchorCell();\n        if (i) {\n          if (i.contains(l.row, l.col)) {\n            if (!o.anchorCursor || null == a) return o.showMarquee ? s.Active : s.Cursor;\n            if (e == a.y && t == a.x || i.row == a.y && i.col == a.x) return o.showMarquee ? s.Active : s.Cursor;\n          }\n          if (i.intersects(l) && o.anchorCursor && null != a && (e == a.y && t == a.x || i.row == a.y && i.col == a.x)) return o.showMarquee ? s.Active : s.Cursor;\n          if (i.intersects(l) && n != r.ListBox) return s.Selected;\n          for (var u = i.leftCol; u <= i.rightCol; u++) if (o.columns[u] && o.columns[u].isSelected) return s.Selected;\n          for (var c = i.topRow; c <= i.bottomRow; c++) if (o.rows[c].isSelected) return s.Selected;\n        }\n        if (o.anchorCursor && null != a) {\n          if (e == a.y && t == a.x) return o.showMarquee ? s.Active : s.Cursor;\n        } else if (l.row == e && l.col == t) return o.showMarquee ? s.Active : s.Cursor;\n        if (o.rows[e].isSelected || o.columns[t].isSelected) return s.Selected;\n        if (n == r.MultiRange) for (var d = o._selHdl.extendedSelection, h = 0; h < d.length; h++) if (d[h].contains(e, t) || i && i.intersects(d[h])) return s.Selected;\n        if (i) switch (n) {\n          case r.Row:\n          case r.RowRange:\n            if (i.containsRow(l.row)) return s.Selected;\n        }\n        return n == r.ListBox ? s.None : (l = this._getAdjustedSelection(l)).containsRow(e) && l.containsColumn(t) ? s.Selected : s.None;\n      case CellType.ColumnHeader:\n        if (o.showSelectedHeaders & HeadersVisibility.Column && (o.columns[t].isSelected || l.containsColumn(t) || l.intersectsColumn(i))) {\n          i && (e = i.bottomRow);\n          if (e == this.rows.length - 1) return s.Selected;\n        }\n        break;\n      case CellType.RowHeader:\n        if (o.showSelectedHeaders & HeadersVisibility.Row && (o.rows[e].isSelected || l.containsRow(e) || l.intersectsRow(i))) {\n          i && (t = i.rightCol);\n          if (t == this.columns.length - 1) return s.Selected;\n        }\n    }\n    return s.None;\n  };\n  Object.defineProperty(GridPanel.prototype, \"hostElement\", {\n    get: function () {\n      return this._e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  GridPanel.prototype._toIndex = function (e) {\n    if (isString(e) && (e = this._cols.indexOf(e)) < 0) throw \"Invalid column name or binding.\";\n    return e;\n  };\n  GridPanel.prototype._getAdjustedSelection = function (e) {\n    var t = this._g,\n      i = this._rng,\n      o = SelectionMode;\n    switch (t.selectionMode) {\n      case o.Cell:\n        i.setRange(e.row, e.col, e.row, e.col);\n        break;\n      case o.Row:\n        i.setRange(e.row, 0, e.row, t.columns.length - 1);\n        break;\n      case o.RowRange:\n      case o.ListBox:\n        i.setRange(e.row, 0, e.row2, t.columns.length - 1);\n        break;\n      default:\n        i.copy(e);\n    }\n    return i;\n  };\n  GridPanel.prototype._getOffsetY = function () {\n    return this._offsetY;\n  };\n  GridPanel.prototype._updateContent = function (e, t, i) {\n    var o = this._g,\n      n = this._e,\n      l = this._rows,\n      r = this._cols,\n      s = this._ct;\n    if (s == CellType.ColumnHeader || s == CellType.ColumnFooter || s == CellType.RowHeader) {\n      var a = o._ptScrl,\n        u = n.style;\n      s == CellType.RowHeader ? u.top = a.y + \"px\" : o.rightToLeft ? u.right = a.x + \"px\" : u.left = a.x + \"px\";\n    }\n    if (this._offsetY != i) {\n      e = !1;\n      this._offsetY = i;\n    }\n    var c = this._getViewRange(),\n      d = c;\n    if (d.isValid) {\n      var h = l.length <= o._vtRows ? l.length : 0,\n        p = r.length <= o._vtCols ? r.length : 0;\n      d = new CellRange(Math.max(c.row - h, l.frozen), Math.max(c.col - p, r.frozen), Math.min(c.row2 + h, l.length - 1), Math.min(c.col2 + p, r.length - 1));\n    }\n    if (e && !t && this._vrb.contains(c) && !l.frozen && !r.frozen) return this._activeCell;\n    e && d.equals(this._vrb) || (t = !1);\n    e && !t && this._ct != CellType.TopLeft && this._reorderCells(d, this._vrb);\n    this._activeCell = null;\n    this._vru = c;\n    this._vrb = d;\n    this._recycle = e;\n    var f = 0;\n    this._ct != CellType.Cell || [HeadersFocusability.All, HeadersFocusability.Column].includes(this._g.headersFocusability) || (f = this._renderColHdrRow(d, t));\n    this._updateCells(t, f);\n    return this._activeCell;\n  };\n  GridPanel.prototype._updateCells = function (e, t) {\n    this._e;\n    for (var i = this._rows, o = 0; o < i.frozen && o < i.length; o++) t = this._renderRow(o, this._vrb, e, t);\n    for (o = this._vrb.topRow; o <= this._vrb.bottomRow && o > -1; o++) t = this._renderRow(o, this._vrb, e, t);\n    this._scanAndRemoveExtraCells(t);\n  };\n  GridPanel.prototype._scanAndRemoveExtraCells = function (e) {\n    for (var t = this._e; t.childElementCount > e;) {\n      var i = t.lastElementChild;\n      removeChild(i);\n      this._removeExtraCells(i, 0);\n    }\n  };\n  GridPanel.prototype._clearCells = function () {\n    for (var e = this.hostElement, t = this._g.cellFactory, i = e.childElementCount - 1; i >= 0; i--) {\n      var o = e.children[i];\n      removeChild(o);\n      for (var n = o.childElementCount - 1; n >= 0; n--) t.disposeCell(o.children[n]);\n    }\n  };\n  GridPanel.prototype._reorderCells = function (e, t) {\n    var i = this;\n    if (this._g._reorderCells && t.isValid && e.isValid && e.intersects(t)) {\n      var relocateForScrollToBeginning = function (e, t, o, n, l, r) {\n        assert(o < 0, \"Scroll delta must be a negative number\");\n        var s,\n          a,\n          u = -o,\n          c = t + (n - l + 1),\n          d = e.childElementCount - c;\n        if (d < u && d > 0) {\n          s = d;\n          a = u - d;\n        } else {\n          s = u;\n          a = 0;\n        }\n        if (s > 0) {\n          var h = i._createRange(e, c, c + s);\n          h && e.insertBefore(h.extractContents(), e.children[t]);\n        }\n        if (a > 0) for (var p = e.children[t], f = 0; f < a; f++) {\n          var g = document.createElement(\"div\");\n          g.className = r;\n          e.insertBefore(g, p);\n        }\n      };\n      if (e.row != t.row) {\n        var o = this._e;\n        if (0 != (a = e.row - t.row)) {\n          var n = this._ct == CellType.Cell ? 1 : 0,\n            l = o.childElementCount;\n          n += this.rows.frozen;\n          if (a > 0) {\n            var r = n,\n              s = Math.min(n + a, l);\n            (d = this._createRange(o, r, s)) && o.appendChild(d.extractContents());\n          } else relocateForScrollToBeginning(o, n, a, e.row2, t.row, \"wj-row\");\n        }\n      }\n      if (e.col != t.col) {\n        var a;\n        o = this._e;\n        if (0 != (a = e.col - t.col)) {\n          n = this._ct == CellType.Cell && this._g.rowHeaderPath ? 1 : 0;\n          n += this.columns.frozen;\n          for (var u = 0; u < o.children.length; u++) {\n            var c = o.children[u];\n            l = c.children.length;\n            if (hasClass(c, \"wj-row\")) if (a > 0) {\n              var d;\n              r = n, s = Math.min(n + a, l);\n              (d = this._createRange(c, r, s)) && c.appendChild(d.extractContents());\n            } else relocateForScrollToBeginning(c, n, a, e.col2, t.col, \"wj-cell\");\n          }\n        }\n      }\n    }\n  };\n  GridPanel.prototype._createRange = function (e, t, i) {\n    if (i > t && i <= e.children.length && t > -1) {\n      this._docRange || (this._docRange = document.createRange());\n      var o = this._docRange;\n      o.setStart(e, t);\n      o.setEnd(e, i);\n      return o;\n    }\n    return null;\n  };\n  GridPanel.prototype._renderColHdrRow = function (e, t) {\n    if (t) return 1;\n    var i = this._e.children[0];\n    i || (i = createElement('<div class=\"wj-row\" role=\"row\"></div>', this._e));\n    var o = this._g,\n      n = o ? o.columnHeaders.rows.ariaLabel : null;\n    setAttribute(i, \"aria-label\", n);\n    setAttribute(i, \"aria-selected\", null);\n    var l = 0,\n      r = this._g._getRowHeaderPath();\n    r && (l = this._renderRowHdrCell(i, -1, r.path));\n    for (var s = 0; s < this.columns.frozen && s < this.columns.length; s++) l = this._renderColHdrCell(i, s, e, t, l);\n    for (s = e.leftCol; s <= e.rightCol && s > -1; s++) l = this._renderColHdrCell(i, s, e, t, l);\n    [HeadersVisibility.None, HeadersVisibility.Row].includes(o.headersVisibility) && setAttribute(i.closest(\".wj-row\"), \"aria-hidden\", \"true\");\n    this._removeExtraCells(i, l);\n    return 1;\n  };\n  GridPanel.prototype._renderColHdrCell = function (e, t, i, o, n) {\n    var l = this.grid,\n      r = this.columns[t];\n    if (r.renderSize <= 0) return n;\n    if (o) return n + 1;\n    var s = e.children[n];\n    s || (s = createElement(GridPanel._HTML_CELL, e));\n    if (s && this._recycle && l._lazyRender) {\n      var a = s[GridPanel._INDEX_KEY];\n      if (a && -1 == a.row && a.col == t && t >= this.columns.frozen) return n + 1;\n    }\n    s.textContent = this.columns[t].header;\n    setCss(s, {\n      position: \"fixed\",\n      left: r.pos,\n      top: -32e3,\n      width: r.renderSize,\n      height: .1,\n      overflow: \"hidden\",\n      opacity: \"0\",\n      pointerEvents: \"none\"\n    });\n    colHdrAriaAttributes(s, r, this, l);\n    s[GridPanel._INDEX_KEY] = {\n      row: -1,\n      col: t,\n      panel: this\n    };\n    return n + 1;\n  };\n  GridPanel.prototype._renderRowHdrCell = function (e, t, i) {\n    var o = e.children[0];\n    o || (o = createElement(GridPanel._HTML_CELL, e));\n    o.setAttribute(\"role\", t < 0 ? \"columnheader\" : \"rowheader\");\n    o.textContent = i ? i.toString() : \"\";\n    setCss(o, {\n      position: \"fixed\",\n      left: -32e3,\n      top: -32e3,\n      width: .1,\n      height: .1,\n      overflow: \"hidden\",\n      opacity: \"0\"\n    });\n    o[GridPanel._INDEX_KEY] = {\n      row: t,\n      col: -1,\n      panel: this\n    };\n    return 1;\n  };\n  GridPanel.prototype._renderRow = function (e, t, i, o) {\n    var n = this._g,\n      l = this.rows[e];\n    if (l.renderSize <= 0) return o;\n    var r = this._e.children[o];\n    r || (r = createElement('<div class=\"wj-row\"></div>', this._e));\n    if (this._ct == CellType.Cell) {\n      r.setAttribute(\"role\", \"row\");\n      var s = SelectionMode,\n        a = l.isSelected;\n      switch (n.selectionMode) {\n        case s.Row:\n        case s.RowRange:\n          a = a || this._g._selHdl.selection.containsRow(e);\n      }\n      setAttribute(r, \"aria-selected\", !!a || null);\n      setAttribute(r, \"aria-level\", l instanceof GroupRow ? l.level + 1 : null);\n      setAttribute(r, \"aria-expanded\", l instanceof GroupRow ? !l.isCollapsed : null);\n      this.rows.ariaLabel && setAttribute(r, \"aria-label\", this.rows.ariaLabel);\n    }\n    var u = 0;\n    if (this._ct == CellType.Cell) {\n      var c = this._g._getRowHeaderPath();\n      c && (u = this._renderRowHdrCell(r, e, c.getValue(l.dataItem)));\n    }\n    for (var d = 0; d < this.columns.frozen && d < this.columns.length; d++) u = this._renderCell(r, e, d, t, i, u);\n    for (d = t.leftCol; d <= t.rightCol && d > -1; d++) u = this._renderCell(r, e, d, t, i, u);\n    this._removeExtraCells(r, u);\n    return o + 1;\n  };\n  GridPanel.prototype._renderCell = function (e, t, i, o, n, l) {\n    var r = this._g,\n      s = this._ct == CellType.Cell ? r.getMergedRange(this, t, i, !1) : r.getMergedRange(this, t, i);\n    if (s) {\n      for (var a = Math.max(o.row, s.row); a < t; a++) if (this.rows[a].renderSize) return l;\n      for (a = Math.max(o.col, s.col); a < i; a++) if (this.columns[a].renderSize) return l;\n      if (t >= s.row && t <= s.row2 && i > s.col && i <= s.col2 && this._ct === CellType.Cell && s.isSingleCell) return l;\n      var u = this.columns.frozen;\n      if (u && s.col < u && s.col2 >= u && i > s.col) return l;\n    }\n    var c = this.columns[i];\n    if ((!c || c.renderSize <= 0) && (!s || s.getRenderSize(this).width <= 0)) return l;\n    var d = e.children[l];\n    if (d && !n && this._recycle && r._lazyRender && !r.activeEditor) {\n      var h = d[GridPanel._INDEX_KEY];\n      h && h.row == t && h.col == i && h.rng == s && t >= this.rows.frozen && i >= this.columns.frozen && (n = !0);\n    }\n    var p = SelectedState,\n      f = this.getSelectedState(t, i, s),\n      g = f == p.Cursor || f == p.Active;\n    if (d && n) {\n      toggleClass(d, \"wj-state-active\", g);\n      toggleClass(d, \"wj-state-selected\", f == p.Cursor);\n      toggleClass(d, \"wj-state-multi-selected\", f == p.Selected);\n      var _ = d.querySelector(\".wj-column-selector\");\n      _ ? g || f != p.None ? setAttribute(d, \"aria-selected\", !!_.checked) : setAttribute(d, \"aria-selected\", null) : setAttribute(d, \"aria-selected\", !(!g && f == p.None) || null);\n      g && (this._activeCell = d);\n      return l + 1;\n    }\n    d || (d = createElement(GridPanel._HTML_CELL, e));\n    g && (this._activeCell = d);\n    if (this._ct == CellType.Cell) {\n      setAttribute(d, \"role\", \"gridcell\");\n      setAttribute(d, \"aria-selected\", !(f == p.None && !g) || null);\n      var m = !r.canEditCell(t, i) || null;\n      setAttribute(d, \"aria-readonly\", m);\n      setAttribute(d, \"aria-required\", m ? null : c.getIsRequired());\n    }\n    r.cellFactory.updateCell(this, t, i, d, s);\n    d[GridPanel._INDEX_KEY] = {\n      row: t,\n      col: i,\n      rng: s,\n      panel: this\n    };\n    return l + 1;\n  };\n  GridPanel.prototype._removeExtraCells = function (e, t) {\n    for (var i = this._g.cellFactory; e.childElementCount > t;) {\n      var o = e.lastElementChild;\n      removeChild(o);\n      i.disposeCell(o);\n    }\n    for (var n = e.childElementCount - 1; n > -1; --n) {\n      var l = [e.children[n], e.children[n - 1]],\n        r = l[1];\n      if ((o = l[0]) && r) {\n        var s = o.getAttribute(\"style\") === r.getAttribute(\"style\"),\n          a = o.innerHTML === r.innerHTML;\n        if (!s || !a) break;\n        removeChild(o);\n        i.disposeCell(o);\n      }\n    }\n  };\n  GridPanel.prototype._getViewRange = function () {\n    var e = this._g,\n      t = e._ptScrl,\n      i = e._szClientSB,\n      o = this._rows,\n      n = this._cols,\n      l = new CellRange(0, 0, o.length - 1, n.length - 1);\n    if (this._ct == CellType.Cell || this._ct == CellType.RowHeader) {\n      var r = -t.y + this._offsetY,\n        s = i.height;\n      if ((d = Math.min(o.frozen, o.length - 1)) > 0) {\n        r += f = o[d - 1].pos;\n        s -= f;\n      }\n      if (d > 0 && o[d].pos > i.height) l.row = l.row2 = -1;else {\n        l.row = Math.min(o.length - 1, Math.max(d, o.getItemAt(r)));\n        l.row2 = Math.max(l.row, o.getItemAt(r + s));\n      }\n      var a = e.hostElement;\n      if (e._clipToScreen && a) {\n        var u = a.getBoundingClientRect(),\n          c = -u.top - e.cells._e.offsetTop;\n        u.top < 0 && (l.row = Math.max(l.row, o.getItemAt(c) - 1));\n        u.bottom > innerHeight && (l.row2 = Math.min(l.row2, o.getItemAt(c + innerHeight) + 1));\n      }\n    }\n    if (this._ct == CellType.Cell || this._ct == CellType.ColumnHeader) {\n      var d,\n        h = -t.x,\n        p = i.width;\n      if ((d = Math.min(n.frozen, n.length - 1)) > 0) {\n        var f;\n        h += f = n[d - 1].pos;\n        p -= f;\n      }\n      if (d > 0 && n[d].pos > i.width) l.col = l.col2 = -1;else {\n        l.col = Math.min(n.length - 1, Math.max(d, n.getItemAt(h)));\n        l.col2 = Math.max(l.col, n.getItemAt(h + p));\n      }\n    }\n    o.length <= o.frozen && (l.row = l.row2 = -1);\n    n.length <= n.frozen && (l.col = l.col2 = -1);\n    return l;\n  };\n  GridPanel.prototype._getFrozenPos = function () {\n    var e = this._rows.frozen,\n      t = this._cols.frozen,\n      i = e > 0 ? this._rows[e - 1] : null,\n      o = t > 0 ? this._cols[t - 1] : null,\n      n = i ? i.pos + i.renderSize : 0,\n      l = o ? o.pos + o.renderSize : 0;\n    return new Point(l, n);\n  };\n  GridPanel._INDEX_KEY = \"wj-cell-index\";\n  GridPanel._HTML_CELL = '<div class=\"wj-cell\" tabindex=\"-1\"></div>';\n  return GridPanel;\n}();\nexport { GridPanel };\nvar CellRangeEventArgs = function (e) {\n  __extends(CellRangeEventArgs, e);\n  function CellRangeEventArgs(t, i, o) {\n    var n = e.call(this) || this;\n    n._p = asType(t, GridPanel, !0);\n    n._rng = asType(i, CellRange, !0);\n    n._data = o;\n    return n;\n  }\n  Object.defineProperty(CellRangeEventArgs.prototype, \"panel\", {\n    get: function () {\n      return this._p;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRangeEventArgs.prototype, \"range\", {\n    get: function () {\n      return this._rng.clone();\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRangeEventArgs.prototype, \"row\", {\n    get: function () {\n      return this._rng.row;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRangeEventArgs.prototype, \"col\", {\n    get: function () {\n      return this._rng.col;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellRangeEventArgs.prototype, \"data\", {\n    get: function () {\n      return this._data;\n    },\n    set: function (e) {\n      this._data = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  CellRangeEventArgs.prototype.getRow = function () {\n    return this._p && this.row > -1 ? this._p.rows[this.row] : null;\n  };\n  CellRangeEventArgs.prototype.getColumn = function (e) {\n    var t = this._p,\n      i = t && this.col > -1 ? t.columns[this.col] : null;\n    if (i && e) {\n      var o = t.grid;\n      i = t.cellType === CellType.ColumnHeader && o._hasColumnGroups() ? o._getColumnGroup(this.row, this.col) : t.grid._getBindingColumn(t, this.row, i);\n    }\n    return i;\n  };\n  return CellRangeEventArgs;\n}(CancelEventArgs);\nexport { CellRangeEventArgs };\nvar FormatItemEventArgs = function (e) {\n  __extends(FormatItemEventArgs, e);\n  function FormatItemEventArgs(t, i, o, n) {\n    void 0 === n && (n = !0);\n    var l = e.call(this, t, i) || this;\n    l._updateContent = !0;\n    l._cell = asType(o, HTMLElement);\n    return l;\n  }\n  Object.defineProperty(FormatItemEventArgs.prototype, \"cell\", {\n    get: function () {\n      return this._cell;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FormatItemEventArgs.prototype, \"updateContent\", {\n    get: function () {\n      return this._updateContent;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  return FormatItemEventArgs;\n}(CellRangeEventArgs);\nexport { FormatItemEventArgs };\nvar CellEditEndingEventArgs = function (e) {\n  __extends(CellEditEndingEventArgs, e);\n  function CellEditEndingEventArgs() {\n    var t = null !== e && e.apply(this, arguments) || this;\n    t._stayInEditMode = !1;\n    t._refresh = !0;\n    return t;\n  }\n  Object.defineProperty(CellEditEndingEventArgs.prototype, \"stayInEditMode\", {\n    get: function () {\n      return this._stayInEditMode;\n    },\n    set: function (e) {\n      this._stayInEditMode = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(CellEditEndingEventArgs.prototype, \"refresh\", {\n    get: function () {\n      return this._refresh;\n    },\n    set: function (e) {\n      this._refresh = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  return CellEditEndingEventArgs;\n}(CellRangeEventArgs);\nexport { CellEditEndingEventArgs };\nexport var SelectionMode;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Cell = 1] = \"Cell\";\n  e[e.CellRange = 2] = \"CellRange\";\n  e[e.Row = 3] = \"Row\";\n  e[e.RowRange = 4] = \"RowRange\";\n  e[e.ListBox = 5] = \"ListBox\";\n  e[e.MultiRange = 6] = \"MultiRange\";\n}(SelectionMode || (SelectionMode = {}));\nexport var SelectedState;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Selected = 1] = \"Selected\";\n  e[e.Cursor = 2] = \"Cursor\";\n  e[e.Active = 3] = \"Active\";\n}(SelectedState || (SelectedState = {}));\nexport var SelMove;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Next = 1] = \"Next\";\n  e[e.Prev = 2] = \"Prev\";\n  e[e.NextPage = 3] = \"NextPage\";\n  e[e.PrevPage = 4] = \"PrevPage\";\n  e[e.Home = 5] = \"Home\";\n  e[e.End = 6] = \"End\";\n  e[e.NextCell = 7] = \"NextCell\";\n  e[e.PrevCell = 8] = \"PrevCell\";\n  e[e.NextEditableCell = 9] = \"NextEditableCell\";\n  e[e.PrevEditableCell = 10] = \"PrevEditableCell\";\n}(SelMove || (SelMove = {}));\nvar _SelectionHandler = function () {\n  function _SelectionHandler(e) {\n    this._sel = new CellRange(0, 0);\n    this._xSel = new ObservableArray();\n    this._mode = SelectionMode.CellRange;\n    this._g = e;\n    this._e = new CellRangeEventArgs(e.cells, new CellRange(0, 0));\n    this._xSel.collectionChanged.addHandler(function () {\n      e.invalidate();\n    });\n  }\n  Object.defineProperty(_SelectionHandler.prototype, \"selectionMode\", {\n    get: function () {\n      return this._mode;\n    },\n    set: function (e) {\n      e != this._mode && this._setSelectionMode(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(_SelectionHandler.prototype, \"selection\", {\n    get: function () {\n      return this._sel;\n    },\n    set: function (e) {\n      this.select(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(_SelectionHandler.prototype, \"extendedSelection\", {\n    get: function () {\n      return this._xSel;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  _SelectionHandler.prototype.select = function (e, t, i) {\n    void 0 === t && (t = !0);\n    void 0 === i && (i = !1);\n    var o = this._g,\n      n = this._e.range,\n      l = this._sel,\n      r = n,\n      s = !1,\n      a = SelectionMode;\n    if (isNumber(e) && isString(t)) {\n      var u = o.columns.indexOf(t);\n      if (u < 0) throw \"Invalid column name or binding.\";\n      n.setRange(e, u);\n      t = !0;\n    } else if (isNumber(e) && isNumber(t)) {\n      n.setRange(e, t);\n      t = !0;\n    } else e instanceof CellRange ? n.copy(e) : assert(!1, \"CellRange expected\");\n    switch (o.selectionMode) {\n      case a.Cell:\n        r.row2 = r.row;\n        r.col2 = r.col;\n        break;\n      case a.Row:\n        r.row2 = r.row;\n        break;\n      case a.ListBox:\n        s = !0;\n    }\n    var c = r.equals(l);\n    if (c && s) for (var d = 0; d < o.rows.length; d++) if (o.rows[d].isSelected !== r.containsRow(d)) {\n      c = !1;\n      break;\n    }\n    if (c) {\n      t && o.isRangeValid(r) && this._showSelection();\n      return !0;\n    }\n    var h = Control.getControl(closest(getActiveElement(), \".wj-flexgrid\"));\n    if (h && h.activeEditor && !h.finishEditing()) return !1;\n    var p = this._e;\n    p._rng = r;\n    p.cancel = !1;\n    if (!o.onSelectionChanging(p) && !i) return !1;\n    s && o.rows.forEach(function (e, t) {\n      e._setFlag(RowColFlags.Selected, r.containsRow(t), !0);\n    });\n    r.row = Math.min(r.row, o.rows.length - 1);\n    r.row2 = Math.min(r.row2, o.rows.length - 1);\n    this._sel.copy(r);\n    o.refreshCells(!1, !0, !0);\n    t && this._showSelection();\n    var f = o.collectionView;\n    if (f) {\n      var g = o._getCvIndex(r.row);\n      f.moveCurrentToPosition(g);\n    }\n    o.onSelectionChanged(p);\n    return !0;\n  };\n  _SelectionHandler.prototype.moveSelection = function (e, t, i) {\n    var o = this._g,\n      n = this._sel,\n      l = i && o.anchorCursor ? new CellRange(n.row2, n.col2) : new CellRange(n.row, n.col);\n    this._adjustReferenceCell(l, e, t);\n    var r = l.row,\n      s = l.col,\n      a = o.columns,\n      u = Math.max(0, o._szClient.height - o.columnHeaders.height),\n      c = SelMove;\n    switch (t) {\n      case c.NextCell:\n      case c.NextEditableCell:\n        if ((s = this._getNextColumnCell(r, s, t)) == l.col && (r = this._getNextRowCell(r, s, t)) > l.row) {\n          s = this._getNextColumnCell(r, 0, t);\n          s = this._getNextColumnCell(r, s, t == c.NextCell ? c.PrevCell : c.PrevEditableCell);\n        }\n        o.select(r, s);\n        break;\n      case c.PrevCell:\n      case c.PrevEditableCell:\n        if ((s = this._getNextColumnCell(r, l.col, t)) == l.col && (r = this._getNextRowCell(r, s, t)) < l.row) {\n          s = this._getNextColumnCell(r, a.length - 1, t);\n          s = this._getNextColumnCell(r, s, t == c.PrevCell ? c.NextCell : c.NextEditableCell);\n        }\n        o.select(r, s);\n        break;\n      default:\n        if (!this.moveHeaderCells(e, t, r, s)) {\n          r = this._getNextRowCell(r, s, e, u);\n          s = this._getNextColumnCell(r, s, t, u);\n          i ? o.selection = o.anchorCursor ? new CellRange(n.row, n.col, r, s) : new CellRange(r, s, n.row2, n.col2) : o.select(r, s);\n          break;\n        }\n    }\n  };\n  _SelectionHandler.prototype.moveHeaderCells = function (e, t, i, o) {\n    var n = this._g,\n      l = [HeadersFocusability.Column, HeadersFocusability.All].includes(n.headersFocusability),\n      r = [HeadersFocusability.Row, HeadersFocusability.All].includes(n.headersFocusability),\n      s = n.activePanelType === CellType.ColumnHeader,\n      a = n.activePanelType === CellType.RowHeader,\n      u = n.activePanelType === CellType.TopLeft,\n      c = n.activePanelType === CellType.Cell,\n      d = 2 === e ? \"up\" : 1 === e ? \"down\" : 2 === t ? \"left\" : 1 === t ? \"right\" : void 0,\n      h = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-focus-header-cell\"))[0];\n    if (c && l && 0 === i && \"up\" === d) {\n      n.activePanelType = CellType.ColumnHeader;\n      var p = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-row\")),\n        f = Array.from(n._gpCells.hostElement.getElementsByClassName(\"wj-row\"))[0],\n        g = p[p.length - 1];\n      (Array.from(f.getElementsByClassName(\"wj-cell\")).find(function (e) {\n        return e[\"wj-cell-index\"].col === o;\n      }) || Array.from(f.getElementsByClassName(\"wj-cell\"))[0]).setAttribute(\"tabindex\", \"-1\");\n      (m = Array.from(g.getElementsByClassName(\"wj-cell\")).find(function (e) {\n        return e[\"wj-cell-index\"].col === o;\n      })).classList.add(\"wj-focus-header-cell\");\n      m.setAttribute(\"tabindex\", \"0\");\n      n._hideMarquee();\n      m.focus();\n      return !0;\n    }\n    if (c && r && 0 === o && \"left\" === d) {\n      n.activePanelType = CellType.RowHeader;\n      var _ = (p = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-row\"))).find(function (e) {\n        return Array.from(e.getElementsByClassName(\"wj-cell\")).some(function (e) {\n          return e[\"wj-cell-index\"].row === i;\n        });\n      });\n      if (!_) return !0;\n      var m,\n        C = Array.from(_.getElementsByClassName(\"wj-cell\"));\n      (m = C[C.length - 1]).classList.add(\"wj-focus-header-cell\");\n      m.setAttribute(\"tabindex\", \"0\");\n      n._hideMarquee();\n      m.focus();\n      return !0;\n    }\n    if (s && h) {\n      var w = h.nextElementSibling,\n        v = h.previousElementSibling;\n      if (h && \"right\" === d && w) {\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        n.scrollIntoView(0, h[\"wj-cell-index\"].col + 1);\n        setTimeout(function () {\n          w.classList.add(\"wj-focus-header-cell\");\n          w.setAttribute(\"tabindex\", \"0\");\n          n._hideMarquee();\n          w.focus();\n        }, 10);\n      } else if (h && \"left\" === d) {\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        if (v) {\n          n.scrollIntoView(0, h[\"wj-cell-index\"].col - 1);\n          setTimeout(function () {\n            v.classList.add(\"wj-focus-header-cell\");\n            v.setAttribute(\"tabindex\", \"0\");\n            n._hideMarquee();\n            v.focus();\n          }, 10);\n        } else {\n          n.activePanelType = CellType.TopLeft;\n          var y = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-cell\"))[0];\n          y && setTimeout(function () {\n            y.classList.add(\"wj-focus-header-cell\");\n            y.setAttribute(\"tabindex\", \"0\");\n            n._hideMarquee();\n            y.focus();\n          }, 10);\n        }\n      } else if (h && \"down\" === d) {\n        var b = Array.from(h.parentElement.children).indexOf(h);\n        n.activePanelType = CellType.Cell;\n        n.focus();\n        n.select(0, b);\n        n._updateMarquee();\n      }\n      return !0;\n    }\n    if (a && h) {\n      b = Array.from(h.parentElement.children).indexOf(h);\n      var R = h[\"wj-cell-index\"].row,\n        E = h.parentElement.nextElementSibling && Array.from(h.parentElement.nextElementSibling.children)[b],\n        x = h.parentElement.previousElementSibling && Array.from(h.parentElement.previousElementSibling.children)[b];\n      if (\"up\" === d) {\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        if (x) {\n          n.scrollIntoView(R - 1, 0);\n          setTimeout(function () {\n            x.classList.add(\"wj-focus-header-cell\");\n            x.setAttribute(\"tabindex\", \"0\");\n            x.focus();\n          }, 10);\n        } else {\n          n.activePanelType = CellType.TopLeft;\n          var S = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-cell\"))[0];\n          S && setTimeout(function () {\n            S.classList.add(\"wj-focus-header-cell\");\n            S.setAttribute(\"tabindex\", \"0\");\n            n._hideMarquee();\n            S.focus();\n          }, 10);\n        }\n      } else if (\"down\" === d && E) {\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        n.scrollIntoView(R + 1, 0);\n        setTimeout(function () {\n          E.classList.add(\"wj-focus-header-cell\");\n          E.setAttribute(\"tabindex\", \"0\");\n          E.focus();\n        }, 10);\n      } else if (h && \"right\" === d) {\n        n.activePanelType = CellType.Cell;\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        n.focus();\n        n.select(R, 0);\n      }\n      return !0;\n    }\n    if (u && h) {\n      if (\"down\" === d && r) {\n        n.activePanelType = CellType.RowHeader;\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        var H = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-cell\"))[0];\n        H && setTimeout(function () {\n          H.classList.add(\"wj-focus-header-cell\");\n          H.setAttribute(\"tabindex\", \"0\");\n          H.focus();\n        }, 10);\n      }\n      if (\"right\" === d && l) {\n        n.activePanelType = CellType.ColumnHeader;\n        h.classList.remove(\"wj-focus-header-cell\");\n        h.setAttribute(\"tabindex\", \"-1\");\n        var F = Array.from(n.activePanel.hostElement.getElementsByClassName(\"wj-cell\"))[0];\n        F && setTimeout(function () {\n          F.classList.add(\"wj-focus-header-cell\");\n          F.setAttribute(\"tabindex\", \"0\");\n          F.focus();\n        }, 10);\n      }\n      return !0;\n    }\n    return !1;\n  };\n  _SelectionHandler.prototype._getNextColumnCell = function (e, t, i, o) {\n    void 0 === o && (o = 0);\n    return this._g.columns.getNextCell(t, i, o);\n  };\n  _SelectionHandler.prototype._getNextRowCell = function (e, t, i, o) {\n    void 0 === o && (o = 0);\n    return this._g.rows.getNextCell(e, i, o);\n  };\n  _SelectionHandler.prototype._setSelectionMode = function (e) {\n    var t = this._g,\n      i = t.rows;\n    this._mode = e;\n    this._xSel.clear();\n    if (i.length) {\n      this._adjustSelection(this._sel, e, !0);\n      t.invalidate();\n    }\n  };\n  _SelectionHandler.prototype._adjustSelection = function (e, t, i) {\n    void 0 === i && (i = !1);\n    var o = this._g.rows,\n      n = SelectionMode,\n      l = this._g.hostElement.querySelector(\"input.wj-column-selector\") instanceof HTMLInputElement;\n    if (!l) for (var r = 0; r < o.length; r++) o[r]._setFlag(RowColFlags.Selected, !1, !0);\n    var s = e.clone();\n    switch (t) {\n      case n.None:\n        s = new CellRange();\n        break;\n      case n.Cell:\n        s = new CellRange(e.row, e.col);\n        break;\n      case n.ListBox:\n        if (l) return;\n        for (r = 0; r < o.length; r++) o[r]._setFlag(RowColFlags.Selected, s.containsRow(r), !0);\n    }\n    this.select(s, !1, i);\n  };\n  _SelectionHandler.prototype._expandSelection = function () {\n    var e = this._g,\n      t = e.selectionMode;\n    if (e.expandSelectionOnCopyPaste && t) {\n      var i = this.selection,\n        o = SelectionMode;\n      switch (t) {\n        case o.Cell:\n        case o.Row:\n          break;\n        case o.ListBox:\n          this._expandSelectedRows();\n          break;\n        case o.RowRange:\n          i = new CellRange(i.topRow, 0, i.bottomRow, e.columns.length - 1);\n        default:\n          var n = this._expandSelectionRange(i);\n          n && this.select(n, !1);\n      }\n    }\n  };\n  _SelectionHandler.prototype._deselectRange = function (e) {\n    var t = this.selection,\n      i = this.extendedSelection;\n    if (t.contains(e)) {\n      var o = i.length;\n      this._sel = o ? i[o - 1] : new CellRange();\n      o && i.removeAt(o - 1);\n      return !0;\n    }\n    for (var n = 0; n < i.length; n++) if (i[n].contains(e)) {\n      i.removeAt(n);\n      return !0;\n    }\n    return !1;\n  };\n  _SelectionHandler.prototype._expandSelectedRows = function () {\n    assert(this.selectionMode == SelectionMode.ListBox, \"ListBox mode expected\");\n    for (var e = this._g, t = e.selectedRows.map(function (e) {\n        return e.index;\n      }), i = [], o = 0; o < t.length; o++) for (var n = new CellRange(t[o], 0, t[o], e.columns.length - 1), l = this._expandSelectionRange(n) || n, r = l.topRow; r <= l.bottomRow; r++) -1 === i.indexOf(r) && i.push(r);\n    i.sort();\n    this._selectRows(i);\n  };\n  _SelectionHandler.prototype._expandSelectionRange = function (e) {\n    var t = this._g,\n      i = t.cells,\n      o = t.getMergedRange(i, e.topRow, e.leftCol, !1),\n      n = t.getMergedRange(i, e.bottomRow, e.leftCol, !1),\n      l = t.getMergedRange(i, e.topRow, e.rightCol, !1),\n      r = t.getMergedRange(i, e.bottomRow, e.rightCol, !1);\n    if (o || n || l || r) {\n      o = o || new CellRange(e.topRow, e.leftCol);\n      n = n || new CellRange(e.bottomRow, e.leftCol);\n      l = l || new CellRange(e.topRow, e.rightCol);\n      r = r || new CellRange(e.bottomRow, e.rightCol);\n      return new CellRange(Math.min(o.topRow, n.topRow, l.topRow, r.topRow), Math.min(o.leftCol, n.leftCol, l.leftCol, r.leftCol), Math.max(o.bottomRow, n.bottomRow, l.bottomRow, r.bottomRow), Math.max(o.rightCol, n.rightCol, l.rightCol, r.rightCol));\n    }\n    return null;\n  };\n  _SelectionHandler.prototype._selectRows = function (e) {\n    assert(this.selectionMode == SelectionMode.ListBox, \"ListBox mode expected\");\n    for (var t = this._g, i = 0, o = !0; i < t.rows.length; i++) {\n      var n = t.rows[i],\n        l = e && e.indexOf(n.index) > -1;\n      if (l && o) {\n        o = !1;\n        this.select(i, this.selection.col);\n      }\n      n.isSelected = l;\n    }\n  };\n  _SelectionHandler.prototype._showSelection = function () {\n    var e = this._g,\n      t = this._sel;\n    e.anchorCursor ? e.scrollIntoView(t.row2, t.col2) : e.scrollIntoView(t.row, t.col);\n  };\n  _SelectionHandler.prototype._adjustReferenceCell = function (e, t, i) {\n    var o = this._g,\n      n = o.getMergedRange(o.cells, e.row, e.col);\n    if (n && !n.isSingleCell) {\n      var l = SelMove;\n      switch (t) {\n        case l.Next:\n        case l.NextCell:\n        case l.NextEditableCell:\n          e.row = n.bottomRow;\n          break;\n        case l.Prev:\n        case l.PrevCell:\n        case l.PrevEditableCell:\n          e.row = n.topRow;\n      }\n      switch (i) {\n        case l.Next:\n        case l.NextCell:\n        case l.NextEditableCell:\n          e.col = n.rightCol;\n          break;\n        case l.Prev:\n        case l.PrevCell:\n        case l.PrevEditableCell:\n          e.col = n.leftCol;\n      }\n    }\n  };\n  return _SelectionHandler;\n}();\nexport { _SelectionHandler };\nexport var RowColFlags;\n!function (e) {\n  e[e.Visible = 1] = \"Visible\";\n  e[e.AllowResizing = 2] = \"AllowResizing\";\n  e[e.AllowDragging = 4] = \"AllowDragging\";\n  e[e.AllowMerging = 8] = \"AllowMerging\";\n  e[e.AllowSorting = 16] = \"AllowSorting\";\n  e[e.AutoGenerated = 32] = \"AutoGenerated\";\n  e[e.Collapsed = 64] = \"Collapsed\";\n  e[e.ParentCollapsed = 128] = \"ParentCollapsed\";\n  e[e.Selected = 256] = \"Selected\";\n  e[e.ReadOnly = 512] = \"ReadOnly\";\n  e[e.HtmlContent = 1024] = \"HtmlContent\";\n  e[e.WordWrap = 2048] = \"WordWrap\";\n  e[e.MultiLine = 4096] = \"MultiLine\";\n  e[e.HasTemplate = 8192] = \"HasTemplate\";\n  e[e.RowDefault = 3] = \"RowDefault\";\n  e[e.ColumnDefault = 23] = \"ColumnDefault\";\n}(RowColFlags || (RowColFlags = {}));\nvar RowCol = function () {\n  function RowCol() {\n    this._type = null;\n    this._align = null;\n    this._inpType = null;\n    this._mask = null;\n    this._maxLen = null;\n    this._required = null;\n    this._fmt = null;\n    this._map = null;\n    this._ddCssClass = null;\n    this._cssClass = null;\n    this._cssClassAll = null;\n    this._szMin = null;\n    this._szMax = null;\n    this._sz = null;\n    this._pos = 0;\n    this._idx = -1;\n    this._idxVis = -1;\n    this._idxData = -1;\n    this.gridChanged = new Event();\n  }\n  Object.defineProperty(RowCol.prototype, \"binding\", {\n    get: function () {\n      return this._binding ? this._binding.path : null;\n    },\n    set: function (e) {\n      if (e != this.binding) {\n        var t = asString(e);\n        this._binding = t ? new Binding(t) : null;\n        if (!this._type && this.grid && this._binding) {\n          var i = this.grid.collectionView;\n          if (i && i.sourceCollection && i.sourceCollection.length) {\n            var o = i.sourceCollection[0];\n            this._type = getType(this._binding.getValue(o));\n          }\n        }\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"sortMemberPath\", {\n    get: function () {\n      return this._bindingSort ? this._bindingSort.path : null;\n    },\n    set: function (e) {\n      if (e != this.sortMemberPath) {\n        var t = asString(e);\n        this._bindingSort = t ? new Binding(t) : null;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"dataType\", {\n    get: function () {\n      return this._type;\n    },\n    set: function (e) {\n      e = asEnum(e, DataType, !0);\n      if (this._type != e) {\n        this._type = e;\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"inputType\", {\n    get: function () {\n      return this._inpType;\n    },\n    set: function (e) {\n      this._inpType = asString(e, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"mask\", {\n    get: function () {\n      return this._mask;\n    },\n    set: function (e) {\n      this._mask = asString(e, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"maxLength\", {\n    get: function () {\n      return this._maxLen;\n    },\n    set: function (e) {\n      this._maxLen = asNumber(e, !0, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"align\", {\n    get: function () {\n      return this._align;\n    },\n    set: function (e) {\n      if (this._align != e) {\n        this._align = e;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"format\", {\n    get: function () {\n      return this._fmt;\n    },\n    set: function (e) {\n      if (this._fmt != e) {\n        this._fmt = e;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"dataMap\", {\n    get: function () {\n      return this._map;\n    },\n    set: function (e) {\n      if (this._map != e) {\n        this._map && this._map.mapChanged.removeHandler(this.onPropertyChanged, this);\n        isArray(e) && (e = new DataMap(e, null, null));\n        this._map = asType(e, DataMap, !0);\n        this._map && this._map.mapChanged.addHandler(this.onPropertyChanged, this);\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"dataMapEditor\", {\n    get: function () {\n      return null != this._mapEditor ? this._mapEditor : DataMapEditor.DropDownList;\n    },\n    set: function (e) {\n      if (e != this._mapEditor) {\n        this._mapEditor = asEnum(e, DataMapEditor);\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"showDropDown\", {\n    get: function () {\n      return this.dataMapEditor == DataMapEditor.DropDownList;\n    },\n    set: function (e) {\n      _deprecated(\"showDropDown\", \"dataMapEditor\");\n      this.dataMapEditor = e ? DataMapEditor.DropDownList : DataMapEditor.AutoComplete;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"dropDownCssClass\", {\n    get: function () {\n      return this._ddCssClass;\n    },\n    set: function (e) {\n      this._ddCssClass = asString(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"visible\", {\n    get: function () {\n      return this._getFlag(RowColFlags.Visible);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.Visible, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"isVisible\", {\n    get: function () {\n      return !!this._getFlag(RowColFlags.Visible) && (!this._getFlag(RowColFlags.ParentCollapsed) || this instanceof _NewRowTemplate);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"pos\", {\n    get: function () {\n      this._list && this._list._dirty && this._list._update();\n      return this._pos;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"index\", {\n    get: function () {\n      this._list && this._list._dirty && this._list._update();\n      return this._idx;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"visibleIndex\", {\n    get: function () {\n      this._list && this._list._dirty && this._list._update();\n      return this.isVisible ? this._idxVis : -1;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"size\", {\n    get: function () {\n      return this._sz;\n    },\n    set: function (e) {\n      if (e != this._sz) {\n        this._sz = asNumber(e, !0);\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"renderSize\", {\n    get: function () {\n      var e = 0,\n        t = this._list;\n      if (this.isVisible) {\n        (null == (e = this._sz) || e < 0) && (e = t ? t.defaultSize : 0);\n        t && null != t.minSize && e < t.minSize && (e = t.minSize);\n        t && null != t.maxSize && e > t.maxSize && (e = t.maxSize);\n        null != this._szMin && e < this._szMin && (e = this._szMin);\n        null != this._szMax && e > this._szMax && (e = this._szMax);\n      }\n      return e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"allowResizing\", {\n    get: function () {\n      return this._getFlag(RowColFlags.AllowResizing);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.AllowResizing, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"allowDragging\", {\n    get: function () {\n      return this._getFlag(RowColFlags.AllowDragging);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.AllowDragging, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"allowMerging\", {\n    get: function () {\n      return this._getFlag(RowColFlags.AllowMerging);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.AllowMerging, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"isSelected\", {\n    get: function () {\n      return this._getFlag(RowColFlags.Selected);\n    },\n    set: function (e) {\n      if (!!e != this.isSelected) {\n        var t = this.grid;\n        if (t) {\n          var i = new CellRangeEventArgs(t ? t.cells : null, t.selection);\n          if (t.onSelectionChanging(i) && this._setFlag(RowColFlags.Selected, e, !0)) {\n            t.refreshCells(!1, !0, !0);\n            t.onSelectionChanged(i);\n          }\n        } else this._setFlag(RowColFlags.Selected, e);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"isReadOnly\", {\n    get: function () {\n      return this._getFlag(RowColFlags.ReadOnly);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.ReadOnly, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"isRequired\", {\n    get: function () {\n      return this._required;\n    },\n    set: function (e) {\n      this._required = asBoolean(e, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"isContentHtml\", {\n    get: function () {\n      return this._getFlag(RowColFlags.HtmlContent);\n    },\n    set: function (e) {\n      if (this.isContentHtml != e) {\n        this._setFlag(RowColFlags.HtmlContent, e);\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"wordWrap\", {\n    get: function () {\n      return this._getFlag(RowColFlags.WordWrap);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.WordWrap, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"multiLine\", {\n    get: function () {\n      return this._getFlag(RowColFlags.MultiLine);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.MultiLine, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"cssClass\", {\n    get: function () {\n      return this._cssClass;\n    },\n    set: function (e) {\n      if (e != this._cssClass) {\n        this._cssClass = asString(e);\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"cssClassAll\", {\n    get: function () {\n      return this._cssClassAll;\n    },\n    set: function (e) {\n      if (e != this._cssClassAll) {\n        this._cssClassAll = asString(e);\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"grid\", {\n    get: function () {\n      return this._list ? this._list._g : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCol.prototype, \"collectionView\", {\n    get: function () {\n      return this.grid ? this.grid.collectionView : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  RowCol.prototype.onPropertyChanged = function () {\n    if (this._list) {\n      this._list._dirty = !0;\n      this.grid.invalidate();\n    }\n  };\n  RowCol.prototype.onGridChanged = function (e) {\n    this.gridChanged.raise(this, e);\n  };\n  RowCol.prototype._setList = function (e) {\n    if (e != this._list) {\n      this._list = e;\n      this.onGridChanged();\n    }\n  };\n  RowCol.prototype._getFlag = function (e) {\n    return 0 != (this._f & e);\n  };\n  RowCol.prototype._setFlag = function (e, t, i) {\n    if (!!t != this._getFlag(e)) {\n      this._f = t ? this._f | e : this._f & ~e;\n      i || this.onPropertyChanged();\n      return !0;\n    }\n    return !1;\n  };\n  return RowCol;\n}();\nexport { RowCol };\nvar Column = function (e) {\n  __extends(Column, e);\n  function Column(t) {\n    var i = e.call(this) || this;\n    i._hdr = null;\n    i._name = null;\n    i._agg = null;\n    i._quickSize = null;\n    i._descById = null;\n    i._tpl = null;\n    i._f = RowColFlags.ColumnDefault;\n    i._hash = Column._ctr.toString(36);\n    Column._ctr++;\n    copy(i, t);\n    i._uid = uidGenerator();\n    return i;\n  }\n  Object.defineProperty(Column.prototype, \"name\", {\n    get: function () {\n      return this._name;\n    },\n    set: function (e) {\n      this._name = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"width\", {\n    get: function () {\n      return null != this._szStar ? this._szStar : this.size;\n    },\n    set: function (e) {\n      if (null != Column._parseStarSize(e)) {\n        this._szStar = e;\n        this.onPropertyChanged();\n      } else {\n        this._szStar = null;\n        this.size = asNumber(e, !0);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"minWidth\", {\n    get: function () {\n      return this._szMin;\n    },\n    set: function (e) {\n      if (e != this._szMin) {\n        this._szMin = asNumber(e, !0, !0);\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"maxWidth\", {\n    get: function () {\n      return this._szMax;\n    },\n    set: function (e) {\n      if (e != this._szMax) {\n        this._szMax = asNumber(e, !0, !0);\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"quickAutoSize\", {\n    get: function () {\n      return this._quickSize;\n    },\n    set: function (e) {\n      this._quickSize = asBoolean(e, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Column.prototype._getQuickAutoSize = function () {\n    return !!this.grid._getQuickAutoSize() && (isBoolean(this._quickSize) ? this._quickSize : !(this.isContentHtml || this.wordWrap || this.multiLine || this._getFlag(RowColFlags.HasTemplate)));\n  };\n  Object.defineProperty(Column.prototype, \"renderWidth\", {\n    get: function () {\n      return this.renderSize;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"header\", {\n    get: function () {\n      return this._hdr ? this._hdr : this.binding;\n    },\n    set: function (e) {\n      if (this._hdr != e) {\n        this._hdr = e;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"cellTemplate\", {\n    get: function () {\n      return this._tpl;\n    },\n    set: function (e) {\n      if (e != this._tpl) {\n        assert(null == e || isString(e) || isFunction(e), \"cellTemplate should be a string or an ICellTemplateFunction.\");\n        this._tpl = e;\n        this._setFlag(RowColFlags.HasTemplate, null != e && \"\" != e);\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"editor\", {\n    get: function () {\n      var e = this._edt;\n      return e ? e.control : null;\n    },\n    set: function (e) {\n      if (e != this.editor) {\n        if (this._edt) {\n          this._edt.dispose();\n          this._edt = null;\n        }\n        if (null != e) {\n          e = asType(e, Control);\n          this._edt = new _CustomEditor(this, e);\n        }\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"allowSorting\", {\n    get: function () {\n      return this._getFlag(RowColFlags.AllowSorting);\n    },\n    set: function (e) {\n      this._setFlag(RowColFlags.AllowSorting, e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"currentSort\", {\n    get: function () {\n      var e = this.currentSortIndex;\n      if (e > -1) {\n        return this.grid.collectionView.sortDescriptions[e].ascending ? \"+\" : \"-\";\n      }\n      return null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"currentSortIndex\", {\n    get: function () {\n      var e = this.grid ? this.grid.collectionView : null,\n        t = e ? e.sortDescriptions : null,\n        i = t && t.length ? this._getBindingSort() : null;\n      if (i) for (var o = 0; o < t.length; o++) if (t[o].property == i) return o;\n      return -1;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"aggregate\", {\n    get: function () {\n      return null != this._agg ? this._agg : Aggregate.None;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, Aggregate)) != this._agg) {\n        this._agg = e;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Column.prototype, \"describedById\", {\n    get: function () {\n      return this._descById;\n    },\n    set: function (e) {\n      if (e != this._descById) {\n        this._descById = asString(e);\n        this.grid && this.grid.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Column.prototype.getIsRequired = function (e) {\n    return null != this._required ? this._required : e && null != e.isRequired ? e.isRequired : this.dataType == DataType.String ? null != this.dataMap || null != this._mask && this._mask.length > 0 : !e || e.dataType != DataType.String || null != e.dataMap || null != e.mask && e.mask.length > 0;\n  };\n  Column.prototype.getAlignment = function (e) {\n    if (null != this._align) return this._align;\n    if (e && null != e.align) return e.align;\n    if (!this._map) switch (this.dataType) {\n      case DataType.Boolean:\n        return \"center\";\n      case DataType.Number:\n        return \"right\";\n    }\n    if (e && !e.dataMap) switch (e.dataType) {\n      case DataType.Boolean:\n        return \"center\";\n      case DataType.Number:\n        return \"right\";\n    }\n    return \"\";\n  };\n  Column.prototype._getBindingSort = function () {\n    return this.sortMemberPath ? this.sortMemberPath : this.binding ? this.binding : null;\n  };\n  Column._parseStarSize = function (e) {\n    if (isString(e)) {\n      var t = e.length;\n      if (t > 0 && \"*\" == e[t - 1]) {\n        var i = 1 == t ? 1 : parseFloat(e);\n        if (i > 0 && !isNaN(i)) return i;\n      }\n    }\n    return null;\n  };\n  Column._ctr = 0;\n  return Column;\n}(RowCol);\nexport { Column };\nvar Row = function (e) {\n  __extends(Row, e);\n  function Row(t) {\n    var i = e.call(this) || this;\n    i.resizedManually = !1;\n    i._f = RowColFlags.ColumnDefault;\n    i._data = t || null;\n    return i;\n  }\n  Object.defineProperty(Row.prototype, \"dataItem\", {\n    get: function () {\n      return this._data;\n    },\n    set: function (e) {\n      this._data = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Row.prototype, \"dataIndex\", {\n    get: function () {\n      this._list && this._list._dirty && this._list._update();\n      return this._idxData;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Row.prototype, \"height\", {\n    get: function () {\n      return this.size;\n    },\n    set: function (e) {\n      this.size = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(Row.prototype, \"renderHeight\", {\n    get: function () {\n      return this.renderSize;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  return Row;\n}(RowCol);\nexport { Row };\nvar GroupRow = function (e) {\n  __extends(GroupRow, e);\n  function GroupRow(t) {\n    var i = e.call(this, t) || this;\n    i._level = -1;\n    i.level = t instanceof CollectionViewGroup ? t.level : -1;\n    i.isReadOnly = !0;\n    return i;\n  }\n  Object.defineProperty(GroupRow.prototype, \"level\", {\n    get: function () {\n      return this._level;\n    },\n    set: function (e) {\n      asInt(e);\n      if (e != this._level) {\n        this._level = e;\n        this.onPropertyChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GroupRow.prototype, \"hasChildren\", {\n    get: function () {\n      if (null != this.grid && null != this._list) {\n        this._list._update();\n        var e = this.index < this._list.length - 1 ? this._list[this.index + 1] : null,\n          t = tryCast(e, GroupRow),\n          i = tryCast(e, _NewRowTemplate);\n        return null != e && null == i && (null == t || t.level > this.level);\n      }\n      return !0;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(GroupRow.prototype, \"isCollapsed\", {\n    get: function () {\n      return this._getFlag(RowColFlags.Collapsed);\n    },\n    set: function (e) {\n      !!e != this.isCollapsed && null != this._list && this._setCollapsed(asBoolean(e));\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  GroupRow.prototype.getGroupHeader = function () {\n    var e = this.grid,\n      t = e.groupHeaderFormat || culture.FlexGrid.groupHeaderFormat,\n      i = this.dataItem;\n    if (i instanceof CollectionViewGroup && t && e.showGroups && !e.childItemsPath) {\n      var o = i.groupDescription.propertyName,\n        n = i.name,\n        l = e.getColumn(o),\n        r = this.isContentHtml;\n      if (l) {\n        r = r || l.isContentHtml;\n        l.header && (o = l.header);\n        var s = l.dataMap;\n        s && (n = s.getDisplayValue(n));\n        l.dataType == getType(n) && (n = Globalize.format(n, l.format));\n      } else o = toHeaderCase(o);\n      var a = i.getAggregate(Aggregate.CntAll, null, e.collectionView);\n      return format(t, {\n        name: escapeHtml(o),\n        value: r ? n : escapeHtml(n),\n        level: i.level,\n        count: a\n      });\n    }\n    return \"\";\n  };\n  GroupRow.prototype._setCollapsed = function (e) {\n    var t = this,\n      i = this.grid,\n      o = i.rows,\n      n = this.getCellRange(),\n      l = new CellRangeEventArgs(i.cells, new CellRange(this.index, -1));\n    if (i.onGroupCollapsedChanging(l)) {\n      i.deferUpdate(function () {\n        o.deferUpdate(function () {\n          t._setFlag(RowColFlags.Collapsed, e, !0);\n          for (var i = n.topRow + 1; i <= n.bottomRow && i > -1 && i < o.length; i++) {\n            o[i]._setFlag(RowColFlags.ParentCollapsed, e, !0);\n            var l = o[i];\n            l instanceof GroupRow && l.isCollapsed && (i = l.getCellRange().bottomRow);\n          }\n        });\n      });\n      i.onGroupCollapsedChanged(l);\n    }\n  };\n  GroupRow.prototype.getCellRange = function () {\n    for (var e = this._list, t = this.index, i = e.length - 1, o = t + 1; o <= i; o++) {\n      var n = e[o];\n      if (n instanceof GroupRow && n.level <= this.level) {\n        i = o - 1;\n        break;\n      }\n    }\n    return new CellRange(t, 0, i, this.grid.columns.length - 1);\n  };\n  return GroupRow;\n}(Row);\nexport { GroupRow };\nvar RowColCollection = function (e) {\n  __extends(RowColCollection, e);\n  function RowColCollection(t, i) {\n    var o = e.call(this) || this;\n    o._frozen = 0;\n    o._lastFrozen = -1;\n    o._firstVisible = -1;\n    o._vlen = 0;\n    o._szDef = 28;\n    o._szTot = 0;\n    o._szCustom = !1;\n    o._dirty = !1;\n    o._g = asType(t, FlexGrid);\n    o._szDef = asNumber(i, !1, !0);\n    o._uid = uidGenerator();\n    return o;\n  }\n  Object.defineProperty(RowColCollection.prototype, \"grid\", {\n    get: function () {\n      return this._g;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowColCollection.prototype, \"defaultSize\", {\n    get: function () {\n      return this._szDef;\n    },\n    set: function (e) {\n      this._szCustom = !0;\n      if (this._szDef != e) {\n        this._szDef = asNumber(e, !1, !0);\n        this._dirty = !0;\n        this._g.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowColCollection.prototype, \"frozen\", {\n    get: function () {\n      return this._frozen;\n    },\n    set: function (e) {\n      if (e != this._frozen) {\n        this._frozen = asNumber(e, !1, !0);\n        this._dirty = !0;\n        this._g.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  RowColCollection.prototype.isFrozen = function (e) {\n    return e < this.frozen;\n  };\n  Object.defineProperty(RowColCollection.prototype, \"minSize\", {\n    get: function () {\n      return this._szMin;\n    },\n    set: function (e) {\n      if (e != this._szMin) {\n        this._szMin = asNumber(e, !0, !0);\n        this._dirty = !0;\n        this._g.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowColCollection.prototype, \"maxSize\", {\n    get: function () {\n      return this._szMax;\n    },\n    set: function (e) {\n      if (e != this._szMax) {\n        this._szMax = asNumber(e, !0, !0);\n        this._dirty = !0;\n        this._g.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  RowColCollection.prototype.getTotalSize = function () {\n    this._dirty && this._update();\n    return this._szTot;\n  };\n  Object.defineProperty(RowColCollection.prototype, \"visibleLength\", {\n    get: function () {\n      this._dirty && this._update();\n      return this._vlen;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  RowColCollection.prototype.getItemAt = function (e) {\n    this._dirty && this._update();\n    if (e <= 0 && this.length > 0 && this[0].renderSize) return 0;\n    for (var t, i, o = this.length, n = 0, l = o - 1; n <= l;) if ((i = this[t = n + l >>> 1])._pos >= e && t > 0) l = t - 1;else {\n      if (!(i._pos + i.renderSize <= e && t < o - 1)) {\n        for (; t > 0 && !this[t].renderSize;) t--;\n        for (; t < o - 1 && !this[t].renderSize;) t++;\n        return t;\n      }\n      n = t + 1;\n    }\n    return l;\n  };\n  RowColCollection.prototype.getNextCell = function (e, t, i) {\n    void 0 === i && (i = 0);\n    var o,\n      n = SelMove;\n    switch (t) {\n      case n.Next:\n      case n.NextCell:\n        for (o = e + 1; o < this.length; o++) if (this[o].renderSize > 0) return o;\n        break;\n      case n.NextEditableCell:\n        for (o = e + 1; o < this.length; o++) if (this[o].renderSize > 0 && !this[o].isReadOnly) return o;\n        break;\n      case n.Prev:\n      case n.PrevCell:\n        for (o = e - 1; o >= 0; o--) if (this[o].renderSize > 0) return o;\n        break;\n      case n.PrevEditableCell:\n        for (o = e - 1; o >= 0; o--) if (this[o].renderSize > 0 && !this[o].isReadOnly) return o;\n        break;\n      case n.End:\n        for (o = this.length - 1; o >= 0; o--) if (this[o].renderSize > 0) return o;\n        break;\n      case n.Home:\n        for (o = 0; o < this.length; o++) if (this[o].renderSize > 0) return o;\n        break;\n      case n.NextPage:\n        return (o = this.getItemAt(this[e].pos + this[e].renderSize + i)) < 0 ? this.getNextCell(e, SelMove.End, i) : o == e && o < this.length - 1 && this[o + 1].renderSize ? o + 1 : o;\n      case n.PrevPage:\n        return (o = this.getItemAt(this[e].pos - i)) < 0 ? this.getNextCell(e, SelMove.Home, i) : o == e && o > 0 && this[o - 1].renderSize ? o - 1 : o;\n    }\n    return e;\n  };\n  RowColCollection.prototype.canMoveElement = function (e, t, i) {\n    void 0 === i && (i = !0);\n    if (t == e) return !1;\n    if (e < 0 || e >= this.length || t >= this.length) return !1;\n    if (i) {\n      t < 0 && (t = this.length - 1);\n      for (var o = Math.min(e, t), n = Math.max(e, t), l = o; l <= n; l++) if (!this[l].allowDragging) return !1;\n    }\n    return !(this[t] instanceof _NewRowTemplate);\n  };\n  RowColCollection.prototype.moveElement = function (e, t, i) {\n    void 0 === i && (i = !0);\n    if (this.canMoveElement(e, t, i)) {\n      var o = this[e];\n      this.removeAt(e);\n      t < 0 && (t = this.length);\n      this.insert(t, o);\n      if (i) {\n        var n = this.frozen;\n        e < n && t >= n ? this.frozen-- : e >= n && t < n && this.frozen++;\n      }\n      return !0;\n    }\n    return !1;\n  };\n  RowColCollection.prototype.onCollectionChanged = function (t) {\n    void 0 === t && (t = NotifyCollectionChangedEventArgs.reset);\n    this._dirty = !0;\n    this._g.invalidate();\n    e.prototype.onCollectionChanged.call(this, t);\n  };\n  RowColCollection.prototype.push = function (t) {\n    t._setList(this);\n    return e.prototype.push.call(this, t);\n  };\n  RowColCollection.prototype.splice = function (t, i) {\n    for (var o = this, n = [], l = 2; l < arguments.length; l++) n[l - 2] = arguments[l];\n    for (var r = t; r < t + i && r < this.length; r++) {\n      var s = this[r];\n      s instanceof RowCol && s._setList(null);\n    }\n    n.forEach(function (e) {\n      return e._setList(o);\n    });\n    return e.prototype.splice.apply(this, [t, i].concat(n));\n  };\n  RowColCollection.prototype.beginUpdate = function () {\n    this._update();\n    e.prototype.beginUpdate.call(this);\n  };\n  RowColCollection.prototype._setDefaultSize = function (e) {\n    if (!this._szCustom) {\n      this.defaultSize = e;\n      this._szCustom = !1;\n    }\n  };\n  RowColCollection.prototype._update = function () {\n    if (this._dirty && !this.isUpdating) {\n      this._dirty = !1;\n      this._lastFrozen = -1;\n      this._firstVisible = -1;\n      for (var e = 0, t = 0, i = void 0, o = void 0, n = 0; n < this.length; n++) {\n        (o = this[n])._idx = n;\n        o._idxVis = e;\n        o._pos = t;\n        o._setList(this);\n        if ((i = o.renderSize) > 0) {\n          t += i;\n          e++;\n          n < this._frozen && (this._lastFrozen = n);\n        }\n        this._firstVisible < 0 && o.visible && (this._firstVisible = n);\n      }\n      this._vlen = e;\n      this._szTot = t;\n      return !0;\n    }\n    return !1;\n  };\n  return RowColCollection;\n}(ObservableArray);\nexport { RowColCollection };\nvar ColumnCollection = function (e) {\n  __extends(ColumnCollection, e);\n  function ColumnCollection() {\n    return null !== e && e.apply(this, arguments) || this;\n  }\n  ColumnCollection.prototype.getColumn = function (e) {\n    var t = isNumber(e) ? e : this.indexOf(e);\n    return t > -1 ? this[t] : null;\n  };\n  ColumnCollection.prototype.indexOf = function (t) {\n    if (t instanceof Column) return e.prototype.indexOf.call(this, t);\n    for (var i = 0; i < this.length; i++) if (this[i].name == t) return i;\n    for (i = 0; i < this.length; i++) if (this[i].binding == t) return i;\n    return -1;\n  };\n  Object.defineProperty(ColumnCollection.prototype, \"describedById\", {\n    get: function () {\n      return this._descById;\n    },\n    set: function (e) {\n      if (e != this._descById) {\n        this._descById = asString(e);\n        this._g && this._g.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnCollection.prototype, \"firstVisibleIndex\", {\n    get: function () {\n      this._dirty && this._update();\n      return this._firstVisible;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  ColumnCollection.prototype._updateStarSizes = function (e) {\n    var t,\n      i = !1,\n      o = 0;\n    e -= .5;\n    for (var n = 0; n < this.length; n++) {\n      if ((r = this[n]).isVisible) if (r._szStar) {\n        o += Column._parseStarSize(r._szStar);\n        t = r;\n      } else e -= r.renderWidth;\n    }\n    if (t) {\n      var l = e;\n      for (n = 0; n < this.length; n++) {\n        var r;\n        if ((r = this[n]).isVisible && r._szStar) {\n          var s = r._sz;\n          r == t && l > 0 ? s = l : l -= s = Math.max(0, Math.round(Column._parseStarSize(r._szStar) / o * e));\n          if (s != r._sz) {\n            r._sz = s;\n            i = !0;\n          }\n        }\n      }\n      if (i) {\n        this._dirty = !0;\n        this._update();\n      }\n      return i;\n    }\n    return !1;\n  };\n  return ColumnCollection;\n}(RowColCollection);\nexport { ColumnCollection };\nvar RowCollection = function (e) {\n  __extends(RowCollection, e);\n  function RowCollection() {\n    var t = null !== e && e.apply(this, arguments) || this;\n    t._maxLevel = -1;\n    return t;\n  }\n  Object.defineProperty(RowCollection.prototype, \"ariaLabel\", {\n    get: function () {\n      return this._ariaLabel;\n    },\n    set: function (e) {\n      if (e != this.ariaLabel) {\n        this._ariaLabel = asString(e);\n        this._g && this._g.refresh();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(RowCollection.prototype, \"maxGroupLevel\", {\n    get: function () {\n      this._dirty && this._update();\n      return this._maxLevel;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  RowCollection.prototype._update = function () {\n    var t = this;\n    if (e.prototype._update.call(this)) {\n      var i = this.grid ? this.grid.collectionView : null,\n        o = i ? i.items : null,\n        n = 0;\n      this._maxLevel = -1;\n      this.forEach(function (e) {\n        e instanceof GroupRow && e.level > t._maxLevel && (t._maxLevel = e.level);\n        var i = e.dataItem;\n        i && o ? i === o[n] ? e._idxData = n : i === o[n + 1] ? e._idxData = ++n : i !== o[e._idxData] && (e._idxData = -1) : e._idxData = -1;\n      });\n      return !0;\n    }\n    return !1;\n  };\n  return RowCollection;\n}(RowColCollection);\nexport { RowCollection };\nexport var colHdrAriaAttributes = function (e, t, i, o, n) {\n  void 0 === n && (n = !1);\n  setAttribute(e, \"role\", n ? \"rowheader\" : \"columnheader\");\n  if (t.describedById || i.columns.describedById) {\n    var l = [t.describedById, i.columns.describedById].join(\" \").trim();\n    setAttribute(e, \"aria-describedby\", l || null);\n  }\n  if (o.allowSorting) {\n    var r = \"none\";\n    switch (o._getBindingColumn(i, 0, t).currentSort) {\n      case \"+\":\n        r = \"ascending\";\n        break;\n      case \"-\":\n        r = \"descending\";\n    }\n    setAttribute(e, \"aria-sort\", r);\n  }\n  if (!o.isReadOnly) {\n    setAttribute(e, \"aria-readonly\", t.isReadOnly);\n    setAttribute(e, \"aria-required\", t.isReadOnly ? null : t.getIsRequired());\n  }\n  var s = e.closest(\".wj-row\");\n  setAttribute(s, \"role\", \"row\");\n};\nvar _ColumnGroupHandler = function () {\n  function _ColumnGroupHandler(e) {\n    this._updatingCollection = 0;\n    this._initialized = !1;\n    this._grid = e;\n    this._initializeColumnGroups();\n    this._initialized = !0;\n  }\n  Object.defineProperty(_ColumnGroupHandler.prototype, \"columnGroups\", {\n    get: function () {\n      return this._colGroups;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  _ColumnGroupHandler.prototype.createColumnGroups = function (e) {\n    this._initialized = !1;\n    this._createColumnGroups(e);\n    this._initialized = !0;\n  };\n  _ColumnGroupHandler.prototype.hasColumnGroups = function () {\n    return null != this._colGroups && this._colGroups.length > 0;\n  };\n  _ColumnGroupHandler.prototype.getGroupDefinitions = function () {\n    return this._groupDefs;\n  };\n  _ColumnGroupHandler.prototype.getColumnGroup = function (e, t) {\n    return this._getColumnGroup(e, t);\n  };\n  _ColumnGroupHandler.prototype.canMoveColumnGroup = function (e, t, i, o) {\n    if (e == i && t == o) return !1;\n    var n = this._grid,\n      l = n.columnHeaders.rows,\n      r = n.columns;\n    if (e < 0 || e >= l.length || t < 0 || t >= r.length || i < 0 || i >= l.length || o < 0 || o >= r.length) return !1;\n    var s = this._getColumnGroup(e, t),\n      a = this._getColumnGroup(i, o);\n    if (!s || !a || s == a) return !1;\n    if (s.level < a.level && s._containsGroup(a)) return !1;\n    var u = s.parentGroup,\n      c = a.parentGroup;\n    return !u || u === c || !u._isCollapseTo(s);\n  };\n  _ColumnGroupHandler.prototype.moveColumnGroup = function (e, t, i, o, n) {\n    if (this.canMoveColumnGroup(e, t, i, o)) {\n      var l = this._getColumnGroup(e, t),\n        r = this._getColumnGroup(i, o);\n      if (!l || !r || l == r) return !1;\n      if (n && !r.isEmpty) return !1;\n      var s = this._getCollection(l),\n        a = n ? r.columns : this._getCollection(r);\n      if (!s || !a) return !1;\n      var u = n ? 0 : a.indexOf(r);\n      if (u < 0) return !1;\n      !n && s != a && o > t && u++;\n      this._deferCollectionUpdate(function () {\n        if (!s.remove(l)) return !1;\n        a.insert(u, l);\n      });\n      return !0;\n    }\n    return !1;\n  };\n  _ColumnGroupHandler.prototype.handleCollectionChange = function () {\n    if (this._initialized && !this._updatingCollection) {\n      this._initialized = !1;\n      this._buildColumnGroups();\n      this._initialized = !0;\n    }\n  };\n  _ColumnGroupHandler.prototype.handlePropertyChange = function (e) {\n    if (e && this._initialized) {\n      var t = this._grid,\n        i = e._rng,\n        o = e.header;\n      if (o != e._curr_header) for (var n = i.topRow; n <= i.bottomRow; n++) for (var l = i.leftCol; l <= i.rightCol; l++) {\n        t.columnHeaders.setCellData(n, l, o);\n        e._curr_header = o;\n      }\n      e.columns.length > 0 && t.invalidate();\n    }\n  };\n  _ColumnGroupHandler.prototype._initializeColumnGroups = function () {\n    var e = this._grid,\n      t = new ColumnGroupCollection();\n    this._groupDefs = t;\n    this._colGroups = t;\n    this._colGroups._setOwner(e);\n    this._colGroups._setChangeHandler(this);\n  };\n  _ColumnGroupHandler.prototype._createColumnGroups = function (e) {\n    this._grid;\n    this._groupDefs = asArray(e);\n    this._colGroups && this._colGroups._setOwner(null);\n    this._colGroups = ColumnGroupCollection._parse(e);\n    this._buildColumnGroups();\n  };\n  _ColumnGroupHandler.prototype._buildColumnGroups = function () {\n    var e = this,\n      t = this._grid;\n    this._colGroups._removeChangeHandler();\n    this._assertColumnGroups(this._colGroups);\n    t.autoGenerateColumns = !1;\n    t.columns.clear();\n    this._colGroups._setOwner(t);\n    this._colGroups.forEach(function (e) {\n      e._beginBuild();\n    });\n    var i = 0;\n    this._colGroups.forEach(function (t) {\n      e._addColumnGroup(t);\n      i = Math.max(i, t._getMaxLevel());\n    });\n    this._colGroups.forEach(function (e) {\n      e._expandRange(i);\n    });\n    var o = t.columnHeaders.rows;\n    o.clear();\n    for (var n = 0; n <= i; n++) {\n      var l = new Row();\n      o.splice(n, 0, l);\n      n < i && (l.cssClassAll = \"wj-colgroup\");\n    }\n    for (n = 0; n < o.length; n++) for (var r = 0; r < t.columns.length; r++) {\n      var s = this._getColumnGroup(n, r);\n      if (s) {\n        var a = s.header || toHeaderCase(s.binding);\n        t.columnHeaders.setCellData(n, r, a);\n        if (s.height) {\n          var u = t.columnHeaders.rows[n].height;\n          t.columnHeaders.rows[n].height = u <= s.height ? s.height : u;\n        }\n        s._curr_header = s.header;\n      }\n    }\n    this._colGroups._setChangeHandler(this);\n    this._colGroups.forEach(function (e) {\n      e._checkIfCollapsed();\n    });\n  };\n  _ColumnGroupHandler.prototype._getColumnGroup = function (e, t) {\n    var i = this._grid;\n    if (e < i.columnHeaders.rows.length && t < i.columns.length) for (var o = this._colGroups; o;) {\n      for (var n = o, l = 0; l < o.length; l++) {\n        var r = o[l],\n          s = r._rng;\n        if (s.containsColumn(t)) {\n          if (s.containsRow(e) || 0 == r.columns.length) return r;\n          o = r.columns;\n          break;\n        }\n      }\n      if (o == n) break;\n    }\n    return null;\n  };\n  _ColumnGroupHandler.prototype._getCollection = function (e) {\n    var t = e.parentGroup;\n    return t ? t.columns : this._colGroups;\n  };\n  _ColumnGroupHandler.prototype._assertColumnGroups = function (e) {\n    var t = this;\n    assert(e instanceof ColumnGroupCollection, \"column groups contain items of invalid collection type\");\n    e.forEach(function (e) {\n      assert(e instanceof ColumnGroup, \"column groups contain items of invalid type\");\n      t._assertColumnGroups(e.columns);\n    });\n  };\n  _ColumnGroupHandler.prototype._addColumnGroup = function (e) {\n    var t = this,\n      i = this._grid;\n    e._rng.col = i.columns.length;\n    0 == e.columns.length ? i.columns.push(e) : e.columns.forEach(function (e) {\n      t._addColumnGroup(e);\n    });\n    e._rng.col2 = i.columns.length - 1;\n  };\n  _ColumnGroupHandler.prototype._beginCollectionUpdate = function () {\n    this._updatingCollection++;\n  };\n  _ColumnGroupHandler.prototype._endCollectionUpdate = function () {\n    this._updatingCollection--;\n    this._updatingCollection <= 0 && this.handleCollectionChange();\n  };\n  _ColumnGroupHandler.prototype._deferCollectionUpdate = function (e) {\n    try {\n      this._beginCollectionUpdate();\n      e();\n    } finally {\n      this._endCollectionUpdate();\n    }\n  };\n  return _ColumnGroupHandler;\n}();\nexport { _ColumnGroupHandler };\nvar ColumnGroup = function (e) {\n  __extends(ColumnGroup, e);\n  function ColumnGroup(t, i) {\n    var o = e.call(this) || this;\n    o._rng = new CellRange(0, -1);\n    o._lvl = 0;\n    o._collapsed = !1;\n    o._cols = new ColumnGroupCollection();\n    copy(o, t);\n    var n = i && i.columns;\n    n && n.indexOf(o) < 0 && n.push(o);\n    return o;\n  }\n  ColumnGroup.prototype._copy = function (e, t) {\n    if (\"columns\" == e) {\n      var i = asArray(t);\n      this._cols = ColumnGroupCollection._parse(i);\n      return !0;\n    }\n    return !1;\n  };\n  Object.defineProperty(ColumnGroup.prototype, \"columns\", {\n    get: function () {\n      return this._cols;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"columnGroups\", {\n    get: function () {\n      return this._cols;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"height\", {\n    get: function () {\n      return this._cgHeight;\n    },\n    set: function (e) {\n      this._cgHeight = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"isEmpty\", {\n    get: function () {\n      return 0 === this._cols.length;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"parentGroup\", {\n    get: function () {\n      var e = this._ownerList,\n        t = e && e.owner;\n      return t instanceof ColumnGroup ? t : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"level\", {\n    get: function () {\n      for (var e = this, t = 0; e.parentGroup;) {\n        e = e.parentGroup;\n        t++;\n      }\n      return t;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"collapseTo\", {\n    get: function () {\n      return this._collTo;\n    },\n    set: function (e) {\n      assert(isArray(e) || isString(e), \"collapseTo should be an array or a string.\");\n      if (this._collTo != e) {\n        this._collTo = e;\n        this._updateCollapsedState();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"isCollapsed\", {\n    get: function () {\n      return this._collapsed;\n    },\n    set: function (e) {\n      var t = this.grid,\n        i = null;\n      if (e != this._collapsed) if (t) {\n        i = new CellRangeEventArgs(t.columnHeaders, this._rng, this);\n        t.onColumnGroupCollapsedChanging(i) ? this._collapsed = asBoolean(e) : i = null;\n      } else this._collapsed = asBoolean(e);\n      this._updateCollapsedState();\n      t && i && t.onColumnGroupCollapsedChanged(i);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(ColumnGroup.prototype, \"grid\", {\n    get: function () {\n      var e = this._ownerList,\n        t = e && e.owner;\n      return t instanceof ColumnGroup ? t.grid : t instanceof FlexGrid ? t : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  ColumnGroup.prototype._beginBuild = function () {\n    this._lvl = 0;\n    for (var e = this.parentGroup; e; e = e.parentGroup) this._lvl++;\n    if (this.parentGroup && 0 !== this._lvl && this.parentGroup.width && (null === this.width || void 0 === this.width)) {\n      var t = 0,\n        i = 0;\n      this.parentGroup._cols.forEach(function (e) {\n        t += e.width;\n        null !== e.width && void 0 !== e.width || i++;\n      });\n      this.width = (this.parentGroup.width - t) / i;\n    }\n    this._rng = new CellRange(0, -1);\n    this._rng.row = this._rng.row2 = this._lvl;\n    this._cols.forEach(function (e) {\n      e._beginBuild();\n    });\n  };\n  ColumnGroup.prototype._setChangeHandler = function (e) {\n    this._changeHdl = e;\n    this._cols._setChangeHandler(e);\n  };\n  ColumnGroup.prototype._removeChangeHandler = function () {\n    this._changeHdl = null;\n    this._cols._removeChangeHandler();\n  };\n  ColumnGroup.prototype._setOwnerList = function (e) {\n    e != this._ownerList && (this._ownerList = e);\n  };\n  ColumnGroup.prototype._checkIfCollapsed = function () {\n    var e = this.grid;\n    (e ? e.columns : null) && (this._collapsed ? this._updateCollapsedState() : this._cols.forEach(function (e) {\n      e._checkIfCollapsed();\n    }));\n  };\n  ColumnGroup.prototype._updateCollapsedState = function () {\n    var e = this.grid,\n      t = e ? e.columns : null,\n      i = this._rng,\n      o = this._collapsed;\n    if (t) {\n      this._cols.forEach(function (e) {\n        if (e instanceof ColumnGroup) {\n          e._collapsed = o;\n          e._updateCollapsedState();\n        }\n      });\n      for (var n = this._getCollapseToIndices(), l = i.leftCol; l <= i.rightCol; l++) {\n        var r = !o || n.indexOf(l) > -1;\n        t[l]._setFlag(RowColFlags.ParentCollapsed, !r);\n      }\n    }\n  };\n  ColumnGroup.prototype._getMaxLevel = function () {\n    var e = this._lvl;\n    this.columns.forEach(function (t) {\n      e = Math.max(e, t._getMaxLevel());\n    });\n    return e;\n  };\n  ColumnGroup.prototype._expandRange = function (e) {\n    var t = e - this._getMaxLevel();\n    if (t > 0) {\n      this._rng.row2 += t;\n      this._cols.forEach(function (e) {\n        e._shiftRange(t);\n      });\n    }\n    for (var i = this.grid.columns, o = this._rng, n = o.col; n <= o.col2; n++) {\n      i[n]._rng.row2 = e;\n    }\n  };\n  ColumnGroup.prototype._shiftRange = function (e) {\n    this._rng.row += e;\n    this._rng.row2 += e;\n    this._cols.forEach(function (t) {\n      t._shiftRange(e);\n    });\n  };\n  ColumnGroup.prototype._containsGroup = function (e) {\n    for (var t = 0; t < this._cols.length; t++) {\n      var i = this._cols[t];\n      if (i == e || i._containsGroup(e)) return !0;\n    }\n    return !1;\n  };\n  ColumnGroup.prototype._isCollapseTo = function (e) {\n    var t = this.grid,\n      i = t ? t.columns : null;\n    if (!e || !i) return !1;\n    var o = this._getCollapseToBindings();\n    if (o && o.length) for (var n = 0; n < o.length; n++) switch (o[n]) {\n      case \"$first\":\n      case \"$last\":\n        continue;\n      default:\n        if (e === i.getColumn(o[n])) return !0;\n    }\n    return !1;\n  };\n  ColumnGroup.prototype._getCollapseToBindings = function () {\n    var e = this.collapseTo;\n    return isString(e) ? [e] : e;\n  };\n  ColumnGroup.prototype._getCollapseToIndices = function () {\n    var e = this.grid,\n      t = this._rng,\n      i = this._getCollapseToBindings();\n    if (i && i.length) {\n      for (var o = [], n = e.columns, l = 0; l < i.length; l++) switch (i[l]) {\n        case \"$first\":\n          o.push(t.leftCol);\n          break;\n        case \"$last\":\n          o.push(t.rightCol);\n          break;\n        default:\n          var r = n.getColumn(i[l]),\n            s = n.indexOf(r);\n          r && t.containsColumn(s) && o.push(s);\n      }\n      if (o.length) return o;\n    }\n    return [t.rightCol];\n  };\n  ColumnGroup.prototype.onPropertyChanged = function () {\n    var t = this._changeHdl;\n    t && t.handlePropertyChange(this);\n    e.prototype.onPropertyChanged.call(this);\n  };\n  return ColumnGroup;\n}(Column);\nexport { ColumnGroup };\nvar ColumnGroupCollection = function (e) {\n  __extends(ColumnGroupCollection, e);\n  function ColumnGroupCollection() {\n    return null !== e && e.apply(this, arguments) || this;\n  }\n  ColumnGroupCollection.prototype.getColumn = function (e) {\n    return isNumber(e) ? this._getColByIdx(e) : this._findColByProp(\"name\", e) || this._findColByProp(\"binding\", e);\n  };\n  Object.defineProperty(ColumnGroupCollection.prototype, \"owner\", {\n    get: function () {\n      return this._owner;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  ColumnGroupCollection.prototype.push = function (t) {\n    t._setOwnerList(this);\n    return e.prototype.push.call(this, t);\n  };\n  ColumnGroupCollection.prototype.splice = function (t, i) {\n    for (var o = this, n = [], l = 2; l < arguments.length; l++) n[l - 2] = arguments[l];\n    for (var r = t; r < t + i && r < this.length; r++) {\n      var s = this[r];\n      s instanceof ColumnGroup && s._setOwnerList(null);\n    }\n    n.forEach(function (e) {\n      return e._setOwnerList(o);\n    });\n    return e.prototype.splice.apply(this, [t, i].concat(n));\n  };\n  ColumnGroupCollection._parse = function (e) {\n    var t = null;\n    if (e) {\n      if (e instanceof ColumnGroupCollection) t = e;else {\n        t = new ColumnGroupCollection();\n        e.forEach(function (e) {\n          var i = e instanceof ColumnGroup ? e : new ColumnGroup(e);\n          t.indexOf(i) < 0 && t.push(i);\n        });\n      }\n    } else t = new ColumnGroupCollection();\n    return t;\n  };\n  ColumnGroupCollection.prototype._setChangeHandler = function (e) {\n    this._changeHdl = e;\n    this.forEach(function (t) {\n      return t._setChangeHandler(e);\n    });\n  };\n  ColumnGroupCollection.prototype._removeChangeHandler = function () {\n    this._changeHdl = null;\n    this.forEach(function (e) {\n      return e._removeChangeHandler();\n    });\n  };\n  ColumnGroupCollection.prototype._setOwner = function (e) {\n    this._owner = e;\n    this.forEach(function (e) {\n      return e.columns._setOwner(e);\n    });\n  };\n  ColumnGroupCollection.prototype._getColByIdx = function (e) {\n    return e > -1 && e < this.length ? this[e] : null;\n  };\n  ColumnGroupCollection.prototype._findColByProp = function (e, t) {\n    for (var i = 0; i < this.length; i++) {\n      var o = this[i];\n      if (o[e] === t) return o;\n      if (null !== (o = o.columns._findColByProp(e, t))) return o;\n    }\n    return null;\n  };\n  ColumnGroupCollection.prototype.onCollectionChanged = function (t) {\n    void 0 === t && (t = NotifyCollectionChangedEventArgs.reset);\n    var i = this._changeHdl;\n    i && i.handleCollectionChange();\n    e.prototype.onCollectionChanged.call(this, t);\n  };\n  return ColumnGroupCollection;\n}(ObservableArray);\nexport { ColumnGroupCollection };\n_addCultureInfo(\"FlexGrid\", {\n  groupHeaderFormat: \"{name}: <b>{value}</b> ({count:n0} items)\",\n  ariaLabels: {\n    toggleDropDown: \"Toggle Dropdown\",\n    toggleGroup: \"Toggle Group\"\n  }\n});\nexport var AllowSorting;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.SingleColumn = 1] = \"SingleColumn\";\n  e[e.MultiColumn = 2] = \"MultiColumn\";\n}(AllowSorting || (AllowSorting = {}));\nexport var AllowPinning;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.SingleColumn = 1] = \"SingleColumn\";\n  e[e.ColumnRange = 2] = \"ColumnRange\";\n  e[e.Both = 3] = \"Both\";\n}(AllowPinning || (AllowPinning = {}));\nexport var HeadersVisibility;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Column = 1] = \"Column\";\n  e[e.Row = 2] = \"Row\";\n  e[e.All = 3] = \"All\";\n}(HeadersVisibility || (HeadersVisibility = {}));\nexport var ClipStringOptions;\n!function (e) {\n  e[e.Default = 0] = \"Default\";\n  e[e.CSV = 1] = \"CSV\";\n  e[e.QuoteAll = 2] = \"QuoteAll\";\n  e[e.SkipMerged = 4] = \"SkipMerged\";\n  e[e.Unformatted = 8] = \"Unformatted\";\n  e[e.InvisibleRows = 16] = \"InvisibleRows\";\n  e[e.InvisibleColumns = 32] = \"InvisibleColumns\";\n  e[e.InvisibleCells = 48] = \"InvisibleCells\";\n}(ClipStringOptions || (ClipStringOptions = {}));\nexport var HeadersFocusability;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Column = 1] = \"Column\";\n  e[e.Row = 2] = \"Row\";\n  e[e.All = 3] = \"All\";\n}(HeadersFocusability || (HeadersFocusability = {}));\nvar FlexGrid = function (e) {\n  __extends(FlexGrid, e);\n  function FlexGrid(t, i) {\n    var o = e.call(this, t, null, !0) || this;\n    o._activeCell = null;\n    o._activePanelType = CellType.Cell;\n    o._szClient = new Size(0, 0);\n    o._szClientSB = new Size(0, 0);\n    o._offsetY = 0;\n    o._cssPage = 0;\n    o._ptScrl = new Point(0, 0);\n    o._cellPadLeft = 3;\n    o._cellPadHorz = 3;\n    o._cellPadVert = 0;\n    o._clipToScreen = !1;\n    o._anchorCell = null;\n    o._autoGenCols = !0;\n    o._autoClipboard = !0;\n    o._xOnCopyPaste = !0;\n    o._autoScroll = !0;\n    o._autoSearch = !1;\n    o._caseSensitive = !1;\n    o._readOnly = !1;\n    o._indent = 14;\n    o._autoSizeMode = AutoSizeMode.Both;\n    o._autoHeights = !1;\n    o._quickSize = null;\n    o._hdrVis = HeadersVisibility.All;\n    o._hdrFoc = HeadersFocusability.None;\n    o._alSorting = AllowSorting.SingleColumn;\n    o._alPinning = AllowPinning.None;\n    o._alAddNew = !1;\n    o._alDelete = !1;\n    o._alResizing = AllowResizing.Columns;\n    o._alDragging = AllowDragging.Columns;\n    o._alMerging = AllowMerging.None;\n    o._ssHdr = HeadersVisibility.None;\n    o._shSort = !0;\n    o._shGroups = !0;\n    o._shMarquee = !1;\n    o._shPlcHld = !1;\n    o._altStep = 1;\n    o._shErr = !0;\n    o._shDropDown = !0;\n    o._valEdt = !0;\n    o._gHdrFmt = null;\n    o._childItemsPath = null;\n    o._sortRowIndex = null;\n    o._editColIndex = null;\n    o._deferResizing = !1;\n    o._pSel = !0;\n    o._pOutline = !0;\n    o._stickyHdr = !1;\n    o._anchorCursor = !1;\n    o._copyHeaders = HeadersVisibility.None;\n    o._bigChecks = !1;\n    o._skipMerged = !1;\n    o._commitEmptyEdits = !0;\n    o._fzClone = null;\n    o._vt = 0;\n    o._vtRows = 0;\n    o._vtCols = 0;\n    o._lazyRender = !0;\n    o._refreshOnEdit = !0;\n    o._reorderCells = !0;\n    o._isISChanging = !1;\n    o._isScrollingByWheel = !1;\n    o._touchEdit = !1;\n    o.itemsSourceChanging = new Event();\n    o.itemsSourceChanged = new Event();\n    o.scrollPositionChanged = new Event();\n    o.selectionChanging = new Event();\n    o.selectionChanged = new Event();\n    o.loadingRows = new Event();\n    o.loadedRows = new Event();\n    o.updatingLayout = new Event();\n    o.updatedLayout = new Event();\n    o.resizingColumn = new Event();\n    o.resizedColumn = new Event();\n    o.autoSizingColumn = new Event();\n    o.autoSizedColumn = new Event();\n    o.starSizedColumns = new Event();\n    o.draggingColumn = new Event();\n    o.draggingColumnOver = new Event();\n    o.draggedColumn = new Event();\n    o.pinningColumn = new Event();\n    o.pinnedColumn = new Event();\n    o.resizingRow = new Event();\n    o.resizedRow = new Event();\n    o.autoSizingRow = new Event();\n    o.autoSizedRow = new Event();\n    o.draggingRow = new Event();\n    o.draggingRowOver = new Event();\n    o.draggedRow = new Event();\n    o.groupCollapsedChanging = new Event();\n    o.groupCollapsedChanged = new Event();\n    o.columnGroupCollapsedChanging = new Event();\n    o.columnGroupCollapsedChanged = new Event();\n    o.sortingColumn = new Event();\n    o.sortedColumn = new Event();\n    o.beginningEdit = new Event();\n    o.prepareCellForEdit = new Event();\n    o.cellEditEnding = new Event();\n    o.cellEditEnded = new Event();\n    o.rowEditStarting = new Event();\n    o.rowEditStarted = new Event();\n    o.rowEditEnding = new Event();\n    o.rowEditEnded = new Event();\n    o.rowAdded = new Event();\n    o.deletingRow = new Event();\n    o.deletedRow = new Event();\n    o.copying = new Event();\n    o.copied = new Event();\n    o.pasting = new Event();\n    o.pasted = new Event();\n    o.pastingCell = new Event();\n    o.pastedCell = new Event();\n    o.formatItem = new Event(function () {\n      o._clearCells();\n    });\n    o.updatingView = new Event();\n    o.updatedView = new Event();\n    o._mappedColumns = null;\n    var n = o.hostElement;\n    isIE() && (n.style.borderRadius = \"0\");\n    var l = o.getTemplate();\n    o.applyTemplate(\"wj-control wj-content wj-flexgrid\", l, {\n      _root: \"root\",\n      _eSz: \"sz\",\n      _eCt: \"cells\",\n      _fCt: \"fcells\",\n      _eTL: \"tl\",\n      _eBL: \"bl\",\n      _eCHdr: \"ch\",\n      _eRHdr: \"rh\",\n      _eCFtr: \"cf\",\n      _eTLCt: \"tlcells\",\n      _eBLCt: \"blcells\",\n      _eCHdrCt: \"chcells\",\n      _eCFtrCt: \"cfcells\",\n      _eRHdrCt: \"rhcells\",\n      _eMarquee: \"marquee\",\n      _eFocus: \"focus\"\n    });\n    setCss(o._root.parentElement, {\n      position: \"relative\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      overflow: \"hidden\",\n      minWidth: \"inherit\",\n      minHeight: \"inherit\",\n      maxWidth: \"inherit\",\n      maxHeight: \"inherit\"\n    });\n    setCss(o._root, {\n      position: \"absolute\",\n      left: \"0\",\n      top: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      minWidth: \"inherit\",\n      minHeight: \"inherit\",\n      maxWidth: \"inherit\",\n      maxHeight: \"inherit\",\n      overflow: \"auto\",\n      webkitOverflowScrolling: \"touch\"\n    });\n    setCss(o._eCt, {\n      position: \"absolute\"\n    });\n    setCss(o._eMarquee, {\n      display: \"none\"\n    });\n    setCss(o._eMarquee.firstChild, {\n      width: \"100%\",\n      height: \"100%\"\n    });\n    setCss(o._fCt, {\n      position: \"absolute\",\n      left: \"0\",\n      top: \"0\",\n      overflow: \"hidden\",\n      pointerEvents: \"none\"\n    });\n    setCss(o._eFocus, {\n      position: \"fixed\",\n      left: \"-32000px\"\n    });\n    setCss(o._eSz, {\n      position: \"relative\",\n      visibility: \"hidden\"\n    });\n    [o._eRHdr, o._eCFtr, o._eCHdr, o._eBL, o._eTL].forEach(function (e) {\n      setAttribute(e, \"aria-hidden\", !0);\n      setCss(e, {\n        position: \"absolute\",\n        overflow: \"hidden\",\n        outline: \"none\"\n      });\n      setCss(e.firstElementChild, {\n        position: \"relative\"\n      });\n    });\n    [o._eFocus, o._eMarquee, o._fCt, o._eSz].forEach(function (e) {\n      setAttribute(e, \"aria-hidden\", !0);\n    });\n    if (isIE9() || isIE10()) {\n      var r = o._eMarquee;\n      [\"click\", \"dblclick\", \"mousedown\", \"mouseup\"].forEach(function (e) {\n        o.addEventListener(r, e, function (t) {\n          var i = r.style.display;\n          r.style.display = \"none\";\n          var o = document.elementFromPoint(t.clientX, t.clientY);\n          r.style.display = i;\n          var n = document.createEvent(\"Event\");\n          n.initEvent(e, !0, !0);\n          for (var l in t) try {\n            n[l] = t[l];\n          } catch (e) {}\n          o.dispatchEvent(n);\n        });\n      });\n    }\n    n.tabIndex = -1;\n    o._uid = uidGenerator();\n    o.deferUpdate(function () {\n      var e = o._getDefaultRowHeight();\n      o._rows = new RowCollection(o, e);\n      o._cols = new ColumnCollection(o, 4 * e);\n      o._hdrRows = new RowCollection(o, e);\n      o._hdrCols = new ColumnCollection(o, Math.round(1.25 * e));\n      o._ftrRows = new RowCollection(o, e);\n      var t = CellType;\n      o._gpTL = new GridPanel(o, t.TopLeft, o._hdrRows, o._hdrCols, o._eTLCt);\n      o._gpCHdr = new GridPanel(o, t.ColumnHeader, o._hdrRows, o._cols, o._eCHdrCt);\n      o._gpRHdr = new GridPanel(o, t.RowHeader, o._rows, o._hdrCols, o._eRHdrCt);\n      o._gpCells = new GridPanel(o, t.Cell, o._rows, o._cols, o._eCt);\n      o._gpBL = new GridPanel(o, t.BottomLeft, o._ftrRows, o._hdrCols, o._eBLCt);\n      o._gpCFtr = new GridPanel(o, t.ColumnFooter, o._ftrRows, o._cols, o._eCFtrCt);\n      o.activePanel = o._gpCells;\n      o._hdrRows.push(new Row());\n      o._hdrCols.push(new Column({\n        align: \"center\"\n      }));\n      o._cf = new CellFactory();\n      o._keyHdl = new _KeyboardHandler(o);\n      o._mouseHdl = new _MouseHandler(o);\n      o._edtHdl = new _EditHandler(o);\n      o._selHdl = o._createSelHdl();\n      o._addHdl = new _AddNewHandler(o);\n      o._grpHdl = new _ColumnGroupHandler(o);\n      o._mrgMgr = new MergeManager();\n      o._bndSortConverter = o._sortConverter.bind(o);\n      o._errorTip = new Tooltip({\n        isContentHtml: !1,\n        showDelay: 0,\n        cssClass: \"wj-error-tip\"\n      });\n      o.selectionMode = SelectionMode.CellRange;\n      o._root.tabIndex = -1;\n      o.initialize(i);\n    });\n    o.addEventListener(o._root, \"scroll\", function (e) {\n      if (o._updateScrollPosition() || o._forceScrollUpdate) {\n        var t = o.activeEditor,\n          i = o.activeCell,\n          n = i ? i.className : null;\n        if (hasClass(i, \"wj-detail\") && window.wijmo.InvalidScroll) {\n          setTimeout(function () {\n            window.wijmo.InvalidScroll = !1;\n          }, 0);\n          return;\n        }\n        o._forceScrollUpdate || window.wijmo.InvalidScroll || o.finishEditing();\n        o._forceScrollUpdate = !1;\n        if (\"React\" === o.workingAs) requestAnimationFrame(function () {\n          o._updateContent(!0);\n          setTimeout(function () {\n            window.wijmo.InvalidScroll = !1;\n          }, 0);\n        });else {\n          o._updateContent(!0);\n          setTimeout(function () {\n            window.wijmo.InvalidScroll = !1;\n          }, 0);\n        }\n        var l = o.activeEditor,\n          r = o.activeCell;\n        if (l && r && t && n) {\n          l.value = t.value;\n          r.className = n;\n          o._setFocusNoScroll(l);\n        } else l && !r && (window.wijmo.InvalidScroll || o.finishEditing(!0));\n        o.frozenColumns && setTimeout(function () {\n          var e = o.columnHeaders.hostElement.style,\n            t = parseInt(e.left),\n            i = o._ptScrl.x;\n          Math.abs(t - i) > 1 && o.invalidate();\n        });\n        setTimeout(function () {\n          o._isScrollingByWheel = !1;\n          window.wijmo.InvalidScroll = !1;\n        }, 0);\n      }\n    });\n    o.addEventListener(n, \"focus\", function (e) {\n      if (n.tabIndex > -1) {\n        var t = e.target;\n        t instanceof HTMLElement && t.tabIndex < 0 && o._setFocus(!0);\n      }\n    }, !0);\n    return o;\n  }\n  Object.defineProperty(FlexGrid.prototype, \"activePanel\", {\n    get: function () {\n      return this._activePanel;\n    },\n    set: function (e) {\n      this._activePanel = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"activePanelType\", {\n    get: function () {\n      return this._activePanelType;\n    },\n    set: function (e) {\n      if (this._activePanelType !== e) {\n        Array.from(this.hostElement.getElementsByClassName(\"wj-focus-header-cell\")).forEach(function (e) {\n          e.classList.remove(\"wj-focus-header-cell\");\n          e.setAttribute(\"tabindex\", \"-1\");\n        });\n        this._activePanelType = e;\n        e !== CellType.Cell ? e !== CellType.ColumnHeader ? e !== CellType.RowHeader ? e !== CellType.TopLeft || (this.activePanel = this._gpTL) : this.activePanel = this._gpRHdr : this.activePanel = this._gpCHdr : this.activePanel = this._gpCells;\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype._handleResize = function () {\n    var t = this;\n    this._rcBounds = null;\n    this.activeEditor && this.isTouching || this._touchEdit ? setTimeout(function () {\n      if (!t.activeEditor) {\n        t._touchEdit = !0;\n        t.startEditing(!0);\n      }\n    }, 50) : e.prototype._handleResize.call(this);\n    this._touchEdit = !1;\n  };\n  Object.defineProperty(FlexGrid.prototype, \"headersVisibility\", {\n    get: function () {\n      return this._hdrVis;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, HeadersVisibility)) != this._hdrVis) {\n        this._hdrVis = e;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"headersFocusability\", {\n    get: function () {\n      return this._hdrFoc;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, HeadersFocusability)) != this._hdrFoc) {\n        this._hdrFoc = e;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"stickyHeaders\", {\n    get: function () {\n      return this._stickyHdr;\n    },\n    set: function (e) {\n      if (e != this._stickyHdr) {\n        this._stickyHdr = asBoolean(e);\n        this._updateStickyHeaders();\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"preserveSelectedState\", {\n    get: function () {\n      return this._pSel;\n    },\n    set: function (e) {\n      this._pSel = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"preserveOutlineState\", {\n    get: function () {\n      return this._pOutline;\n    },\n    set: function (e) {\n      this._pOutline = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"anchorCursor\", {\n    get: function () {\n      return this._anchorCursor;\n    },\n    set: function (e) {\n      this._anchorCursor = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"copyHeaders\", {\n    get: function () {\n      return this._copyHeaders;\n    },\n    set: function (e) {\n      this._copyHeaders = asEnum(e, HeadersVisibility);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"lazyRender\", {\n    get: function () {\n      return this._lazyRender;\n    },\n    set: function (e) {\n      this._lazyRender = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"refreshOnEdit\", {\n    get: function () {\n      return this._refreshOnEdit;\n    },\n    set: function (e) {\n      this._refreshOnEdit = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"virtualizationThreshold\", {\n    get: function () {\n      return this._vt;\n    },\n    set: function (e) {\n      this._vt = e;\n      if (isNumber(e)) this._vtRows = this._vtCols = asNumber(e);else if (e) {\n        if (isArray(e) && 2 == e.length) {\n          this._vtRows = asNumber(e[0]);\n          this._vtCols = asNumber(e[1]);\n        } else assert(!1, \"virtualizationThreshold should be a number or an array with two numbers.\");\n      } else this._vtRows = this._vtCols = 0;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoGenerateColumns\", {\n    get: function () {\n      return this._autoGenCols;\n    },\n    set: function (e) {\n      this._autoGenCols = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoClipboard\", {\n    get: function () {\n      return this._autoClipboard;\n    },\n    set: function (e) {\n      this._autoClipboard = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"expandSelectionOnCopyPaste\", {\n    get: function () {\n      return this._xOnCopyPaste;\n    },\n    set: function (e) {\n      this._xOnCopyPaste = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoScroll\", {\n    get: function () {\n      return this._autoScroll;\n    },\n    set: function (e) {\n      this._autoScroll = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoSearch\", {\n    get: function () {\n      return this._autoSearch;\n    },\n    set: function (e) {\n      this._autoSearch = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"caseSensitiveSearch\", {\n    get: function () {\n      return this._caseSensitive;\n    },\n    set: function (e) {\n      this._caseSensitive = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"columnLayout\", {\n    get: function () {\n      var e,\n        t = this._hasColumnGroups(),\n        i = t ? ColumnGroup : Column,\n        o = t ? \"columnGroups\" : \"columns\",\n        n = FlexGrid._getSerializableProperties(i),\n        l = t ? [\"collapseTo\"] : [],\n        r = [\"size\"],\n        s = new i(),\n        a = t ? this.getColumnGroups() : this.columns,\n        serializeColumns = function (e) {\n          var i = [];\n          e.forEach(function (e) {\n            var o = {};\n            n.forEach(function (t) {\n              var i = e[t];\n              (function (e, t) {\n                return t != s[e] && r.indexOf(e) < 0 && (isPrimitive(t) || l.indexOf(e) > -1);\n              })(t, i) && (o[t] = i);\n            });\n            if (t) {\n              var a = e.columns;\n              a.length && (o.columns = serializeColumns(a));\n            }\n            i.push(o);\n          });\n          return i;\n        },\n        u = serializeColumns(a);\n      return JSON.stringify(((e = {})[o] = u, e));\n    },\n    set: function (e) {\n      var t = this,\n        i = JSON.parse(asString(e));\n      assert(i, \"Invalid columnLayout data.\");\n      this.columns.deferUpdate(function () {\n        t.columns.clear();\n        t._hasColumnGroups() && (t.columnGroups = new ColumnGroupCollection());\n        t.initialize(i);\n      });\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"columnGroups\", {\n    get: function () {\n      return this._grpHdl.getGroupDefinitions();\n    },\n    set: function (e) {\n      this.columns.clear();\n      this._grpHdl.createColumnGroups(asArray(e));\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.getColumnGroups = function () {\n    return this._grpHdl.columnGroups;\n  };\n  Object.defineProperty(FlexGrid.prototype, \"isReadOnly\", {\n    get: function () {\n      return this._readOnly;\n    },\n    set: function (e) {\n      if (e != this._readOnly) {\n        this._readOnly = asBoolean(e);\n        this.finishEditing();\n        this.invalidate(!0);\n        this._addHdl.updateNewRowTemplate();\n        toggleClass(this.hostElement, \"wj-state-readonly\", this.isReadOnly);\n        this._setAria(\"readonly\", this.isReadOnly ? \"true\" : null);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"bigCheckboxes\", {\n    get: function () {\n      return this._bigChecks;\n    },\n    set: function (e) {\n      this._bigChecks = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"skipMerged\", {\n    get: function () {\n      return this._skipMerged;\n    },\n    set: function (e) {\n      this._skipMerged = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"isDisabled\", {\n    get: function () {\n      return this._e && null != this._e.getAttribute(\"disabled\");\n    },\n    set: function (e) {\n      if ((e = asBoolean(e, !0)) != this.isDisabled) {\n        var t = this._e;\n        if (t) {\n          enable(t, !e);\n          this._updateTabIndex();\n          this.invalidate();\n        }\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"imeEnabled\", {\n    get: function () {\n      return null != this._imeHdl;\n    },\n    set: function (e) {\n      if (asBoolean(e) != this.imeEnabled && this.finishEditing()) {\n        var t = this.containsFocus();\n        if (this._imeHdl) {\n          this._imeHdl.dispose();\n          this._imeHdl = null;\n        }\n        e && (this._imeHdl = new _ImeHandler(this));\n        t && this.focus();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowResizing\", {\n    get: function () {\n      return this._alResizing;\n    },\n    set: function (e) {\n      this._alResizing = asEnum(e, AllowResizing);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"deferResizing\", {\n    get: function () {\n      return this._deferResizing;\n    },\n    set: function (e) {\n      this._deferResizing = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoSizeMode\", {\n    get: function () {\n      return this._autoSizeMode;\n    },\n    set: function (e) {\n      this._autoSizeMode = asEnum(e, AutoSizeMode);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"autoRowHeights\", {\n    get: function () {\n      return this._autoHeights;\n    },\n    set: function (e) {\n      this._autoHeights = asBoolean(e);\n      this._autoRowHeights();\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"quickAutoSize\", {\n    get: function () {\n      return this._quickSize;\n    },\n    set: function (e) {\n      this._quickSize = asBoolean(e, !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype._getQuickAutoSize = function () {\n    return isBoolean(this._quickSize) ? this._quickSize : !this.formatItem.hasHandlers && null == this.itemFormatter;\n  };\n  Object.defineProperty(FlexGrid.prototype, \"allowSorting\", {\n    get: function () {\n      return this._alSorting;\n    },\n    set: function (e) {\n      isBoolean(e) && (e = e ? AllowSorting.SingleColumn : AllowSorting.None);\n      this._alSorting = asEnum(e, AllowSorting);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowPinning\", {\n    get: function () {\n      return this._alPinning;\n    },\n    set: function (e) {\n      if (e != this._alPinning) {\n        isBoolean(e) && (e = e ? AllowPinning.SingleColumn : AllowPinning.None);\n        this._alPinning = asEnum(e, AllowPinning);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowAddNew\", {\n    get: function () {\n      return this._alAddNew;\n    },\n    set: function (e) {\n      if (e != this._alAddNew) {\n        this._alAddNew = asBoolean(e);\n        this._addHdl.updateNewRowTemplate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"newRowAtTop\", {\n    get: function () {\n      return this._addHdl.newRowAtTop;\n    },\n    set: function (e) {\n      this._addHdl.newRowAtTop = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowDelete\", {\n    get: function () {\n      return this._alDelete;\n    },\n    set: function (e) {\n      e != this._alDelete && (this._alDelete = asBoolean(e));\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowMerging\", {\n    get: function () {\n      return this._alMerging;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, AllowMerging)) != this._alMerging) {\n        this._alMerging = e;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showSelectedHeaders\", {\n    get: function () {\n      return this._ssHdr;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, HeadersVisibility)) != this._ssHdr) {\n        this._ssHdr = e;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showMarquee\", {\n    get: function () {\n      return this._shMarquee;\n    },\n    set: function (e) {\n      if (e != this._shMarquee) {\n        this._shMarquee = asBoolean(e);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showPlaceholders\", {\n    get: function () {\n      return this._shPlcHld;\n    },\n    set: function (e) {\n      this._shPlcHld = asBoolean(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showSort\", {\n    get: function () {\n      return this._shSort;\n    },\n    set: function (e) {\n      if (e != this._shSort) {\n        this._shSort = asBoolean(e);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showGroups\", {\n    get: function () {\n      return this._shGroups;\n    },\n    set: function (e) {\n      if (e != this._shGroups) {\n        this._shGroups = asBoolean(e);\n        this._bindGrid(!1);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"alternatingRowStep\", {\n    get: function () {\n      return this._altStep;\n    },\n    set: function (e) {\n      if (e != this._altStep) {\n        this._altStep = asInt(e, !1, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showAlternatingRows\", {\n    get: function () {\n      return this._altStep > 0;\n    },\n    set: function (e) {\n      _deprecated(\"showAlternatingRows\", \"alternatingRowStep\");\n      this.alternatingRowStep = e ? 1 : 0;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showErrors\", {\n    get: function () {\n      return this._shErr;\n    },\n    set: function (e) {\n      if (e != this._shErr) {\n        this._clearCells();\n        this._shErr = asBoolean(e);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"errorTip\", {\n    get: function () {\n      return this._errorTip;\n    },\n    set: function (e) {\n      if (e != this._errorTip) {\n        this._clearCells();\n        this._errorTip = asType(e, Tooltip, !0);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"itemValidator\", {\n    get: function () {\n      return this._itemValidator;\n    },\n    set: function (e) {\n      if (e != this.itemValidator) {\n        this._itemValidator = asFunction(e);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"validateEdits\", {\n    get: function () {\n      return this._valEdt;\n    },\n    set: function (e) {\n      this._setvalidateEdits(e);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype._setvalidateEdits = function (e) {\n    this._valEdt = asBoolean(e);\n  };\n  Object.defineProperty(FlexGrid.prototype, \"groupHeaderFormat\", {\n    get: function () {\n      return this._gHdrFmt;\n    },\n    set: function (e) {\n      if (e != this._gHdrFmt) {\n        this._gHdrFmt = asString(e);\n        this._bindGrid(!1);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"allowDragging\", {\n    get: function () {\n      return this._alDragging;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, AllowDragging)) != this._alDragging) {\n        this._alDragging = e;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"ariaLabel\", {\n    get: function () {\n      return this._ariaLabel;\n    },\n    set: function (e) {\n      this._ariaLabel = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"itemsSource\", {\n    get: function () {\n      return this._items;\n    },\n    set: function (e) {\n      var t = this;\n      if (e != this._items) {\n        var i = new CancelEventArgs();\n        if (this.onItemsSourceChanging(i)) {\n          if (this._cv) {\n            (o = this._cv).currentChanged.removeHandler(null, this);\n            o.collectionChanged.removeHandler(null, this);\n            o instanceof CollectionView && o.sortConverter == this._bndSortConverter && (o.sortConverter = null);\n            this._cv = null;\n          }\n          this._items = e;\n          this._cv = this._getCollectionView(e);\n          this._lastCount = 0;\n          if (this._cv) {\n            var o;\n            (o = this._cv).currentChanged.addHandler(function (e, i) {\n              return t._cvCurrentChanged(e, i);\n            }, this);\n            o.collectionChanged.addHandler(function (e, i) {\n              return t._cvCollectionChanged(e, i);\n            }, this);\n            o instanceof CollectionView && !o.sortConverter && (o.sortConverter = this._bndSortConverter);\n          }\n          this._isISChanging = !0;\n          this._bindGrid(!0);\n          this._isISChanging = !1;\n          this.onItemsSourceChanged(i);\n        }\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"collectionView\", {\n    get: function () {\n      return this._cv;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"editableCollectionView\", {\n    get: function () {\n      return tryCast(this._cv, \"IEditableCollectionView\");\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"childItemsPath\", {\n    get: function () {\n      return this._childItemsPath;\n    },\n    set: function (e) {\n      if (e != this._childItemsPath) {\n        assert(null == e || isArray(e) || isString(e), \"childItemsPath should be an array or a string.\");\n        this._childItemsPath = e;\n        this._bindGrid(!0);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"rowHeaderPath\", {\n    get: function () {\n      return this._rowHdrPath ? this._rowHdrPath.path : null;\n    },\n    set: function (e) {\n      if (e != this.rowHeaderPath) {\n        e = asString(e);\n        this._rowHdrPath = e ? new Binding(e) : null;\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"cells\", {\n    get: function () {\n      return this._gpCells;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"columnHeaders\", {\n    get: function () {\n      return this._gpCHdr;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"columnFooters\", {\n    get: function () {\n      return this._gpCFtr;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"rowHeaders\", {\n    get: function () {\n      return this._gpRHdr;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"topLeftCells\", {\n    get: function () {\n      return this._gpTL;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"bottomLeftCells\", {\n    get: function () {\n      return this._gpBL;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"rows\", {\n    get: function () {\n      return this._rows;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"columns\", {\n    get: function () {\n      return this._cols;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.getColumn = function (e, t) {\n    if (this._hasColumnGroups() && t) {\n      var i = this.getColumnGroups();\n      return null !== i ? i.getColumn(e) : null;\n    }\n    return this.columns.getColumn(e);\n  };\n  Object.defineProperty(FlexGrid.prototype, \"frozenRows\", {\n    get: function () {\n      return this.rows.frozen;\n    },\n    set: function (e) {\n      this.rows.frozen = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"frozenColumns\", {\n    get: function () {\n      return this.columns.frozen;\n    },\n    set: function (e) {\n      this.columns.frozen = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"cloneFrozenCells\", {\n    get: function () {\n      return this._fzClone;\n    },\n    set: function (e) {\n      if (e != this._fzClone) {\n        setText(this._fCt, null);\n        this._fzClone = asBoolean(e, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"sortRowIndex\", {\n    get: function () {\n      return this._sortRowIndex;\n    },\n    set: function (e) {\n      if (e != this._sortRowIndex) {\n        this._sortRowIndex = asNumber(e, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"editColumnIndex\", {\n    get: function () {\n      return this._editColIndex;\n    },\n    set: function (e) {\n      if (e != this._editColIndex) {\n        this._editColIndex = asNumber(e, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"scrollPosition\", {\n    get: function () {\n      return this._ptScrl.clone();\n    },\n    set: function (e) {\n      var t = this._root,\n        i = -e.x;\n      if (this.rightToLeft) switch (FlexGrid._getRtlMode()) {\n        case \"rev\":\n          i = t.scrollWidth - t.clientWidth + e.x;\n          break;\n        case \"neg\":\n          i = e.x;\n          break;\n        default:\n          i = -e.x;\n      }\n      t.scrollLeft = i;\n      t.scrollTop = -e.y;\n      this._updateScrollPosition() && (this._forceScrollUpdate = !0);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"commitEmptyEdits\", {\n    get: function () {\n      return this._commitEmptyEdits;\n    },\n    set: function (e) {\n      if (e != this._commitEmptyEdits) {\n        this._commitEmptyEdits = asBoolean(e);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"clientSize\", {\n    get: function () {\n      return this._szClient;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"controlRect\", {\n    get: function () {\n      this._rcBounds || (this._rcBounds = getElementRect(this._root));\n      return this._rcBounds;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"scrollSize\", {\n    get: function () {\n      return new Size(this._gpCells.width, this._heightBrowser);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"viewRange\", {\n    get: function () {\n      return this._gpCells.viewRange;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"cellFactory\", {\n    get: function () {\n      return this._cf;\n    },\n    set: function (e) {\n      if (e != this._cf) {\n        this._clearCells();\n        this._cf = asType(e, CellFactory, !1);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"itemFormatter\", {\n    get: function () {\n      return this._itemFormatter;\n    },\n    set: function (e) {\n      if (e != this._itemFormatter) {\n        this._clearCells();\n        this._itemFormatter = asFunction(e);\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.canEditCell = function (e, t) {\n    return this._edtHdl._allowEdit(e, t);\n  };\n  FlexGrid.prototype.getCellData = function (e, t, i) {\n    return this.cells.getCellData(e, t, i);\n  };\n  FlexGrid.prototype.getCellBoundingRect = function (e, t, i) {\n    return this.cells.getCellBoundingRect(e, t, i);\n  };\n  FlexGrid.prototype.setCellData = function (e, t, i, o, n) {\n    void 0 === o && (o = !0);\n    void 0 === n && (n = !0);\n    return this.cells.setCellData(e, t, i, o, n);\n  };\n  FlexGrid.prototype.hitTest = function (e, t) {\n    isNumber(e) && isNumber(t) && (e = new Point(e, t));\n    isBoolean(t) && t && (this._rcBounds = null);\n    return new HitTestInfo(this, e);\n  };\n  FlexGrid.prototype.getClipString = function (e, t, i, o) {\n    var n;\n    n = null == t || isBoolean(t) ? t ? ClipStringOptions.CSV : ClipStringOptions.Default : t;\n    assert(isNumber(n), \"Unexpected value for ClipStringOptions parameter.\");\n    var l = this.selection,\n      r = this.getMergedRange(this.cells, l.row, l.col, !1);\n    (r && (r.columnSpan > 1 || r.rowSpan > 1) || this.skipMerged) && (n |= ClipStringOptions.SkipMerged);\n    return this._edtHdl.getClipString(e, n, i, o);\n  };\n  FlexGrid.prototype.setClipString = function (e, t) {\n    this._edtHdl.setClipString(e, t);\n  };\n  FlexGrid.prototype.focus = function (e) {\n    this.isDisabled || this._setFocus(e);\n  };\n  FlexGrid.prototype.dispose = function () {\n    this.finishEditing(!0);\n    this.itemsSource = null;\n    e.prototype.dispose.call(this);\n  };\n  FlexGrid.prototype.refresh = function (t) {\n    void 0 === t && (t = !0);\n    e.prototype.refresh.call(this, t);\n    this.finishEditing();\n    if (t) {\n      this._updateColumnTypes();\n      this.scrollPosition = this._ptScrl;\n      this._updateDefaultSizes();\n      clearTimeout(this._toInv);\n      this._toInv = null;\n    }\n    this.refreshCells(t);\n    var i = this._e;\n    i && (this._szCtl = new Size(i.offsetWidth, i.offsetHeight));\n  };\n  FlexGrid.prototype.refreshCells = function (e, t, i) {\n    this.isUpdating || (e ? this._updateLayout() : this._updateContent(t, i));\n  };\n  FlexGrid.prototype.refreshRange = function (e) {\n    for (var t = e.topRow; t <= e.bottomRow; t++) for (var i = e.leftCol; i <= e.rightCol; i++) {\n      var o = this.cells.getCellElement(t, i);\n      if (o) {\n        var n = o[GridPanel._INDEX_KEY];\n        this.cellFactory.updateCell(this.cells, t, i, o, n.rng);\n      }\n    }\n  };\n  FlexGrid.prototype.autoSizeColumn = function (e, t, i) {\n    void 0 === t && (t = !1);\n    void 0 === i && (i = 4);\n    this.autoSizeColumns(e, e, t, i);\n  };\n  FlexGrid.prototype.autoSizeColumns = function (e, t, i, o) {\n    var n = this;\n    void 0 === i && (i = !1);\n    void 0 === o && (o = 4);\n    var l = 0,\n      r = i ? this.topLeftCells : this.columnHeaders,\n      s = i ? this.bottomLeftCells : this.columnFooters,\n      a = i ? this.rowHeaders : this.cells,\n      u = this.viewRange;\n    e = null == e ? 0 : asInt(e);\n    t = null == t ? a.columns.length - 1 : asInt(t);\n    u.row = Math.max(0, u.row - 1e3);\n    u.row2 = Math.min(u.row2 + 1e3, this.rows.length - 1);\n    this.finishEditing() && this.columns.deferUpdate(function () {\n      setCss(n._eCt, {\n        width: n._gpCells.width\n      });\n      for (var i = createElement(\"<div \" + FlexGrid._WJS_MEASURE + '=\"true\"/>', a.hostElement, {\n          visibility: \"hidden\"\n        }), c = n._getCanvasContext(), d = e; d <= t && d > -1 && d < a.columns.length; d++) {\n        var h = a.columns[d];\n        if (h.isVisible) {\n          l = 0;\n          if (n.autoSizeMode & AutoSizeMode.Headers) {\n            for (var p = 0; p < r.rows.length; p++) r.rows[p].isVisible && (l = Math.max(n._getDesiredWidth(r, p, d, i), l));\n            for (p = 0; p < s.rows.length; p++) s.rows[p].isVisible && (l = Math.max(n._getDesiredWidth(s, p, d, i), l));\n          }\n          if (n.autoSizeMode & AutoSizeMode.Cells && u.row > -1 && u.row2 > -1) if (h._getQuickAutoSize()) {\n            p = n._getWidestRow(a, u, d, c);\n            l = Math.max(n._getDesiredWidth(a, p, d, i), l);\n          } else for (p = u.row; p <= u.row2 && p < a.rows.length; p++) a.rows[p].isVisible && (l = Math.max(n._getDesiredWidth(a, p, d, i), l));\n          l > 0 && (h.width = l + o + 2);\n        }\n      }\n      n.cellFactory.disposeCell(i);\n      removeChild(i);\n    });\n  };\n  FlexGrid.prototype.autoSizeRow = function (e, t, i) {\n    void 0 === t && (t = !1);\n    void 0 === i && (i = 0);\n    this.autoSizeRows(e, e, t, i);\n  };\n  FlexGrid.prototype.autoSizeRows = function (e, t, i, o) {\n    var n = this;\n    void 0 === i && (i = !1);\n    void 0 === o && (o = 0);\n    var l = 0,\n      r = 1 == i ? this.topLeftCells : null == i ? this.bottomLeftCells : this.rowHeaders,\n      s = 1 == i ? this.columnHeaders : null == i ? this.columnFooters : this.cells;\n    o = asNumber(o);\n    e = null == e ? 0 : asInt(e);\n    if ((t = null == t ? s.rows.length - 1 : asInt(t)) >= e && this.finishEditing()) {\n      setCss(this._eCt, {\n        width: this._gpCells.width\n      });\n      var a = createElement(\"<div \" + FlexGrid._WJS_MEASURE + '=\"true\"/>', s.hostElement, {\n        visibility: \"hidden\"\n      });\n      this.rows.deferUpdate(function () {\n        for (var i = {}, u = n._autoSizeMode, c = AutoSizeMode, d = e; d <= t && d > -1 && d < s.rows.length; d++) {\n          if (s.rows[d].isVisible) {\n            l = 0;\n            u & c.Headers && (l = n._getDesiredRowHeight(r, d, a, i));\n            u & c.Cells && (l = Math.max(n._getDesiredRowHeight(s, d, a, i), l));\n            l > 0 && (s.rows[d].height = l + o);\n          }\n        }\n      });\n      this.cellFactory.disposeCell(a);\n      removeChild(a);\n    }\n  };\n  Object.defineProperty(FlexGrid.prototype, \"treeIndent\", {\n    get: function () {\n      return this._indent;\n    },\n    set: function (e) {\n      if (e != this._indent) {\n        this._indent = asNumber(e, !1, !0);\n        this.columns.onCollectionChanged();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.collapseGroupsToLevel = function (e) {\n    var t = this;\n    this.finishEditing() && this.deferUpdate(function () {\n      var i = t.rows;\n      i.deferUpdate(function () {\n        for (var t = 0; t < i.length; t++) {\n          var o = i[t];\n          o instanceof GroupRow && (o.isCollapsed = o.level >= e);\n        }\n      });\n    });\n  };\n  Object.defineProperty(FlexGrid.prototype, \"selectionMode\", {\n    get: function () {\n      return this._selHdl.selectionMode;\n    },\n    set: function (e) {\n      if ((e = asEnum(e, SelectionMode)) != this.selectionMode) {\n        this._selHdl.selectionMode = e;\n        this._updateTabIndex();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"selection\", {\n    get: function () {\n      return this._selHdl.selection.clone();\n    },\n    set: function (e) {\n      this._selHdl.selection = e;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.select = function (e, t) {\n    void 0 === t && (t = !0);\n    this.activePanelType = CellType.Cell;\n    return this._selHdl.select(e, t);\n  };\n  FlexGrid.prototype.selectAll = function () {\n    var e = this.rows.length,\n      t = this.columns.length;\n    return !(!e || !t) && this.select(new CellRange(0, 0, e - 1, t - 1), !1);\n  };\n  FlexGrid.prototype.getSelectedState = function (e, t) {\n    return this.cells.getSelectedState(e, t);\n  };\n  Object.defineProperty(FlexGrid.prototype, \"selectedRows\", {\n    get: function () {\n      var e = this,\n        t = this.selectionMode,\n        i = this.rows.filter(function (e) {\n          return e.isSelected;\n        });\n      if (0 == i.length && t != SelectionMode.None) {\n        var o = [];\n        this.selectedRanges.forEach(function (t) {\n          for (var i = t.topRow; i <= t.bottomRow && i > -1 && i < e.rows.length; i++) o.indexOf(i) < 0 && o.push(i);\n        });\n        o.sort();\n        i = o.map(function (t) {\n          return e.rows[t];\n        });\n      }\n      return i;\n    },\n    set: function (e) {\n      var t = this;\n      assert(this.selectionMode == SelectionMode.ListBox, \"This property can be set only in ListBox mode.\");\n      e = asArray(e);\n      this.deferUpdate(function () {\n        for (var i = 0, o = !0; i < t.rows.length; i++) {\n          var n = t.rows[i],\n            l = e && e.indexOf(n) > -1;\n          if (l && o) {\n            o = !1;\n            t.select(i, t.selection.col);\n          }\n          n.isSelected = l;\n        }\n      });\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"selectedItems\", {\n    get: function () {\n      var e = [];\n      this.selectedRows.forEach(function (t) {\n        var i = t ? t.dataItem : null;\n        i && e.indexOf(i) < 0 && e.push(i);\n      });\n      return e;\n    },\n    set: function (e) {\n      var t = this;\n      assert(this.selectionMode == SelectionMode.ListBox, \"This property can be set only in ListBox mode.\");\n      e = asArray(e);\n      this.deferUpdate(function () {\n        for (var i = 0, o = !0; i < t.rows.length; i++) {\n          var n = t.rows[i],\n            l = e && e.indexOf(n.dataItem) > -1;\n          if (l && o) {\n            o = !1;\n            t.select(i, t.selection.col);\n          }\n          n.isSelected = l;\n        }\n      });\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"selectedRanges\", {\n    get: function () {\n      var e = [this.selection];\n      this._selHdl.extendedSelection.forEach(function (t) {\n        e.push(t);\n      });\n      return e;\n    },\n    set: function (e) {\n      if ((e = asArray(e)) && e.length > 0) {\n        this.select(e[0]);\n        if (this.selectionMode == SelectionMode.MultiRange) {\n          var t = this._selHdl.extendedSelection;\n          t.deferUpdate(function () {\n            t.clear();\n            for (var i = 1; i < e.length; i++) t.push(e[i]);\n          });\n        }\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.scrollIntoView = function (e, t, i) {\n    (null == this._maxOffsetY || this._rows._dirty || this._cols._dirty) && this._updateLayout();\n    var o = this.scrollPosition,\n      n = this._szClient,\n      l = n.width,\n      r = n.height - this._gpCFtr.rows.getTotalSize(),\n      s = this.cells._getFrozenPos();\n    if ((e = asInt(e)) > -1 && e < this._rows.length && e >= this._rows.frozen) {\n      var a = this._rows[e],\n        u = this._getCssPage(a.pos);\n      if (u != this._cssPage) {\n        for (var c = this._maxOffsetY, d = Math.round(c * u); d > a.pos; u -= .1) d = Math.round(c * u);\n        this._offsetY = d;\n      }\n      var h = a.pos - this._offsetY,\n        p = h + a.renderSize;\n      p > r - o.y && (o.y = Math.max(-h, r - p));\n      h - s.y < -o.y && (o.y = -(h - s.y));\n      u != this._cssPage && (this._cssPage = this._getCssPage(-o.y));\n    }\n    isString(t) && (t = this.columns.indexOf(t));\n    if ((t = asInt(t)) > -1 && t < this._cols.length && t >= this._cols.frozen) {\n      var f = this._cols[t],\n        g = f.pos + f.renderSize;\n      g > -o.x + l && (o.x = Math.max(-f.pos, l - g));\n      f.pos - s.x < -o.x && (o.x = -(f.pos - s.x));\n    }\n    if (!o.equals(this._ptScrl)) {\n      this.scrollPosition = o;\n      if (i) {\n        this._updateScrollPosition();\n        this._forceScrollUpdate = !1;\n        this.refresh();\n      }\n      return !0;\n    }\n    if (this._activeCell && e > -1 && t > -1) {\n      var _ = this._root,\n        m = _.scrollWidth == _.clientWidth,\n        C = _.scrollHeight == _.clientHeight;\n      if (m || C) {\n        var w = this._activeCell.getBoundingClientRect(),\n          v = innerWidth,\n          y = innerHeight,\n          b = w.right < 0 || w.left > v,\n          R = w.bottom < 0 || w.top > y;\n        o.x = pageXOffset + (w.left < 0 ? w.left : w.right > v ? w.right - v : 0);\n        o.y = pageYOffset + (w.top < 0 ? w.top : w.bottom > y ? w.bottom - y : 0);\n        b && m && R && C ? scrollTo(o.x, o.y) : b && m ? scrollTo(o.x, document.documentElement.scrollLeft) : R && C && scrollTo(document.documentElement.scrollTop, o.y);\n      }\n    }\n    return !1;\n  };\n  FlexGrid.prototype.isRangeValid = function (e) {\n    return e && e.isValid && e.bottomRow < this.rows.length && e.rightCol < this.columns.length;\n  };\n  FlexGrid.prototype.startEditing = function (e, t, i, o, n) {\n    void 0 === e && (e = !0);\n    return this._edtHdl.startEditing(e, t, i, o, n);\n  };\n  FlexGrid.prototype.finishEditing = function (e) {\n    return this._edtHdl.finishEditing(e);\n  };\n  Object.defineProperty(FlexGrid.prototype, \"activeCell\", {\n    get: function () {\n      return this._activeCell;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"activeEditor\", {\n    get: function () {\n      var e = this._edtHdl;\n      return e ? e.activeEditor : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"editRange\", {\n    get: function () {\n      var e = this._edtHdl.editRange;\n      return e ? e.clone() : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"mergeManager\", {\n    get: function () {\n      return this._mrgMgr;\n    },\n    set: function (e) {\n      if (e != this._mrgMgr) {\n        this._mrgMgr = asType(e, MergeManager, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.getMergedRange = function (e, t, i, o) {\n    void 0 === o && (o = !0);\n    return this._mrgMgr ? this._mrgMgr.getMergedRange(e, t, i, o) : null;\n  };\n  Object.defineProperty(FlexGrid.prototype, \"keyActionTab\", {\n    get: function () {\n      return this._keyHdl._kaTab;\n    },\n    set: function (e) {\n      this._keyHdl._kaTab = asEnum(e, KeyAction);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"keyActionEnter\", {\n    get: function () {\n      return this._keyHdl._kaEnter;\n    },\n    set: function (e) {\n      this._keyHdl._kaEnter = asEnum(e, KeyAction);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"preserveWhiteSpace\", {\n    get: function () {\n      return hasClass(this.hostElement, FlexGrid._WJS_WSPRE);\n    },\n    set: function (e) {\n      toggleClass(this.hostElement, FlexGrid._WJS_WSPRE, asBoolean(e));\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(FlexGrid.prototype, \"showDropDown\", {\n    get: function () {\n      return this._shDropDown;\n    },\n    set: function (e) {\n      if (e != this._shDropDown) {\n        this._shDropDown = asBoolean(e, !0);\n        this.invalidate();\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.toggleDropDownList = function () {\n    if (!this._tglDropDown) {\n      this._tglDropDown = !0;\n      this._edtHdl._toggleListBox(null);\n      this._tglDropDown = !1;\n    }\n    return null != this._edtHdl._lbx;\n  };\n  Object.defineProperty(FlexGrid, \"defaultTypeWidth\", {\n    get: function () {\n      return FlexGrid._defTypeWidth;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  FlexGrid.prototype.onItemsSourceChanging = function (e) {\n    this.itemsSourceChanging.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onItemsSourceChanged = function (e) {\n    this.itemsSourceChanged.raise(this, e);\n  };\n  FlexGrid.prototype.onScrollPositionChanged = function (e) {\n    this.scrollPositionChanged.raise(this, e);\n  };\n  FlexGrid.prototype.onSelectionChanging = function (e) {\n    this.selectionChanging.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onSelectionChanged = function (e) {\n    this.selectionChanged.raise(this, e);\n  };\n  FlexGrid.prototype.onLoadingRows = function (e) {\n    this.loadingRows.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onLoadedRows = function (e) {\n    this.loadedRows.raise(this, e);\n    this._autoRowHeights();\n  };\n  FlexGrid.prototype.onUpdatingLayout = function (e) {\n    this.updatingLayout.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onUpdatedLayout = function (e) {\n    this.updatedLayout.raise(this, e);\n  };\n  FlexGrid.prototype.onResizingColumn = function (e) {\n    this.resizingColumn.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onResizedColumn = function (e) {\n    this.resizedColumn.raise(this, e);\n    this._autoRowHeights();\n  };\n  FlexGrid.prototype.onAutoSizingColumn = function (e) {\n    this.autoSizingColumn.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onAutoSizedColumn = function (e) {\n    this.autoSizedColumn.raise(this, e);\n  };\n  FlexGrid.prototype.onStarSizedColumns = function (e) {\n    this.starSizedColumns.raise(this, e);\n    this._autoRowHeights();\n  };\n  FlexGrid.prototype.onDraggingColumn = function (e) {\n    this.draggingColumn.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDraggingColumnOver = function (e) {\n    this.draggingColumnOver.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDraggedColumn = function (e) {\n    this.draggedColumn.raise(this, e);\n  };\n  FlexGrid.prototype.onPinningColumn = function (e) {\n    this.pinningColumn.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onPinnedColumn = function (e) {\n    this.pinnedColumn.raise(this, e);\n  };\n  FlexGrid.prototype.onResizingRow = function (e) {\n    this.resizingRow.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onResizedRow = function (e) {\n    this.resizedRow.raise(this, e);\n  };\n  FlexGrid.prototype.onAutoSizingRow = function (e) {\n    this.autoSizingRow.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onAutoSizedRow = function (e) {\n    this.autoSizedRow.raise(this, e);\n  };\n  FlexGrid.prototype.onDraggingRow = function (e) {\n    this.draggingRow.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDraggingRowOver = function (e) {\n    this.draggingRowOver.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDraggedRow = function (e) {\n    this.draggedRow.raise(this, e);\n  };\n  FlexGrid.prototype.onGroupCollapsedChanging = function (e) {\n    this.groupCollapsedChanging.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onGroupCollapsedChanged = function (e) {\n    this.groupCollapsedChanged.raise(this, e);\n  };\n  FlexGrid.prototype.onColumnGroupCollapsedChanging = function (e) {\n    this.columnGroupCollapsedChanging.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onColumnGroupCollapsedChanged = function (e) {\n    this.columnGroupCollapsedChanged.raise(this, e);\n  };\n  FlexGrid.prototype.onSortingColumn = function (e) {\n    this.sortingColumn.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onSortedColumn = function (e) {\n    this.sortedColumn.raise(this, e);\n  };\n  FlexGrid.prototype.onBeginningEdit = function (e) {\n    this._addHdl._beginningEdit(this, e);\n    e.cancel || this.beginningEdit.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onPrepareCellForEdit = function (e) {\n    this.prepareCellForEdit.raise(this, e);\n  };\n  FlexGrid.prototype.onCellEditEnding = function (e) {\n    this.cellEditEnding.raise(this, e);\n    return !e.cancel && !e.stayInEditMode;\n  };\n  FlexGrid.prototype.onCellEditEnded = function (e) {\n    this.cellEditEnded.raise(this, e);\n    this._autoRowHeights();\n  };\n  FlexGrid.prototype.onRowEditStarting = function (e) {\n    this._addHdl._rowEditStarting(this, e);\n    e.cancel || this.rowEditStarting.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onRowEditStarted = function (e) {\n    this.rowEditStarted.raise(this, e);\n  };\n  FlexGrid.prototype.onRowEditEnding = function (e) {\n    this._addHdl._rowEditEnding(this, e);\n    this.rowEditEnding.raise(this, e);\n  };\n  FlexGrid.prototype.onRowEditEnded = function (e) {\n    this.rowEditEnded.raise(this, e);\n    this._addHdl._rowEditEnded(this, e);\n    this._autoRowHeights();\n  };\n  FlexGrid.prototype.onRowAdded = function (e) {\n    this.rowAdded.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDeletingRow = function (e) {\n    this.deletingRow.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onDeletedRow = function (e) {\n    this.deletedRow.raise(this, e);\n  };\n  FlexGrid.prototype.onCopying = function (e) {\n    this.copying.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onCopied = function (e) {\n    this.copied.raise(this, e);\n  };\n  FlexGrid.prototype.onPasting = function (e) {\n    this.pasting.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onPasted = function (e) {\n    this.pasted.raise(this, e);\n  };\n  FlexGrid.prototype.onPastingCell = function (e) {\n    this.pastingCell.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onPastedCell = function (e) {\n    this.pastedCell.raise(this, e);\n  };\n  FlexGrid.prototype.onFormatItem = function (e) {\n    this.formatItem.raise(this, e);\n  };\n  FlexGrid.prototype.onUpdatingView = function (e) {\n    this.updatingView.raise(this, e);\n    return !e.cancel;\n  };\n  FlexGrid.prototype.onUpdatedView = function (e) {\n    this.updatedView.raise(this, e);\n  };\n  FlexGrid.prototype._createSelHdl = function () {\n    return new _SelectionHandler(this);\n  };\n  FlexGrid.prototype._getTabIndex = function () {\n    return this._orgTabIndex;\n  };\n  FlexGrid.prototype._setTabOrder = function (e) {\n    this._orgTabIndex = e;\n    this._updateTabIndex();\n  };\n  FlexGrid.prototype._updateTabIndex = function () {\n    var e = this.isDisabled ? -1 : this._orgTabIndex,\n      t = this._imeHdl;\n    t && t._updateImeFocus();\n    var i = this._activeCell,\n      o = this._root,\n      n = this._eFocus;\n    if (i) {\n      i.tabIndex = e;\n      n.tabIndex = -1;\n      o.tabIndex = -1;\n    } else if (this.selectionMode != SelectionMode.None) {\n      n.tabIndex = e;\n      o.tabIndex = -1;\n    } else {\n      o.tabIndex = e;\n      n.tabIndex = -1;\n    }\n  };\n  FlexGrid.prototype._autoRowHeights = function () {\n    var e = this;\n    if (this._autoHeights) {\n      this.rows.length > 100 && [this.columnHeaders, this.rowHeaders].forEach(function (e) {\n        e._updateContent(!0, !1, e._getOffsetY());\n      });\n      clearTimeout(this._toAutoHeights);\n      this._toAutoHeights = setTimeout(function () {\n        e._toAutoHeights = null;\n        e.editRange || e._autoSizeRows();\n      }, Control._REFRESH_INTERVAL);\n    }\n  };\n  FlexGrid.prototype._autoSizeRows = function () {\n    var e = this.autoSizeMode,\n      t = AutoSizeMode;\n    if (e & t.Headers) {\n      this._autoSizeMode = t.Both;\n      this.autoSizeRows(0, this.columnHeaders.rows.length - 1, !0);\n      this._autoSizeMode = e;\n    }\n    e & t.Cells && this.autoSizeRows();\n  };\n  FlexGrid.prototype._getShowErrors = function () {\n    return this.showErrors && this._hasValidation;\n  };\n  FlexGrid.prototype._getHasValidation = function () {\n    return this._hasValidation;\n  };\n  FlexGrid.prototype._getError = function (e, t, i, o) {\n    if (isFunction(this.itemValidator)) {\n      if (e == this.cells) return this.itemValidator(t, i, o);\n      if (e == this.rowHeaders) {\n        var n = e.rows,\n          l = this.columns,\n          r = n[t].dataItem,\n          s = null,\n          a = [],\n          u = t;\n        if (g = this.getMergedRange(e, t, i, !1)) {\n          for (t = u = g.row; t < n.length && (n[t].dataItem == r || g && g.rowSpan > 1 && g.row2 >= t); t++) for (var c = 0; c < l.length; c++) if (s = this.itemValidator(t, c, !1)) {\n            (m = this.getMergedRange(this.cells, t, c)) && (m.columnSpan > 1 && m.col < c || m.rowSpan > 1 && m.row < t) || a.push(s);\n          }\n        } else for (c = 0; c < this.columns.length; c++) {\n          var d = this.itemValidator(t, c, !1);\n          d && a.push(d);\n        }\n        if (a.length) {\n          var h = !!(C = this.errorTip) && C.isContentHtml;\n          s = a.join(h ? \"<br/>\" : \"\\n\");\n        }\n        return s;\n      }\n    }\n    var p = this._cv,\n      f = p ? p.getError : null;\n    if (isFunction(f)) {\n      n = e.rows, l = this.columns;\n      if ((r = n[t].dataItem) && !(r instanceof CollectionViewGroup)) if (e == this.cells) for (; t < n.length && n[t].dataItem == r; t++) {\n        return f(r, (_ = this._getBindingColumn(this.cells, t, l[i])).binding, o);\n      } else if (e == this.rowHeaders) {\n        if (!(s = f(r, null, !1))) {\n          var g;\n          a = [], u = t;\n          (g = this.getMergedRange(e, t, i, !1)) && (u = g.row);\n          for (t = u; t < n.length && (n[t].dataItem == r || g && g.rowSpan > 1 && g.row2 >= t); t++) for (c = 0; c < l.length; c++) {\n            var _ = this._getBindingColumn(this.cells, t, l[c]);\n            if (s = f(n[t].dataItem, _.binding, !1)) {\n              var m;\n              (m = this.getMergedRange(this.cells, t, c)) && (m.columnSpan > 1 && m.col < c || m.rowSpan > 1 && m.row < t) || a.push(s);\n            }\n          }\n          if (a.length) {\n            var C;\n            h = !!(C = this.errorTip) && C.isContentHtml;\n            s = a.join(h ? \"<br/>\" : \"\\n\");\n          }\n        }\n        return s;\n      }\n    }\n    return null;\n  };\n  FlexGrid.prototype._setAria = function (e, t) {\n    setAttribute(this.cells.hostElement, \"aria-\" + e, t);\n  };\n  FlexGrid.prototype._setFocus = function (e) {\n    if (this.hostElement) {\n      var t = getActiveElement(),\n        i = this.activeEditor,\n        o = this._activeCell,\n        n = this._eFocus,\n        l = this._root,\n        r = this._getTabIndex(),\n        s = this.containsFocus();\n      if (!e && s && this.selectionMode != SelectionMode.None) {\n        if (this.rows.length > 0 && this.selection.row >= 0 && this.selection.col >= 0) {\n          var a = this._getBindingColumn(this.cells, this.selection.row, this.columns[this.selection.col]),\n            u = a && a._edt;\n          !o || contains(o, t) || this.imeEnabled || u || this._correctFocusOfActiveCell(o);\n        }\n      } else if (e || !s) {\n        if (i) {\n          if (!contains(i, t)) {\n            i.focus();\n            n.tabIndex = -1;\n            l.tabIndex = -1;\n          }\n        } else if (o) contains(o, t) || this._correctFocusOfActiveCell(o);else if (!contains(n, t) && t != l) if (this.selectionMode != SelectionMode.None) {\n          n.tabIndex = r;\n          this._setFocusNoScroll(n);\n        } else {\n          l.tabIndex = r;\n          this._setFocusNoScroll(l);\n        }\n        if (!this.containsFocus()) if (this.selectionMode != SelectionMode.None) {\n          n.tabIndex = r;\n          this._setFocusNoScroll(n);\n        } else {\n          l.tabIndex = r;\n          this._setFocusNoScroll(l);\n        }\n      }\n    }\n  };\n  FlexGrid.prototype._correctFocusOfActiveCell = function (e) {\n    var t = this._getTabIndex();\n    if (getActiveElement() != this._root) {\n      isIE() && hasClass(e, \"wj-group\") && (e = e.querySelector(\".\" + CellFactory._WJC_COLLAPSE) || e);\n      e.tabIndex = t;\n      this._setFocusNoScroll(e);\n    } else e.tabIndex = t;\n    this._eFocus.tabIndex = -1;\n  };\n  FlexGrid.prototype._setFocusNoScroll = function (e) {\n    if (getActiveElement() != e) {\n      if (supportsFocusOptions()) e.focus({\n        preventScroll: !0\n      });else {\n        var t = this.scrollPosition,\n          i = e.style,\n          o = i.position;\n        i.position = \"fixed\";\n        e.focus();\n        i.position = o;\n        this.scrollPosition = t;\n      }\n      this._fixScroll();\n    }\n  };\n  FlexGrid.prototype._clearAnchorCell = function () {\n    this._anchorCell = null;\n  };\n  FlexGrid.prototype._setAnchorCell = function (e, t) {\n    var i = this.getMergedRange(this.cells, e, t);\n    this._anchorCell = i ? new Point(i.col, i.row) : new Point(t, e);\n  };\n  FlexGrid.prototype._getAnchorCell = function () {\n    return this._anchorCell;\n  };\n  FlexGrid.prototype._updateDefaultSizes = function () {\n    var e = this._getDefaultRowHeight();\n    this._rows._setDefaultSize(e);\n    this._cols._setDefaultSize(4 * e);\n    this._hdrRows._setDefaultSize(e);\n    this._hdrCols._setDefaultSize(Math.round(1.25 * e));\n    this._ftrRows._setDefaultSize(e);\n    return e;\n  };\n  FlexGrid.prototype._getDefaultRowHeight = function () {\n    var e = this.hostElement,\n      t = this._eFocus,\n      i = null;\n    if (!t.offsetHeight) {\n      i = createElement('<div><div class=\"wj-cell\">0</div></div>', document.body);\n      e && i.setAttribute(\"class\", e.getAttribute(\"class\"));\n      t = i.children[0];\n    }\n    var o = t.offsetHeight;\n    (isNaN(o) || o <= 6) && (o = 28);\n    removeChild(i);\n    return o;\n  };\n  FlexGrid.prototype._getCollectionView = function (e) {\n    return asCollectionView(e);\n  };\n  FlexGrid.prototype._getCanvasContext = function () {\n    var e = document.createElement(\"canvas\").getContext(\"2d\"),\n      t = getComputedStyle(this.hostElement);\n    e.font = t.fontSize + \" \" + t.fontFamily.split(\",\")[0];\n    return e;\n  };\n  FlexGrid.prototype._getWidestRow = function (e, t, i, o) {\n    for (var n = 0, l = 0, r = 1 === this._getRowsPerItem() && e.columns[i].dataType == DataType.Boolean, s = t.row; s <= t.row2; s++) if (e.rows[s].isVisible) {\n      var a = e.getCellData(s, i, !0),\n        u = o.measureText(a).width,\n        c = this.getMergedRange(e, s, i, !1);\n      c && c.columnSpan > 1 && (u /= c.columnSpan);\n      if (u > l) {\n        l = u;\n        n = s;\n      }\n      if (r) break;\n      s += c ? c.rowSpan - 1 : 0;\n    }\n    return n;\n  };\n  FlexGrid.prototype._getDesiredWidth = function (e, t, i, o) {\n    var n = this.getMergedRange(e, t, i, !1),\n      l = o.style;\n    this.cellFactory.updateCell(e, t, i, o, n);\n    l.width = l.top = l.left = \"\";\n    return o.offsetWidth / (n && n.columnSpan > 1 ? n.columnSpan : 1);\n  };\n  FlexGrid.prototype._getDesiredHeight = function (e, t, i, o) {\n    var n = o.style,\n      l = this.getMergedRange(e, t, i, !1),\n      r = l ? l.rowSpan : 1;\n    this.cellFactory.updateCell(e, t, i, o, l);\n    o.innerHTML.trim() || (o.innerHTML = \"&nbsp;\");\n    n.height = n.top = n.left = \"\";\n    return o.offsetHeight / r;\n  };\n  FlexGrid.prototype._getDesiredRowHeight = function (e, t, i, o) {\n    for (var n = 0, l = (e.rows[t], this._getQuickAutoSize()), r = 0; r < e.columns.length; r++) {\n      if (e.columns[r].isVisible) {\n        var s = this.getMergedRange(e, t, r, !1),\n          a = void 0;\n        if (l) {\n          var u = {\n              ct: e.cellType,\n              col: r,\n              spr: s && s.rowSpan > 1 ? s.rowSpan : 1,\n              spc: s && s.columnSpan > 1 ? s.columnSpan : 1,\n              data: e.getCellData(t, r, !0) || \"1\"\n            },\n            c = JSON.stringify(u);\n          if (null == (a = o[c])) {\n            a = this._getDesiredHeight(e, t, r, i);\n            o[c] = a;\n          }\n        } else a = this._getDesiredHeight(e, t, r, i);\n        n = Math.max(a, n);\n        r += s ? s.columnSpan - 1 : 0;\n      }\n    }\n    return n;\n  };\n  FlexGrid.prototype._getSortRowIndex = function () {\n    return null != this._sortRowIndex ? this._sortRowIndex : this.columnHeaders.rows.length - 1;\n  };\n  FlexGrid.prototype._getDeleteColumnIndex = function () {\n    return 0;\n  };\n  FlexGrid.prototype._getEditColumnIndex = function () {\n    return null != this._editColIndex ? this._editColIndex : this.rowHeaders.columns.length - 1;\n  };\n  FlexGrid.prototype._sortConverter = function (e, t, i, o) {\n    var n,\n      l = this;\n    if (o) {\n      this._mappedColumns = null;\n      this._cv && this._cv.sortDescriptions.forEach(function (e) {\n        if ((n = l.getColumn(e.property)) && n.dataMap) {\n          l._mappedColumns || (l._mappedColumns = {});\n          l._mappedColumns[n.binding] = n.dataMap;\n        }\n      });\n      if (this._mouseHdl._htDown && this._mouseHdl._htDown.col > -1) {\n        n = this.columns[this._mouseHdl._htDown.col];\n        this._mappedColumns && n.dataMap && (this._mappedColumns[n.binding] = n.dataMap);\n      }\n    }\n    if (this._mappedColumns) {\n      var r = this._mappedColumns[e.property];\n      r && r.sortByDisplayValues && (i = r.getDisplayValue(i));\n    }\n    return i;\n  };\n  FlexGrid.prototype._bindGrid = function (e) {\n    var t = this;\n    this.finishEditing();\n    this.deferUpdate(function () {\n      t.autoGenerateColumns && 0 == t._lastCount && hasItems(t._cv) && (e = !0);\n      var i;\n      t.preserveSelectedState && (i = t._getMap()) && t.rows.forEach(function (e) {\n        e.isSelected && e.dataItem && i.set(e.dataItem, !0);\n      });\n      var o,\n        n = t._getMap();\n      n && t.rows.forEach(function (e) {\n        e.isReadOnly && e.dataItem && n.set(e.dataItem, !0);\n      });\n      if (t.preserveOutlineState && t.rows.maxGroupLevel > -1 && (o = t._getMap())) for (var l = 0; l < t.rows.length; l++) {\n        var r = t.rows[l];\n        if (r instanceof GroupRow && r.isCollapsed && r.dataItem) {\n          var s = r.dataItem;\n          s instanceof CollectionViewGroup && (s = s._path);\n          o.set(s, !0);\n        }\n      }\n      e && t.columns.deferUpdate(function () {\n        t._bindColumns();\n      });\n      var a = new CancelEventArgs();\n      if (t.onLoadingRows(a)) {\n        t.rows.deferUpdate(function () {\n          t._bindRows();\n        });\n        t.onLoadedRows(a);\n      }\n      t._selHdl.extendedSelection.clear();\n      var u = 0;\n      i && i.size && t.rows.forEach(function (e) {\n        var t = e.dataItem;\n        if (t && i.has(t)) {\n          e.isSelected = !0;\n          u++;\n        }\n      });\n      n && n.size && t.rows.forEach(function (e) {\n        var t = e.dataItem;\n        t && n.has(t) && (e.isReadOnly = !0);\n      });\n      if (0 == u && t.selectionMode == SelectionMode.ListBox) {\n        var c = t.selection;\n        for (l = c.topRow; l <= c.bottomRow && l > -1 && l < t.rows.length; l++) t.rows[l]._setFlag(RowColFlags.Selected, !0, !0);\n      }\n      o && o.size && t.rows.deferUpdate(function () {\n        t.rows.forEach(function (e) {\n          if (e instanceof GroupRow) {\n            var t = e.dataItem;\n            t instanceof CollectionViewGroup && (t = t._path);\n            o.has(t) && (e.isCollapsed = !0);\n          }\n        });\n      });\n      if (!t._lastCount) {\n        var d = t._cv;\n        d && d.items && (t._lastCount = d.items.length);\n      }\n    });\n    if (this._cv) {\n      var i = e && !this._toInv;\n      this._syncSelection(i);\n    } else {\n      var o = this.selection,\n        n = new CellRange(-1, o.col, -1, o.col2);\n      this._selHdl._adjustSelection(n, this.selectionMode);\n    }\n  };\n  FlexGrid.prototype._getMap = function () {\n    return window.Map ? new Map() : null;\n  };\n  FlexGrid.prototype._cvCollectionChanged = function (e, t) {\n    if (this.autoGenerateColumns && 0 == this.columns.length) this._bindGrid(!0);else {\n      var i = NotifyCollectionChangedAction;\n      if (this.childItemsPath && t.action != i.Change) this._bindGrid(!1);else {\n        switch (t.action) {\n          case i.Change:\n            this.invalidate();\n            return;\n          case i.Add:\n            if (t.index == this._cv.items.length - 1) {\n              var o = this.rows.length;\n              this.rows[o - 1] instanceof _NewRowTemplate && o--;\n              this.rows.insert(o, new Row(t.item));\n              return;\n            }\n            assert(!1, \"added item should be the last one.\");\n            break;\n          case i.Remove:\n            var n = this._findRow(t.item);\n            if (n > -1) {\n              this.rows.removeAt(n);\n              this._syncSelection(!1);\n              return;\n            }\n            assert(!1, \"removed item not found on grid.\");\n        }\n        this._bindGrid(!1);\n      }\n    }\n  };\n  FlexGrid.prototype._cvCurrentChanged = function (e, t) {\n    this._syncSelection(!1);\n  };\n  FlexGrid.prototype._syncSelection = function (e) {\n    if (this._cv && this.selectionMode != SelectionMode.None) {\n      var t = this._selHdl,\n        i = t.selection,\n        o = i.row > -1 && i.row < this.rows.length ? this.rows[i.row] : null,\n        n = o ? o.dataItem : null,\n        l = this._cv;\n      if (l instanceof CollectionView && l.isUpdating) return;\n      if (this.newRowAtTop && o instanceof _NewRowTemplate) return;\n      n instanceof CollectionViewGroup && (n = null);\n      var r = this._isISChanging;\n      if (e || n != l.currentItem || i.row >= this.rows.length || i.row2 >= this.rows.length || r && i.row !== i.row2) {\n        var s = this.editableCollectionView;\n        if (!this.childItemsPath || !s || !s.currentAddItem) {\n          var a = this._getRowIndex(l.currentPosition);\n          if (a != i.row || !this.childItemsPath) {\n            var u = r ? i.col : i.col2;\n            i = new CellRange(a, i.col, a, u);\n            t._adjustSelection(i, this.selectionMode);\n            this.selectionMode && !this._updating && this.scrollIntoView(i.row, -1);\n          }\n        }\n      }\n    }\n  };\n  FlexGrid.prototype._getRowIndex = function (e) {\n    if (this._cv) {\n      var t = this.rows;\n      if (e > -1) {\n        for (var i = this._cv.items[e]; e < t.length; e++) if (t[e].dataItem === i) return e;\n        return -1;\n      }\n      if (1 == t.length && t[0] instanceof _NewRowTemplate) return 0;\n      var o = this.selection.row,\n        n = o > -1 ? t[o] : null;\n      return n && (n instanceof GroupRow || null == n.dataItem) ? o : -1;\n    }\n    return this.selection.row;\n  };\n  FlexGrid.prototype._getCvIndex = function (e) {\n    return e > -1 && e < this.rows.length ? this.rows[e].dataIndex : -1;\n  };\n  FlexGrid.prototype._findRow = function (e) {\n    for (var t = 0; t < this.rows.length; t++) if (this.rows[t].dataItem == e) return t;\n    return -1;\n  };\n  FlexGrid.prototype._preWidth = function () {\n    var e = this._root,\n      t = this._hdrVis & HeadersVisibility.Row ? this._hdrCols.getTotalSize() : 0;\n    return e.clientWidth - t;\n  };\n  FlexGrid.prototype._updateLayout = function () {\n    var e = this,\n      t = new CancelEventArgs();\n    if (this.onUpdatingLayout(t)) {\n      var i = this._hdrVis & HeadersVisibility.Row ? this._hdrCols.getTotalSize() : 0,\n        o = this._hdrVis & HeadersVisibility.Column ? this._hdrRows.getTotalSize() : 0,\n        n = this._ftrRows.getTotalSize(),\n        l = this._rows.getTotalSize() + n;\n      l < 1 && (l = 1);\n      this._heightReal = l;\n      this._heightBrowser = Math.min(l, FlexGrid._getMaxSupportedCssHeight());\n      this._maxOffsetY = Math.max(0, l - this._heightBrowser);\n      var r = getComputedStyle(this._eFocus);\n      this._cellPadVert = parseInt(r.paddingTop) + parseInt(r.paddingBottom);\n      this._cellPadHorz = parseInt(r.paddingLeft) + parseInt(r.paddingRight);\n      this._cellPadLeft = parseInt(this.rightToLeft ? r.paddingRight : r.paddingLeft);\n      var s = this._heightBrowser + o - n,\n        a = this._gpCells.width,\n        u = this._heightBrowser;\n      !a && this.rows.length && (a = .1);\n      !u && this.columns.length && (u = .1);\n      if (this.rightToLeft) {\n        setCss(this._eTL, {\n          right: 0,\n          top: 0,\n          width: i,\n          height: o\n        });\n        setCss(this._eCHdr, {\n          right: i,\n          top: 0,\n          height: o\n        });\n        setCss(this._eRHdr, {\n          right: 0,\n          top: o,\n          width: i\n        });\n        setCss(this._eCt, {\n          right: i,\n          top: o,\n          width: a,\n          height: u\n        });\n        setCss(this._fCt, {\n          right: i,\n          top: o\n        });\n        setCss(this._eBL, {\n          right: 0,\n          top: s,\n          width: i,\n          height: n\n        });\n        setCss(this._eCFtr, {\n          right: i,\n          top: s,\n          height: n\n        });\n      } else {\n        setCss(this._eTL, {\n          left: 0,\n          top: 0,\n          width: i,\n          height: o\n        });\n        setCss(this._eCHdr, {\n          left: i,\n          top: 0,\n          height: o\n        });\n        setCss(this._eRHdr, {\n          left: 0,\n          top: o,\n          width: i\n        });\n        setCss(this._eCt, {\n          left: i,\n          top: o,\n          width: a,\n          height: u\n        });\n        setCss(this._fCt, {\n          left: i,\n          top: o\n        });\n        setCss(this._eBL, {\n          left: 0,\n          top: s,\n          width: i,\n          height: n\n        });\n        setCss(this._eCFtr, {\n          left: i,\n          top: s,\n          height: n\n        });\n      }\n      this._stickyHdr && this._updateStickyHeaders();\n      var c = this.frozenRows || this.frozenColumns;\n      setCss([this._eTL, this._eBL, this._eCFtr, this._eRHdr, this._eMarquee], {\n        zIndex: c ? \"3\" : \"2\"\n      });\n      setCss(this._eCHdr, {\n        zIndex: c ? \"4\" : \"2\"\n      });\n      this._eCHdr.closest(\".wj-cell\") && setCss(this._eCHdr, {\n        zIndex: c ? \"3\" : \"1\"\n      });\n      isIE() && (this._fCt.style.zIndex = c ? \"2\" : \"\");\n      var d = this._root,\n        h = d.offsetWidth - d.clientWidth,\n        p = d.offsetHeight - d.clientHeight;\n      setCss(this._eSz, {\n        width: i + h + this._gpCells.width,\n        height: o + p + this._heightBrowser\n      });\n      var f = null;\n      if (this.columns._updateStarSizes(d.clientWidth - i)) {\n        f = d.clientWidth;\n        setCss(this._eCt, {\n          width: this._gpCells.width\n        });\n        this.onStarSizedColumns();\n      }\n      this._szClient = new Size(d.clientWidth - i, d.clientHeight - o);\n      this._szClientSB = new Size(d.offsetWidth - i, d.offsetHeight - o);\n      this._rcBounds = null;\n      this._updateScrollHandler();\n      this._updateContent(!1);\n      h = d.offsetWidth - d.clientWidth;\n      p = d.offsetHeight - d.clientHeight;\n      setCss(this._eSz, {\n        width: i + h + this._gpCells.width,\n        height: o + p + this._heightBrowser\n      });\n      this._szClient = new Size(d.clientWidth - i, d.clientHeight - o);\n      if (f && f != d.clientWidth && this.columns._updateStarSizes(d.clientWidth - i)) {\n        setCss(this._eCt, {\n          width: this._gpCells.width\n        });\n        this._updateContent(!1);\n      }\n      setCss([this._eCHdr, this._eCFtr, this._fCt], {\n        width: this._szClient.width\n      });\n      setCss([this._eRHdr, this._fCt], {\n        height: this._szClient.height\n      });\n      if (n) {\n        s = Math.min(s, this._szClient.height + o - n);\n        setCss([this._eBL, this._eCFtr], {\n          top: s\n        });\n      }\n      window.addEventListener(\"load\", function () {\n        setCss(e._root, {\n          \"overflow-y\": e._root.scrollHeight === e._root.parentElement.clientHeight ? \"hidden\" : \"auto\",\n          \"overflow-x\": e._root.scrollWidth === e._root.parentElement.clientWidth ? \"hidden\" : \"auto\"\n        });\n      });\n      this.onUpdatedLayout(t);\n    }\n  };\n  FlexGrid.prototype._updateStickyHeaders = function () {\n    var e = !1,\n      t = 0;\n    if (this._stickyHdr) {\n      for (var i = 0, o = null, n = this.hostElement; n; n = n.parentElement) if (\"inline\" != getComputedStyle(n).display) {\n        var l = n.getBoundingClientRect();\n        null == o && (o = l.top);\n        i = Math.max(i, l.top);\n      }\n      t = -(o = Math.max(0, i - o - 1));\n      e = o > 0;\n      this._rcBounds = null;\n    }\n    this._eTL.style.top = this._eCHdr.style.top = e ? -t + \"px\" : \"\";\n    toggleClass(this._eTL, FlexGrid._WJS_STICKY, e);\n    toggleClass(this._eCHdr, FlexGrid._WJS_STICKY, e);\n  };\n  FlexGrid.prototype._updateScrollHandler = function () {\n    this._clipToScreen = this._getClipToScreen();\n    var e = this._stickyHdr || this._clipToScreen;\n    if (e != this._scrollHandlerAttached) {\n      this._scrollHandlerAttached = e;\n      e ? this.addEventListener(window, \"scroll\", this._scroll.bind(this), !0) : this.removeEventListener(window, \"scroll\");\n    }\n  };\n  FlexGrid.prototype._getClipToScreen = function () {\n    if (this.rows.length <= FlexGrid._MIN_VIRT_ROWS) return !1;\n    if (this._root.scrollHeight > this._root.clientHeight) return !1;\n    for (var e = this.hostElement; e && e != document.documentElement; e = e.parentElement) {\n      if (\"auto\" == getComputedStyle(e).overflow) return !1;\n    }\n    return !0;\n  };\n  FlexGrid.prototype._scroll = function (e) {\n    var t = this;\n    if (contains(e.target, this.hostElement)) {\n      if (this._clipToScreen) {\n        this._afClip && cancelAnimationFrame(this._afClip);\n        this._afClip = requestAnimationFrame(function () {\n          t._afClip = null;\n          t.finishEditing();\n          t._updateContent(!0);\n        });\n      }\n      if (this._stickyHdr) {\n        this._afSticky && cancelAnimationFrame(this._afSticky);\n        this._afSticky = requestAnimationFrame(function () {\n          t._afSticky = null;\n          var e = new CancelEventArgs();\n          if (t.onUpdatingLayout(e)) {\n            t._updateStickyHeaders();\n            t.onUpdatedLayout(e);\n          }\n        });\n      }\n    }\n  };\n  FlexGrid.prototype._getCssPage = function (e) {\n    if (this._heightReal > this._heightBrowser) {\n      var t = this._szClient.height - this._gpCFtr.rows.getTotalSize();\n      if (this._heightBrowser > t) return clamp(Math.round(e / (this._heightBrowser - t) * 10) / 10, 0, 1);\n    }\n    return 0;\n  };\n  FlexGrid.prototype._updateScrollPosition = function () {\n    var e = this._root,\n      t = e.scrollTop,\n      i = e.scrollLeft;\n    this.rightToLeft && \"rev\" == FlexGrid._getRtlMode() && (i = e.scrollWidth - e.clientWidth - i);\n    var o = new Point(-Math.abs(i), -t);\n    if (!this._ptScrl.equals(o)) {\n      this._ptScrl = o;\n      this.onScrollPositionChanged();\n      return !0;\n    }\n    return !1;\n  };\n  FlexGrid.prototype._updateContent = function (e, t) {\n    var i = this,\n      o = this._root,\n      n = this.hostElement,\n      l = this.cells.hostElement,\n      r = this._activeCell,\n      s = getActiveElement(),\n      a = contains(n, s),\n      u = closest(s, \".wj-flexgrid\") == n ? s : null,\n      c = new CancelEventArgs();\n    if (this.onUpdatingView(c)) {\n      if ([HeadersFocusability.All, HeadersFocusability.Column].includes(this.headersFocusability)) {\n        setAttribute(this.hostElement, \"role\", this.rows.maxGroupLevel < 0 ? \"grid\" : \"treegrid\");\n        setAttribute(this.hostElement, \"aria-label\", this.ariaLabel);\n      } else {\n        setAttribute(l, \"role\", this.rows.maxGroupLevel < 0 ? \"grid\" : \"treegrid\");\n        setAttribute(l, \"aria-label\", this.ariaLabel);\n      }\n      this._hasValidation = isFunction(this._itemValidator) || this._cv && isFunction(this._cv.getError);\n      var d = !t && this._errorTip && this._errorTip._tips.length,\n        h = this._getCssPage(-this._ptScrl.y);\n      if (h != this._cssPage) {\n        this._cssPage = h;\n        this._offsetY = Math.round(this._maxOffsetY * h);\n      }\n      this._updateScrollPosition();\n      this._updateMarquee();\n      var p = this._gpCells._updateContent(e, t, this._offsetY),\n        f = this._hdrVis;\n      if (f & HeadersVisibility.Column && (!t || this._ssHdr & f)) {\n        this._gpCHdr._updateContent(e, t, 0);\n        this.rightToLeft || (this._eCHdr.scrollLeft = 0);\n      }\n      if (f & HeadersVisibility.Row && (!t || this._ssHdr & f)) {\n        this._gpRHdr._updateContent(e, t, this._offsetY);\n        this._eRHdr.scrollTop = 0;\n      }\n      f && !t && this._gpTL._updateContent(e, t, 0);\n      if (this._gpCFtr.rows.length) {\n        this._gpBL._updateContent(e, t, 0);\n        this._gpCFtr._updateContent(e, t, 0);\n      }\n      if (d && this._errorTip && this._errorTip._tips.length) {\n        clearTimeout(this._toErrorTips);\n        this._toErrorTips = setTimeout(function () {\n          var e = i._errorTip;\n          if (e) {\n            e.hide();\n            for (var t = e._tips, o = 0; o < t.length; o++) {\n              var n = t[o].element;\n              if (!n.offsetHeight || !hasClass(n, \"wj-state-invalid\")) {\n                e.setTooltip(n, null);\n                o--;\n              }\n            }\n          }\n        }, 250);\n      }\n      if (this._useFrozenDiv()) {\n        this._updateFrozenCells(t);\n        p && hasClass(p, \"wj-frozen\") && (p = null);\n      }\n      this._fCt.style.display = this._fCt.childElementCount ? \"\" : \"none\";\n      this._activeCell = p;\n      if (u) if (u != o && u != this._eFocus && contains(n, u) && !contains(l, u)) {\n        getActiveElement() !== u && u.focus();\n        if (isIE() && u instanceof HTMLInputElement && !u.type.match(/checkbox|radio|range/i)) {\n          var g = u.selectionStart,\n            _ = u.selectionEnd;\n          u.setSelectionRange(g, _);\n        }\n      } else {\n        var m = p !== r;\n        this._setFocus(m);\n      }\n      !u && p && (p.tabIndex = this.isDisabled ? -1 : this._orgTabIndex);\n      r && r != p && (r.tabIndex = -1);\n      if (this.selectionMode != SelectionMode.None) this._eFocus.tabIndex = null != p || this.isDisabled ? -1 : this._orgTabIndex;else {\n        this._eFocus.tabIndex = -1;\n        this._root.tabIndex = null != p || this.isDisabled ? -1 : this._orgTabIndex;\n      }\n      a && this.focus();\n      this._fixScroll();\n      this._rcBounds = null;\n      this.onUpdatedView(c);\n    }\n  };\n  FlexGrid.prototype._fixScroll = function () {\n    var e = this._root;\n    if (!this._updating) {\n      var t = this.hostElement,\n        i = e ? e.parentElement : null,\n        o = this.rightToLeft;\n      if (t) {\n        t.scrollTop && (t.scrollTop = 0);\n        t.scrollLeft && !o && (t.scrollLeft = 0);\n      }\n      if (i) {\n        i.scrollTop && (i.scrollTop = 0);\n        i.scrollLeft && !o && (i.scrollLeft = 0);\n      }\n    }\n    var n = _getSafariVer();\n    if (e && n && 14 == n.major && n.minor >= 1) {\n      e.style.transform = \"\";\n      e.style.transform = \"translateZ(0)\";\n    }\n  };\n  FlexGrid.prototype._clearCells = function () {\n    for (var e in this) if (\"_\" == e[0]) {\n      var t = this[e];\n      t instanceof GridPanel && t._clearCells();\n    }\n    this.invalidate();\n  };\n  FlexGrid.prototype._useFrozenDiv = function () {\n    return isBoolean(this._fzClone) ? this._fzClone : isIE() || isFirefox() || isSafari() || isMobile();\n  };\n  FlexGrid.prototype._updateFrozenCells = function (e) {\n    var t = this._fCt;\n    if (this.frozenRows || this.frozenColumns) {\n      var i = this._eCt.querySelectorAll(\".wj-frozen\");\n      if (e && t.children.length == i.length) {\n        for (var o = 0; o < i.length; o++) t.children[o].className = i[o].className;\n        return;\n      }\n      setText(t, null);\n      if (!this.activeEditor) {\n        var n = this._errorTip,\n          l = navigator.userAgent.indexOf(\"MSIE\") >= 0;\n        for (o = 0; o < i.length; o++) {\n          var r = i[o];\n          if (closest(r, \".wj-flexgrid\") == this.hostElement) {\n            var s = r[GridPanel._INDEX_KEY],\n              a = r.firstElementChild,\n              u = null;\n            if (s && a) {\n              var c = s.panel,\n                d = this._getBindingColumn(c, s.row, c.columns[s.col]);\n              u = isFunction(d.cellTemplate) ? a.onclick : null;\n            }\n            if (l) {\n              var h = \"input[type=checkbox]\",\n                p = r.querySelector(h);\n              r = r.cloneNode(!0);\n              if (p) {\n                r.querySelector(h).checked = p.checked;\n              }\n            } else r = r.cloneNode(!0);\n            a = r.firstElementChild;\n            u && a && (a.onclick = u);\n            r[GridPanel._INDEX_KEY] = s;\n            if (n) {\n              var f = n.getTooltip(i[o]);\n              f && n.setTooltip(r, f);\n            }\n            t.appendChild(r);\n          }\n        }\n      }\n    } else setText(t, null);\n  };\n  FlexGrid.prototype._updateMarquee = function () {\n    var e = this._eMarquee,\n      t = this._getMarqueeRect();\n    if (t && t.width && t.height) {\n      var i = this.cells.hostElement,\n        o = e.firstChild,\n        n = e.offsetWidth - o.offsetWidth,\n        l = e.offsetHeight - o.offsetHeight;\n      setCss(e, {\n        width: t.width + n,\n        height: t.height + l,\n        top: t.top + i.offsetTop - l / 2,\n        left: t.left + i.offsetLeft - n / 2,\n        display: \"\"\n      });\n    } else e.style.display = \"none\";\n  };\n  FlexGrid.prototype._hideMarquee = function () {\n    var e = this._eMarquee;\n    setCss(e, {\n      display: \"none\"\n    });\n  };\n  FlexGrid.prototype._getMarqueeRect = function () {\n    if (!this._shMarquee || !this.selectionMode) return null;\n    var e = this._selHdl.selection;\n    if (!this.isRangeValid(e)) return null;\n    e = (e = (e = this.cells._getAdjustedSelection(e)).combine(this.getMergedRange(this.cells, e.topRow, e.leftCol, !1))).combine(this.getMergedRange(this.cells, e.bottomRow, e.rightCol, !1));\n    var t = this.cells.getCellBoundingRect(e.topRow, e.leftCol, !0),\n      i = this.cells.getCellBoundingRect(e.bottomRow, e.rightCol, !0);\n    if (this.rows.frozen) {\n      var o = Math.min(this.rows.length, this.rows.frozen),\n        n = this.cells.getCellBoundingRect(o - 1, 0, !0);\n      e.topRow >= o && t.top < n.bottom && (t.top = n.bottom);\n      e.bottomRow >= o && i.bottom < n.bottom && (i.height = n.bottom - i.top);\n    }\n    if (this.columns.frozen) {\n      var l = Math.min(this.columns.length, this.columns.frozen);\n      n = this.cells.getCellBoundingRect(0, l - 1, !0);\n      if (this.rightToLeft) {\n        e.leftCol >= l && t.right > n.left && (t.left = n.left - t.width);\n        e.rightCol >= l && i.left > n.left && (i.left = n.left);\n      } else {\n        e.leftCol >= l && t.left < n.right && (t.left = n.right);\n        e.rightCol >= l && i.right < n.right && (i.width = n.right - i.left);\n      }\n    }\n    return this.rightToLeft ? new Rect(i.left, t.top, t.right - i.left, i.bottom - t.top) : new Rect(t.left, t.top, i.right - t.left, i.bottom - t.top);\n  };\n  FlexGrid.prototype._bindColumns = function () {\n    for (var e = this.columns, t = 0; t < e.length; t++) {\n      if (e[t]._getFlag(RowColFlags.AutoGenerated)) {\n        e.removeAt(t);\n        t--;\n      }\n    }\n    var i = this._cv,\n      o = i ? i.items : null;\n    o && o.length && this.autoGenerateColumns && this._getColumnTypes(o).forEach(function (t) {\n      var i = new Column(t);\n      i._setFlag(RowColFlags.AutoGenerated, !0);\n      i.name = i.binding;\n      i.header = toHeaderCase(i.binding);\n      var o = FlexGrid._defTypeWidth[i.dataType];\n      if (null != o) {\n        if (isString(o)) {\n          var n = Math.round(parseFloat(o));\n          o = o.indexOf(\"*\") > -1 ? n * e.defaultSize : n;\n        }\n        isNumber(o) && o > 0 && (i.width = o);\n      }\n      e.push(i);\n    });\n    this._updateColumnTypes();\n  };\n  FlexGrid.prototype._getColumnTypes = function (e) {\n    return getTypes(e);\n  };\n  FlexGrid.prototype._updateColumnTypes = function () {\n    var e = this._cv;\n    if (hasItems(e)) {\n      var t = e.items[0];\n      this.columns.forEach(function (e) {\n        null == e.dataType && e._binding && (e.dataType = getType(e._binding.getValue(t)));\n      });\n    }\n  };\n  FlexGrid.prototype._getMapEditor = function (e, t) {\n    return t.editor ? null != t.editor.isDroppedDown ? t.dataMapEditor : null : !e.dataMap || e instanceof GroupRow ? t.dataMap ? t.dataMapEditor : null : e.dataMapEditor;\n  };\n  FlexGrid.prototype._getBindingColumn = function (e, t, i) {\n    return i;\n  };\n  FlexGrid.prototype._getBindingColumns = function () {\n    return this.columns;\n  };\n  FlexGrid.prototype._getRowsPerItem = function () {\n    return 1;\n  };\n  FlexGrid.prototype._isTransposed = function () {\n    return !1;\n  };\n  FlexGrid.prototype._getRowHeaderPath = function () {\n    return this._rowHdrPath;\n  };\n  FlexGrid.prototype._bindRows = function () {\n    this.rows.clear();\n    var e = this._cv;\n    if (e && e.items) {\n      var t = e.items,\n        i = e.groups;\n      if (this.childItemsPath) for (var o = 0; o < t.length; o++) this._addNode(t, o, 0);else if (null != i && i.length > 0 && this.showGroups) for (o = 0; o < i.length; o++) this._addGroup(i[o]);else for (o = 0; o < t.length; o++) this._addBoundRow(t, o);\n    }\n  };\n  FlexGrid.prototype._addBoundRow = function (e, t) {\n    var i = new Row(e[t]),\n      o = this.rows;\n    i._list = o;\n    o[o.length++] = i;\n  };\n  FlexGrid.prototype._addGroupRow = function (e) {\n    this.rows.push(new GroupRow(e));\n  };\n  FlexGrid.prototype._addNode = function (e, t, i) {\n    var o = e[t],\n      n = this.childItemsPath,\n      l = o[isArray(n) ? n[i] : n],\n      r = new GroupRow(o);\n    r.level = i;\n    this.rows.push(r);\n    if (isArray(l)) for (var s = 0; s < l.length; s++) this._addNode(l, s, i + 1);\n  };\n  FlexGrid.prototype._addGroup = function (e) {\n    this._addGroupRow(e);\n    if (e.isBottomLevel) for (var t = e.items, i = 0; i < t.length; i++) this._addBoundRow(t, i);else for (i = 0; i < e.groups.length; i++) this._addGroup(e.groups[i]);\n  };\n  FlexGrid._getSerializableProperties = function (e) {\n    var t = [];\n    for (e = e.prototype; e != Object.prototype; e = Object.getPrototypeOf(e)) for (var i = Object.getOwnPropertyNames(e), o = 0; o < i.length; o++) {\n      var n = i[o],\n        l = Object.getOwnPropertyDescriptor(e, n);\n      l && l.set && l.get && \"_\" != n[0] && !n.match(/^(disabled|required|showDropDown)$/) && t.push(n);\n    }\n    return t;\n  };\n  FlexGrid.prototype._hasColumnGroups = function () {\n    return this._grpHdl.hasColumnGroups();\n  };\n  FlexGrid.prototype._getColumnGroup = function (e, t) {\n    return this._grpHdl.getColumnGroup(e, t);\n  };\n  FlexGrid.prototype._canMoveColumnGroup = function (e, t, i, o) {\n    return this._grpHdl.canMoveColumnGroup(e, t, i, o);\n  };\n  FlexGrid.prototype._moveColumnGroup = function (e, t, i, o, n) {\n    return this._grpHdl.moveColumnGroup(e, t, i, o, n);\n  };\n  FlexGrid.prototype._copy = function (e, t) {\n    var i = this;\n    if (\"columns\" == e) {\n      var o = asArray(t);\n      if (o.some(function (e) {\n        return null != e.columns;\n      })) this.columnGroups = o;else {\n        this.columns.clear();\n        o.forEach(function (e) {\n          var t = new Column(e);\n          i.columns.push(t);\n        });\n      }\n      return !0;\n    }\n    return !1;\n  };\n  FlexGrid.prototype._isInputElement = function (e) {\n    return e instanceof HTMLElement && !hasClass(e, \"wj-btn-glyph\") && (\"true\" == e.contentEditable || null != e.tagName.match(/^(INPUT|TEXTAREA|BUTTON|A|SELECT|OPTION)$/i));\n  };\n  FlexGrid.prototype._isNativeCheckbox = function (e) {\n    return e instanceof HTMLInputElement && \"checkbox\" == e.type && !e.disabled && !e.readOnly && hasClass(e, CellFactory._WJC_CHECKBOX) && closest(e, \".wj-flexgrid\") == this.hostElement;\n  };\n  FlexGrid.prototype._wantsInput = function (e) {\n    return this._isInputElement(e) && !this.activeEditor && !this._isNativeCheckbox(e) && !hasClass(e, \"wj-grid-ime\") && contains(document.body, e);\n  };\n  FlexGrid._getMaxSupportedCssHeight = function () {\n    if (!FlexGrid._maxCssHeight) {\n      var e = 265e5;\n      isIE() ? e = 15e5 : isFirefox() && (e = 175e5);\n      FlexGrid._maxCssHeight = e;\n    }\n    return FlexGrid._maxCssHeight;\n  };\n  FlexGrid._getRtlMode = function () {\n    if (!FlexGrid._rtlMode) {\n      var e = createElement('<div dir=\"rtl\"><div></div></div>');\n      setCss(e, {\n        visibility: \"hidden\",\n        width: 100,\n        height: 100,\n        overflow: \"auto\"\n      });\n      setCss(e.firstChild, {\n        width: 2e3,\n        height: 2e3\n      });\n      document.body.appendChild(e);\n      var t = e.scrollLeft;\n      e.scrollLeft = -1e3;\n      var i = e.scrollLeft;\n      removeChild(e);\n      FlexGrid._rtlMode = i < 0 ? \"neg\" : t > 0 ? \"rev\" : \"std\";\n    }\n    return FlexGrid._rtlMode;\n  };\n  FlexGrid.prototype.getEmptyRequiredCell = function (e) {\n    return this._getEmptyRequiredCell(e);\n  };\n  FlexGrid.prototype._getEmptyRequiredCell = function (e) {\n    if (e >= 0) for (var t = 0; t < this.columns.length; t++) {\n      var i = this.getCellData(e, t, !1);\n      if (this.columns[t].getIsRequired(this.rows[e]) && (\"\" === i || null == i)) {\n        if (!this.columns[t].isReadOnly) return t;\n        console.warn(\"Incorrect data. Column \" + t + \" is  at the same time  required, empty and read-only\");\n      }\n    }\n    return null;\n  };\n  FlexGrid._WJS_STICKY = \"wj-state-sticky\";\n  FlexGrid._WJS_MEASURE = \"wj-state-measuring\";\n  FlexGrid._WJS_UPDATING = \"wj-state-updating\";\n  FlexGrid._WJS_WSPRE = \"wj-whitespace-pre\";\n  FlexGrid._MIN_VIRT_ROWS = 200;\n  FlexGrid._defTypeWidth = ((_a = {})[DataType.Number] = \"0.714285714*\", _a);\n  FlexGrid.controlTemplate = '<div>  <div wj-part=\"ch\"><div wj-part=\"chcells\" class=\"wj-colheaders\"></div></div><div wj-part=\"root\"><div wj-part=\"cells\" class=\"wj-cells\"></div><div wj-part=\"marquee\" class=\"wj-marquee\"><div></div></div></div><div wj-part=\"fcells\" aria-hidden=\"true\" class=\"wj-cells wj-frozen-clone\"></div><div wj-part=\"rh\"><div wj-part=\"rhcells\" class=\"wj-rowheaders\"></div></div><div wj-part=\"cf\"><div wj-part=\"cfcells\" class=\"wj-colfooters\"></div></div><div wj-part=\"bl\"><div wj-part=\"blcells\" class=\"wj-bottomleft\"></div></div><div wj-part=\"tl\"><div wj-part=\"tlcells\" class=\"wj-topleft\"></div></div><div wj-part=\"focus\" class=\"wj-cell\">0</div><div wj-part=\"sz\"></div></div>';\n  return FlexGrid;\n}(Control);\nexport { FlexGrid };\nvar _ImeHandler = function () {\n  function _ImeHandler(e) {\n    var t = this;\n    this._updateImeFocusAsyncBnd = this._updateImeFocusAsync.bind(this);\n    this._cmpstartBnd = this._compositionstart.bind(this);\n    this._keypressBnd = this._keypress.bind(this);\n    this._g = e;\n    var i = createElement('<textarea class=\"wj-grid-editor wj-form-control wj-grid-ime\" aria-hidden=\"true\"/>');\n    setCss(i, _ImeHandler._cssHidden);\n    disableAutoComplete(i);\n    i.tabIndex = -1;\n    this._tbx = i;\n    this._maskProvider = new _MaskProvider(i);\n    e._root.appendChild(i);\n    this._updateImeFocus();\n    var o = e.hostElement,\n      n = e.addEventListener.bind(e),\n      l = this._updateImeFocusAsyncBnd;\n    n(o, \"blur\", l, !0);\n    n(o, \"focus\", l, !0);\n    n(i, \"compositionstart\", this._cmpstartBnd);\n    isiOS() && n(o, \"keypress\", this._keypressBnd);\n    e.selectionChanged.addHandler(l, this);\n    e.cellEditEnded.addHandler(this._cellEditEnded, this);\n    e.cellEditEnding.addHandler(this._cellEditEnding, this);\n    n(o, \"mousedown\", function (t) {\n      closest(getActiveElement(), \".wj-flexgrid\") == e.hostElement && e.hitTest(t).panel == e.cells && hasClass(e.hitTest(t).target, \"wj-cell\") && (e.isReadOnly || t.preventDefault());\n    });\n    e.gotFocus.addHandler(function () {\n      return t._updateImeFocus();\n    });\n  }\n  _ImeHandler.prototype.dispose = function () {\n    var e = this._g,\n      t = e.hostElement,\n      i = this._tbx,\n      o = e.removeEventListener.bind(e),\n      n = this._updateImeFocusAsyncBnd;\n    o(t, \"blur\", n);\n    o(t, \"focus\", n);\n    o(t, \"keypress\", this._keypressBnd);\n    o(i, \"compositionstart\", this._cmpstartBnd);\n    e.selectionChanged.removeHandler(n);\n    e.cellEditEnded.removeHandler(this._cellEditEnded);\n    e.cellEditEnding.removeHandler(this._cellEditEnding);\n    removeChild(i);\n  };\n  _ImeHandler.prototype._compositionstart = function (e) {\n    var t = this,\n      i = this._g;\n    if (!i.activeEditor) {\n      var o = i._selHdl.selection;\n      if (i.startEditing(!1, o.row, o.col, !1, e)) {\n        if (i.activeEditor && \"checkbox\" != i.activeEditor.type) {\n          o = i.editRange;\n          var n = i._getBindingColumn(i.cells, o.row, i.columns[o.col]),\n            l = n && n._edt,\n            r = i.activeEditor,\n            s = this._tbx,\n            a = i.cells.hostElement,\n            u = i.columns[o.col].pos + a.offsetLeft,\n            c = i.rows[o.row].pos + a.offsetTop,\n            d = i.getCellBoundingRect(o.row, o.col),\n            h = i.cells.getCellElement(o.row, o.col);\n          d.width = h.offsetWidth;\n          d.height = h.offsetHeight;\n          o.row < i.frozenRows && (c += i._root.scrollTop);\n          o.col < i.frozenColumns && (u += i._root.scrollLeft);\n          var p = h.querySelector(\".wj-btn.wj-right\");\n          p && (d.width -= p.offsetWidth);\n          \"minLength,maxLength,pattern\".split(\",\").forEach(function (e) {\n            setAttribute(s, e, r.getAttribute(e));\n          });\n          var f = r instanceof HTMLTextAreaElement;\n          setAttribute(s, \"wrap\", f ? \"soft\" : \"off\");\n          var g = getComputedStyle(h),\n            _ = g.paddingTop;\n          if (o.rowSpan > 1 && !f) {\n            var m = parseFloat(g.lineHeight);\n            isNaN(m) && (m = 1.2 * parseFloat(g.fontSize));\n            _ = Math.max(0, (d.height - m) / 2) + \"px\";\n          }\n          var C = {\n            position: \"absolute\",\n            left: u,\n            top: c,\n            width: d.width - 1,\n            height: d.height - 1,\n            paddingTop: _,\n            paddingLeft: g.paddingLeft,\n            paddingRight: g.paddingRight,\n            textAlign: g.textAlign,\n            zIndex: h.style.zIndex\n          };\n          if (i.rightToLeft) {\n            C.right = parseInt(h.style.right) + parseInt(i.cells.hostElement.style.right);\n            C.left = \"\";\n          }\n          setCss(s, C);\n          if (l) {\n            var w = l._tbx.getBoundingClientRect(),\n              v = s.getBoundingClientRect(),\n              y = window.getComputedStyle(s),\n              b = parseFloat(y.left),\n              R = parseFloat(y.right),\n              E = parseFloat(y.top);\n            i.rightToLeft ? setCss(s, {\n              right: R + v.right - w.right + \"px\",\n              top: E + w.top - v.top + \"px\",\n              width: w.width + \"px\",\n              height: w.height + \"px\"\n            }) : setCss(s, {\n              left: b + w.left - v.left + \"px\",\n              top: E + w.top - v.top + \"px\",\n              width: w.width + \"px\",\n              height: w.height + \"px\"\n            });\n          }\n          i._edtHdl._edt = s;\n          s.select();\n          var x = r.value;\n          setTimeout(function () {\n            \"　\" != s.value && \" \" != s.value || (s.value = x);\n            setSelectionRange(s, s.value.length);\n          }, 20);\n          s.placeholder = r.placeholder;\n          r.placeholder = \"\";\n          r.value = \"\";\n        }\n      } else {\n        this._tbx.blur();\n        setTimeout(function () {\n          t._tbx.focus();\n          i._setFocusNoScroll(i.hostElement);\n        }, 20);\n      }\n    }\n  };\n  _ImeHandler.prototype._cellEditEnding = function () {\n    var e = this._maskProvider;\n    e && e.mask && e._valueChanged();\n  };\n  _ImeHandler.prototype._cellEditEnded = function () {\n    var e = this._tbx,\n      t = this._g;\n    if (this._enableIme()) {\n      var i = getActiveElement();\n      i.blur();\n      if (t._isScrollingByWheel) setTimeout(function () {\n        i.focus();\n        t._setFocusNoScroll(t.hostElement);\n        e.value = \"\";\n        i.focus();\n      }, 20);else {\n        i.focus();\n        t._setFocusNoScroll(t.hostElement);\n        i.focus();\n      }\n    }\n    e.value = \"\";\n    setCss(e, _ImeHandler._cssHidden);\n    this._updateImeFocus();\n  };\n  _ImeHandler.prototype._keypress = function (e) {\n    if (!e.defaultPrevented && e.target == this._tbx && !(e.ctrlKey || e.altKey || e.metaKey || 27 == e.keyCode || this._g.activeEditor)) {\n      this._tbx.value = \"\";\n      this._compositionstart(e);\n      e.stopPropagation();\n    }\n  };\n  _ImeHandler.prototype._updateImeFocus = function () {\n    var e = this._g,\n      t = this._tbx,\n      i = getActiveElement(),\n      o = e._getTabIndex();\n    if (e.activeEditor || closest(i, \".wj-flexgrid\") != e.hostElement) (e.isDisabled || o < 0) && t.tabIndex >= 0 && (t.tabIndex = -1);else if (this._enableIme() && !e._wantsInput(i)) {\n      if (i != t) {\n        e.activeCell && (e.activeCell.tabIndex = -1);\n        t.tabIndex = o;\n        t.disabled = !1;\n        t.value = \"\";\n        if (!e.isTouching) if (window && window.top != window.self) {\n          setSelectionRange(t, 0, 0, !1);\n          e._setFocusNoScroll(t);\n        } else {\n          setSelectionRange(t, 0);\n          t.focus();\n        }\n      }\n      var n = e._selHdl.selection,\n        l = n.isValid ? e._getBindingColumn(e.cells, n.row, e.columns[n.col]) : null;\n      this._maskProvider.mask = l ? l.mask : null;\n    } else {\n      t.tabIndex = -1;\n      t.disabled = !0;\n      t.value = \"\";\n      if (i == t) {\n        t.blur();\n        var r = e.activeCell;\n        if (r) {\n          r.tabIndex = o;\n          r.focus();\n        } else e.focus();\n      }\n    }\n  };\n  _ImeHandler.prototype._updateImeFocusAsync = function () {\n    var e = this;\n    this._toFocus && clearTimeout(this._toFocus);\n    this._toFocus = setTimeout(function () {\n      e._toFocus = null;\n      e._updateImeFocus();\n    }, 100);\n  };\n  _ImeHandler.prototype._resetTabIndex = function () {\n    this._tbx.tabIndex = -1;\n  };\n  _ImeHandler.prototype._enableIme = function () {\n    var e = this._g,\n      t = e._selHdl.selection;\n    if (!e.canEditCell(t.row, t.col)) return !1;\n    var i = t.isValid ? e._getBindingColumn(e.cells, t.row, e.columns[t.col]) : null;\n    return !(!i || i.dataType == DataType.Boolean) && (!i || !i.dataMap || i.dataMapEditor != DataMapEditor.RadioButtons);\n  };\n  _ImeHandler._cssHidden = {\n    position: \"fixed\",\n    width: \"1px\",\n    left: -32e3,\n    top: -32e3,\n    overflow: \"hidden\"\n  };\n  return _ImeHandler;\n}();\nexport { _ImeHandler };\nvar _AddNewHandler = function () {\n  function _AddNewHandler(e) {\n    this._nrt = new _NewRowTemplate();\n    this._top = !1;\n    this._keydownBnd = this._keydown.bind(this);\n    this._committing = !1;\n    this._pasting = !1;\n    this._g = e;\n    this._attach();\n  }\n  Object.defineProperty(_AddNewHandler.prototype, \"newRowAtTop\", {\n    get: function () {\n      return this._top;\n    },\n    set: function (e) {\n      if (e != this.newRowAtTop) {\n        this._top = asBoolean(e);\n        this.updateNewRowTemplate();\n        var t = this._g;\n        if (this._top && t.selectionMode == SelectionMode.ListBox) {\n          t.rows.forEach(function (e, t) {\n            e._setFlag(RowColFlags.Selected, 0 == t, !0);\n          });\n          t.select(0, t.selection.col);\n        }\n      }\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  _AddNewHandler.prototype.updateNewRowTemplate = function () {\n    var e = this._g,\n      t = e.editableCollectionView,\n      i = e.rows,\n      o = this._nrt,\n      n = t && t.canAddNew && e.allowAddNew && !e.isReadOnly,\n      l = i.indexOf(o),\n      r = this._top ? 0 : i.length - 1,\n      s = !1;\n    if (!n && l > -1) {\n      var a = e.selection;\n      a.row == l && e.select(a.row - 1, a.col);\n      i.removeAt(l);\n    } else if (n) {\n      if (l < 0) s = !0;else if (l != r) {\n        i.removeAt(l);\n        s = !0;\n      }\n      s && (this._top ? i.insert(0, o) : i.push(o));\n      if (o) {\n        o._ubv = null;\n        o._setFlag(RowColFlags.ParentCollapsed, !1);\n        this._top && e.selectionMode == SelectionMode.ListBox || o._setFlag(RowColFlags.Selected, !1);\n      }\n    }\n  };\n  _AddNewHandler.prototype._attach = function () {\n    var e = this._g;\n    if (e) {\n      e.pasting.addHandler(this._pastingData, this);\n      e.pasted.addHandler(this._pastedData, this);\n      e.loadedRows.addHandler(this.updateNewRowTemplate, this);\n      e.hostElement.addEventListener(\"keydown\", this._keydownBnd, !0);\n    }\n  };\n  _AddNewHandler.prototype._detach = function () {\n    var e = this._g;\n    if (e) {\n      e.pasting.removeHandler(this._pastingData, this);\n      e.pasted.removeHandler(this._pastedData, this);\n      e.loadedRows.removeHandler(this.updateNewRowTemplate);\n      e.hostElement.removeEventListener(\"keydown\", this._keydownBnd, !0);\n    }\n  };\n  _AddNewHandler.prototype._keydown = function (e) {\n    if (!e.defaultPrevented && e.keyCode == Key.Escape && null == this._g.activeEditor && this._top && this._nrt.dataItem) {\n      this._nrt.dataItem = null;\n      this._g.invalidate();\n    }\n  };\n  _AddNewHandler.prototype._beginningEdit = function (e, t) {\n    if (!t.cancel) {\n      var i = e.rows[t.row];\n      i instanceof _NewRowTemplate && this._handleEditStarting(e, t, i);\n    }\n  };\n  _AddNewHandler.prototype._pastingData = function (e, t) {\n    t.cancel || (this._pasting = !0);\n  };\n  _AddNewHandler.prototype._pastedData = function (e, t) {\n    this._pasting = !1;\n  };\n  _AddNewHandler.prototype._rowEditStarting = function (e, t) {\n    if (this._pasting) {\n      var i = e.rows[t.row];\n      i instanceof _NewRowTemplate && this._handleEditStarting(e, t, i);\n    }\n  };\n  _AddNewHandler.prototype._rowEditEnding = function (e, t) {\n    var i = e.editableCollectionView,\n      o = this._nrt.dataItem;\n    if (i && this._top && o && !t.cancel) {\n      var n = i.currentAddItem;\n      if (!(n && n == o)) {\n        n = i.addNew();\n        for (var l in o) n[l] = o[l];\n      }\n    }\n  };\n  _AddNewHandler.prototype._rowEditEnded = function (e, t) {\n    var i = this,\n      o = e.editableCollectionView;\n    if (o && !this._committing) if (this._top) {\n      if (t.cancel) return;\n      var n = this._nrt.dataItem;\n      if (n) {\n        this._committing = !0;\n        this._nrt.dataItem = null;\n        var l = this._g.rows,\n          r = o.items.indexOf(n) + 1;\n        r < l.length && t._rng.setRange(r, -1);\n        e.onRowAdded(t) ? o.commitNew() : o.cancelNew();\n        this._committing = !1;\n      }\n      var s = e.rows[t.row];\n      setTimeout(function () {\n        s instanceof _NewRowTemplate && e.select(0, e.columns.firstVisibleIndex);\n        i.updateNewRowTemplate();\n      }, 20);\n    } else o.isAddingNew && o.commitNew();\n  };\n  _AddNewHandler.prototype._handleEditStarting = function (e, t, i) {\n    var o = e.editableCollectionView;\n    if (o && o.canAddNew) if (this._top) {\n      if (null == this._nrt.dataItem) {\n        var n = null,\n          l = o.sourceCollection,\n          r = o.newItemCreator;\n        n = isFunction(r) ? r() : l && l.length ? new l[0].constructor() : {};\n        this._nrt.dataItem = n;\n      } else o.currentAddItem && (e.onRowAdded(t) || o.cancelNew());\n    } else {\n      n = o.currentAddItem && o.currentAddItem == i.dataItem ? o.currentAddItem : o.addNew();\n      o.moveCurrentTo(n);\n      var s = this._nrt.isSelected;\n      this.updateNewRowTemplate();\n      s && t.row > -1 && (e.rows[t.row].isSelected = !0);\n      e.isUpdating || e.refresh(!0);\n      e.onRowAdded(t) || o.cancelNew();\n    }\n  };\n  return _AddNewHandler;\n}();\nexport { _AddNewHandler };\nvar _NewRowTemplate = function (e) {\n  __extends(_NewRowTemplate, e);\n  function _NewRowTemplate() {\n    return null !== e && e.apply(this, arguments) || this;\n  }\n  return _NewRowTemplate;\n}(Row);\nexport { _NewRowTemplate };\nexport var AllowMerging;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Cells = 1] = \"Cells\";\n  e[e.ColumnHeaders = 2] = \"ColumnHeaders\";\n  e[e.RowHeaders = 4] = \"RowHeaders\";\n  e[e.AllHeaders = 6] = \"AllHeaders\";\n  e[e.All = 7] = \"All\";\n}(AllowMerging || (AllowMerging = {}));\nvar MergeManager = function () {\n  function MergeManager(e) {\n    null != e && console.error('** WARNING: the \"grid\" parameter has been deprecated. Please remove it.');\n  }\n  MergeManager.prototype.getMergedRange = function (e, t, i, o) {\n    void 0 === o && (o = !0);\n    var n = e.grid,\n      l = e.cellType,\n      r = e.columns,\n      s = e.rows,\n      a = s[t],\n      u = r[i];\n    if (a instanceof _NewRowTemplate) return null;\n    if (!(a instanceof Row && u instanceof Column)) return null;\n    if (e == n.columnHeaders) {\n      var c = n._getColumnGroup(t, i);\n      if (c) {\n        var d = c._rng,\n          h = e.columns;\n        if (h.isFrozen(d.col) != h.isFrozen(d.col2)) {\n          d = d.clone();\n          h.isFrozen(i) ? d.col2 = h.frozen - 1 : d.col = h.frozen;\n        }\n        return d;\n      }\n    }\n    if (n.showGroups && !n.childItemsPath && a instanceof GroupRow && a.dataItem instanceof CollectionViewGroup && l == CellType.Cell) {\n      d = new CellRange(t, i);\n      if (u.aggregate == Aggregate.None) {\n        for (; d.col > 0 && r[d.col - 1].aggregate == Aggregate.None && d.col != r.frozen;) d.col--;\n        for (; d.col2 < r.length - 1 && r[d.col2 + 1].aggregate == Aggregate.None && d.col2 + 1 != r.frozen;) d.col2++;\n      }\n      for (; d.col < i && !r[d.col].visible;) d.col++;\n      return d.isSingleCell ? null : d;\n    }\n    var p = !1,\n      f = AllowMerging,\n      g = CellType;\n    switch (n.allowMerging) {\n      case f.None:\n        p = !0;\n        break;\n      case f.Cells:\n        p = l != g.Cell;\n        break;\n      case f.ColumnHeaders:\n        p = l != g.ColumnHeader && l != g.TopLeft;\n        break;\n      case f.RowHeaders:\n        p = l != g.RowHeader && l != g.TopLeft;\n        break;\n      case f.AllHeaders:\n        p = l == g.Cell;\n    }\n    if (p) return null;\n    if (l == g.Cell) {\n      var _ = n.editableCollectionView,\n        m = _ ? _.currentAddItem : null;\n      if (m && a.dataItem == m) return null;\n    }\n    if (r[i].allowMerging) {\n      d = new CellRange(t, i);\n      var C = e._vrb,\n        w = 0,\n        v = s.length - 1;\n      if (t >= s.frozen) {\n        if (o && (l == CellType.Cell || l == CellType.RowHeader) && n._vtRows < s.length && C) {\n          w = C.topRow;\n          v = C.bottomRow;\n        }\n      } else s.length > s.frozen && (v = s.frozen - 1);\n      for (var y = t - 1; y >= w && this._mergeCell(e, y, i, t, i); y--) d.row = y;\n      for (var b = t + 1; b <= v && this._mergeCell(e, t, i, b, i); b++) d.row2 = b;\n      for (; d.row < t && !s[d.row].visible;) d.row++;\n      if (!d.isSingleCell) return d;\n    }\n    if (s[t].allowMerging) {\n      d = new CellRange(t, i), C = e._vrb;\n      var R = 0,\n        E = r.length - 1;\n      if (i >= r.frozen) {\n        if (o && (l == CellType.Cell || l == CellType.ColumnHeader) && n._vtCols < r.length && C) {\n          R = C.leftCol;\n          E = C.rightCol;\n        }\n      } else E = r.frozen - 1;\n      for (var x = i - 1; x >= R && this._mergeCell(e, t, x, t, i); x--) d.col = x;\n      for (var S = i + 1; S <= E && this._mergeCell(e, t, i, t, S); S++) d.col2 = S;\n      for (; d.col < i && !r[d.col].visible;) d.col++;\n      if (!d.isSingleCell) return d;\n    }\n    return null;\n  };\n  MergeManager.prototype._mergeCell = function (e, t, i, o, n) {\n    var l = e.rows[t],\n      r = e.rows[o];\n    if (!l || !r) return !1;\n    if (l instanceof GroupRow || l instanceof _NewRowTemplate || r instanceof GroupRow || r instanceof _NewRowTemplate) return !1;\n    var s = e.grid.editableCollectionView,\n      a = s ? s.currentAddItem : null;\n    if (a && (l.dataItem == a || r.dataItem == a)) return !1;\n    if (t != o && e.rows.isFrozen(t) != e.rows.isFrozen(o)) return !1;\n    if (i != n && e.columns.isFrozen(i) != e.columns.isFrozen(n)) return !1;\n    if (t != o) {\n      if (i > 0 && (l.allowMerging && this._mergeCell(e, t, i - 1, t, i) || r.allowMerging && this._mergeCell(e, o, i - 1, o, i))) return !1;\n      if (n < e.columns.length - 1 && (l.allowMerging && this._mergeCell(e, t, n, t, n + 1) || r.allowMerging && this._mergeCell(e, o, n, o, n + 1))) return !1;\n    }\n    return e.getCellData(t, i, !0) == e.getCellData(o, n, !0);\n  };\n  return MergeManager;\n}();\nexport { MergeManager };\nvar HitTestInfo = function () {\n  function HitTestInfo(e, t) {\n    this._row = -1;\n    this._col = -1;\n    this._edge = 0;\n    var i;\n    if (t instanceof Element) {\n      if (closest(t, \".wj-flexgrid\") != e.hostElement) return;\n      e = t;\n      this._target = t;\n    }\n    if (!(e instanceof Element) || e instanceof FlexGrid) {\n      if (e instanceof FlexGrid) {\n        this._target = e.hostElement;\n        i = this._g = e;\n      } else {\n        if (!(e instanceof GridPanel)) throw \"First parameter should be a FlexGrid or GridPanel.\";\n        this._target = e.hostElement;\n        this._p = e;\n        i = this._g = this._p.grid;\n      }\n      if (t instanceof MouseEvent) {\n        this._target = t.target;\n        \"mousedown\" == t.type && (i._rcBounds = null);\n      }\n      t = mouseToPage(t);\n      this._pt = t.clone();\n      var o = i.controlRect,\n        n = i._szClient,\n        l = i.topLeftCells,\n        r = i._eTL,\n        s = i.headersVisibility,\n        a = HeadersVisibility,\n        u = s & a.Row ? l.columns.getTotalSize() : 0,\n        c = s & a.Column ? l.rows.getTotalSize() : 0,\n        d = s & a.Column ? c + r.offsetTop : 0,\n        h = i._eBL,\n        p = h.offsetHeight,\n        f = getComputedStyle(i.hostElement),\n        g = f && f.borderLeftWidth ? parseFloat(f.borderLeftWidth) : 0,\n        _ = f && f.borderTopWidth ? parseFloat(f.borderTopWidth) : 0;\n      t.x -= o.left - g;\n      t.y -= o.top - _;\n      i.rightToLeft && (t.x = o.width - t.x);\n      this._p || t.x >= 0 && t.y >= r.offsetTop && n && t.x <= n.width + u && t.y <= n.height + c && (t.y < d ? this._p = t.x < u ? i.topLeftCells : i.columnHeaders : t.y < h.offsetTop ? this._p = t.x < u ? i.rowHeaders : i.cells : this._p = t.x < u ? i.bottomLeftCells : i.columnFooters);\n      if (null != this._p) {\n        var m = this._p.rows,\n          C = this._p.columns,\n          w = this._p.cellType,\n          v = CellType,\n          y = this._p._getFrozenPos(),\n          b = w == v.TopLeft || w == v.ColumnHeader ? c : w == v.BottomLeft || w == v.ColumnFooter ? p : m.getTotalSize(),\n          R = w == v.TopLeft || w == v.BottomLeft || w == v.RowHeader ? u : C.getTotalSize();\n        if (w == v.RowHeader || w == v.Cell) {\n          t.y -= c;\n          if (t.y > y.y || y.y <= 0) {\n            t.y -= i._ptScrl.y;\n            t.y += this._p._getOffsetY();\n          }\n        } else w != v.BottomLeft && w != v.ColumnFooter || (t.y -= h.offsetTop);\n        if (w == v.ColumnHeader || w == v.Cell || w == v.ColumnFooter) {\n          t.x -= u;\n          (t.x > y.x || y.x <= 0) && (t.x -= i._ptScrl.x);\n        }\n        w != v.ColumnHeader && w != v.TopLeft || (t.y -= d - c);\n        this._edge = 0;\n        var E = HitTestInfo._SZEDGE[this._g.isTouching ? 1 : 0];\n        if (this._g.isTouching) {\n          E = HitTestInfo._SZEDGE[1];\n          t.x -= E / 2;\n        }\n        this._row = t.y > b ? -1 : m.getItemAt(t.y);\n        this._col = t.x > R ? -1 : C.getItemAt(t.x);\n        if (this._row < 0 || this._col < 0) {\n          this._p = null;\n          return;\n        }\n        if (this._col > -1) {\n          var x = C[this._col];\n          t.x - x.pos <= E && (this._edge |= 1);\n          var S = x.pos + x.renderSize - t.x;\n          if (S <= E) {\n            this._edge |= 4;\n            S <= E / 2 && (this._edge |= 16);\n          }\n        }\n        if (this._row > -1) {\n          var H = m[this._row];\n          t.y - H.pos <= E && (this._edge |= 2);\n          var F = H.pos + H.renderSize - t.y;\n          if (F <= E) {\n            this._edge |= 8;\n            F <= E / 2 && (this._edge |= 32);\n          }\n        }\n      }\n    } else {\n      var M = closest(e, \".wj-cell\"),\n        T = M ? M[GridPanel._INDEX_KEY] : null;\n      if (T) {\n        this._target = e;\n        this._row = T.row;\n        this._col = T.col;\n        this._rng = T.rng;\n        this._p = T.panel;\n        this._g = T.panel.grid;\n      }\n    }\n  }\n  Object.defineProperty(HitTestInfo.prototype, \"point\", {\n    get: function () {\n      return this._pt;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"cellType\", {\n    get: function () {\n      return this._p ? this._p.cellType : CellType.None;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"panel\", {\n    get: function () {\n      return this._p;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"grid\", {\n    get: function () {\n      return this._p ? this._p.grid : null;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"row\", {\n    get: function () {\n      return this._row;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  HitTestInfo.prototype.getRow = function () {\n    return this._p && this._row > -1 ? this._p.rows[this._row] : null;\n  };\n  Object.defineProperty(HitTestInfo.prototype, \"col\", {\n    get: function () {\n      return this._col;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  HitTestInfo.prototype.getColumn = function (e) {\n    var t = this._p,\n      i = t && this._col > -1 ? t.columns[this._col] : null;\n    if (i && e) {\n      var o = t.grid;\n      i = t.cellType === CellType.ColumnHeader && o._hasColumnGroups() ? o._getColumnGroup(this._row, this._col) : o._getBindingColumn(t, this._row, i);\n    }\n    return i;\n  };\n  Object.defineProperty(HitTestInfo.prototype, \"range\", {\n    get: function () {\n      this._rng || (this._rng = new CellRange(this._row, this._col));\n      return this._rng;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeLeft\", {\n    get: function () {\n      return 0 != (1 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeTop\", {\n    get: function () {\n      return 0 != (2 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeRight\", {\n    get: function () {\n      return 0 != (4 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeFarRight\", {\n    get: function () {\n      return 0 != (16 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeBottom\", {\n    get: function () {\n      return 0 != (8 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"edgeFarBottom\", {\n    get: function () {\n      return 0 != (32 & this._edge);\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(HitTestInfo.prototype, \"target\", {\n    get: function () {\n      return this._target;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  HitTestInfo._SZEDGE = [6, 30];\n  return HitTestInfo;\n}();\nexport { HitTestInfo };\nexport function softInput() {\n  return _getModule(\"wijmo.input\");\n}\nvar _MASK_PROVIDER = \"$WJ-MSKP\",\n  CellFactory = function () {\n    function CellFactory() {}\n    CellFactory.prototype.updateCell = function (e, t, i, o, n, l) {\n      var r = e.grid,\n        s = r.rightToLeft,\n        a = e.rows,\n        u = e.columns,\n        c = a[t],\n        d = u[i],\n        h = t,\n        p = i,\n        f = c instanceof GroupRow ? c : null,\n        g = c instanceof _NewRowTemplate ? c : null,\n        _ = d.renderWidth,\n        m = c.renderHeight,\n        C = e.cellType,\n        w = \"wj-cell\",\n        v = \"\",\n        y = {\n          display: \"\"\n        },\n        b = CellType;\n      0 != l && o.firstElementChild && (1 == o.childNodes.length && \"checkbox\" == o.firstElementChild.type || (o.textContent = \"\"));\n      if (n && !n.isSingleCell) {\n        t = n.row;\n        i = n.col;\n        h = n.row2;\n        p = n.col2;\n        c = a[t];\n        d = u[i];\n        f = c instanceof GroupRow ? c : null;\n        m = (A = n.getRenderSize(e)).height;\n        _ = A.width;\n      }\n      var R,\n        E,\n        x,\n        S,\n        H,\n        F,\n        M = r._getBindingColumn(e, t, d),\n        T = M ? M.dataType : c ? c.dataType : void 0;\n      x = C == b.RowHeader || C == b.Cell && (!f || r.childItemsPath);\n      F = M && M.isContentHtml || c && c.isContentHtml;\n      if (null != T) {\n        R = M.dataMap || c.dataMap, E = C == b.Cell ? r._getMapEditor(c, M) : null, S = x && E == DataMapEditor.RadioButtons;\n        H = T == DataType.Boolean && !R;\n      }\n      var G = d.pos,\n        P = c.pos,\n        I = r._ptScrl;\n      if (r._useFrozenDiv() && C == b.Cell && !r.editRange) i < u.frozen && h >= a.frozen ? P += I.y : t < a.frozen && p >= u.frozen && (G += I.x);else {\n        var A = r._szClient;\n        if (h < a.frozen) {\n          P = Math.min(P, A.height);\n          m = Math.min(m, Math.max(0, A.height - P));\n          P -= I.y;\n        }\n        if (p < u.frozen) {\n          var z = 0 != A.width ? A.width : r._preWidth();\n          G = Math.min(G, z);\n          _ = Math.min(_, Math.max(0, z - G));\n          G -= I.x;\n        }\n      }\n      s ? y.right = G + \"px\" : y.left = G + \"px\";\n      h >= a.frozen && (P -= e._getOffsetY());\n      y.top = P + \"px\";\n      y.width = _ + \"px\";\n      y.height = m + \"px\";\n      y.zIndex = \"\";\n      (t < a.frozen || i < u.frozen) && (y.zIndex = t < a.frozen && i < u.frozen ? 2 : 1);\n      var D = !1,\n        L = r.alternatingRowStep;\n      if (L && (!n || n.row == n.row2)) {\n        D = c.visibleIndex % (L + 1) == 0;\n        1 == L && (D = !D);\n      }\n      if (C == b.Cell) {\n        f && (w += \" wj-group\");\n        D && (w += \" wj-alt\");\n        (t < a.frozen || i < u.frozen) && (w += \" wj-frozen\");\n        g && (w += \" wj-new\");\n        c && c.cssClass && (w += \" \" + c.cssClass);\n        M && M.cssClass && (w += \" \" + M.cssClass);\n      } else {\n        w += \" wj-header\";\n        D && (w += \" wj-header-alt\");\n        c && c.cssClass && C == b.ColumnHeader && (w += \" \" + c.cssClass);\n        M && M.cssClass && C == b.RowHeader && (w += \" \" + M.cssClass);\n        var j = !1;\n        C != b.ColumnHeader && C != b.TopLeft || r.allowResizing & AllowResizing.Columns && (j = null != r._mouseHdl._getResizeCol(e, p));\n        j || C != b.RowHeader || r.allowResizing & AllowResizing.Rows && (j = null != r._mouseHdl._getResizeRow(e, h));\n        j && (w += \" wj-big-header\");\n      }\n      c && c.cssClassAll && (w += \" \" + c.cssClassAll);\n      M && M.cssClassAll && (w += \" \" + M.cssClassAll);\n      var O = SelectedState,\n        N = e.getSelectedState(t, i, n);\n      N != O.None && C == b.Cell && !H && r.editRange && r.editRange.contains(t, i) && (N = O.None);\n      switch (N) {\n        case O.Active:\n          w += \" wj-state-active\";\n          break;\n        case O.Cursor:\n          w += \" wj-state-selected wj-state-active\";\n          break;\n        case O.Selected:\n          w += \" wj-state-multi-selected\";\n      }\n      h == a._lastFrozen && (w += \" wj-frozen-row\");\n      p == u._lastFrozen && (w += \" wj-frozen-col\");\n      (M && M.wordWrap || c && c.wordWrap) && (w += \" wj-wrap\");\n      (M && M.multiLine || c && c.multiLine) && (w += \" wj-multiline\");\n      var k = M ? M.getAlignment(c) : void 0;\n      k && (v = \" wj-align-\" + k);\n      var B = C,\n        V = r._isTransposed(),\n        K = (B == b.ColumnHeader && !V || B == b.RowHeader && V) && r._hasColumnGroups() ? r._getColumnGroup(t, i) : null;\n      K && K.align && (v = \" wj-align-\" + K.align);\n      y.paddingLeft = y.paddingRight = y.paddingTop = y.paddingBottom = \"\";\n      if (C == b.Cell && r.rows.maxGroupLevel > -1 && i == u.firstVisibleIndex && r.treeIndent) {\n        var W = f ? Math.max(0, f.level) : a.maxGroupLevel + 1,\n          q = Math.min(r.treeIndent * W + r._cellPadLeft, _ - r._cellPadHorz) + \"px\";\n        s ? y.paddingRight = q : y.paddingLeft = q;\n      }\n      _ <= r._cellPadHorz && null == o.getAttribute(FlexGrid._WJS_MEASURE) && (y.paddingLeft = y.paddingRight = 0);\n      var U = C == b.Cell && i == u.firstVisibleIndex && f && f.hasChildren && !_isEditingCell(r, t, i);\n      U && (v = \"\");\n      if (0 != l && M) {\n        var J = e.getCellData(t, i, !1),\n          Y = e.getCellData(t, i, !0);\n        if (U) {\n          var X = _getTreeBtn(f, o);\n          Y = f.getGroupHeader() || escapeHtml(Y);\n          o.innerHTML = X.outerHTML + \" \" + Y;\n        } else if (C != b.ColumnHeader || h != r._getSortRowIndex() && M == d) {\n          if (C == b.RowHeader && !Y && function () {\n            var e = !1;\n            if (i == r._getEditColumnIndex()) {\n              var t = r.editableCollectionView,\n                n = t ? t.currentEditItem : null;\n              Y = o.innerHTML = n && c.dataItem == n ? _getGlyph(\"pencil\") : c instanceof _NewRowTemplate ? _getGlyph(\"asterisk\") : \"\";\n              e = !0;\n            }\n            var l = M._tpl;\n            if (l) {\n              _renderTemplate(l, o, J, Y, c, M);\n              e = !0;\n            }\n            return e;\n          }()) ;else if (C != b.Cell || T != DataType.Boolean || R || f && !isBoolean(J)) {\n            if (C == b.Cell && !S && _isEditingCell(r, t, i)) {\n              var Z = M.inputType || c.inputType;\n              Z || (Z = T != DataType.Number || R ? \"text\" : \"tel\");\n              if (!R && !M.mask && !c.mask) {\n                var $ = e.getCellData(t, i, !1);\n                isNumber($) && (Y = _getEditString($, M.format || c.format));\n              }\n              o.innerHTML = (M.multiLine || c.multiLine) && \"checkbox\" != Z ? '<textarea wrap=\"soft\"></textarea>' : '<input type=\"' + Z + '\"/>';\n              var Q = o.children[0];\n              addClass(Q, \"wj-grid-editor wj-form-control\");\n              disableAutoComplete(Q);\n              F && R && !R.isEditable && (Y = toPlainText(Y));\n              Q.value = Y;\n              Q.tabIndex = -1;\n              Q.required = M.getIsRequired(c);\n              setAttribute(Q, \"aria-required\", Q.required);\n              var ee = M.maxLength || c.maxLength;\n              ee && (Q.maxLength = ee);\n              Q.style.textAlign = M.getAlignment(c);\n              var te = M.mask || c.mask;\n              te && (Q[_MASK_PROVIDER] = new _MaskProvider(Q, te));\n              r.showPlaceholders && (Q.placeholder = M.header);\n              (isSafari() || window.wijmo.InvalidScroll) && r._edtHdl && r._edtHdl._edt && (Q.value = r._edtHdl._edt.value);\n              r._edtHdl._edt = Q;\n            } else {\n              if (S) {\n                var ie = [],\n                  oe = e.getCellData(t, i, !1);\n                R.getDisplayValues(c.dataItem).forEach(function (e) {\n                  var t = R.getKeyValue(e) == oe ? \" checked\" : \"\",\n                    i = r.isReadOnly || c.isReadOnly || d.isReadOnly ? \" disabled\" : \"\",\n                    o = escapeHtml(e);\n                  ie.push('<label><input type=\"radio\" tabindex=\"-1\"' + t + i + ' value=\"' + o + '\"><span>' + o + \"</span></label>\");\n                });\n                o.innerHTML = ie.join(\" \");\n                w += \" \" + CellFactory._WJC_RADIOMAP;\n              }\n              var ne = x ? M._tpl : null;\n              ne ? _renderTemplate(ne, o, J, Y, c, M) : S || (C == b.Cell && F ? o.innerHTML = Y : o.textContent = Y || \"\");\n              if (K && K.collapseTo) {\n                var le = K._rng;\n                if (le && (C == b.ColumnHeader && le.columnSpan > 1 || C == b.RowHeader && le.rowSpan > 1)) {\n                  var re = K.isCollapsed;\n                  o.innerHTML = '<div role=\"button\" class=\"' + CellFactory._WJC_COLLAPSE + '\">' + _getGlyph(re ? \"plus\" : \"minus\") + \"</div>&nbsp;\" + o.innerHTML;\n                  re && addClass(o, \"wj-state-collapsed\");\n                }\n              }\n            }\n          } else {\n            var se = o.firstChild;\n            if (!r._isNativeCheckbox(se)) {\n              o.innerHTML = '<label><input type=\"checkbox\" class=\"' + CellFactory._WJC_CHECKBOX + '\" tabindex=\"-1\"/><span></span></label>';\n              se = o.querySelector(\"input\");\n            }\n            setChecked(se, J);\n            se.disabled = !r.canEditCell(t, i);\n            se.disabled && (se.style.cursor = \"default\");\n            r.editRange && r.editRange.contains(t, i) && (r._edtHdl._edt = se);\n          }\n        } else {\n          o.innerHTML = escapeHtml(Y);\n          var ae = M.currentSort;\n          if (ae && r.showSort) {\n            w += \" wj-sort-\" + (\"+\" == ae ? \"asc\" : \"desc\");\n            o.innerHTML += \"&nbsp;\" + _getSortGlyph(M);\n          }\n          r.allowPinning && contains(r.hostElement, o) && _addPinButton(o, i < r.frozenColumns);\n        }\n        if (E == DataMapEditor.DropDownList && r.showDropDown && r.canEditCell(t, i) && softInput()) {\n          var ue = _getDropDownBtn();\n          o.insertBefore(ue, o.firstChild);\n          _isEditingCell(r, t, i) && (w += \" wj-hasdropdown\");\n        }\n      }\n      if (C == b.RowHeader || C == b.ColumnHeader) {\n        var ce = C == b.RowHeader ? !f && !g && c.allowDragging && 0 != (r.allowDragging & AllowDragging.Rows) : (K || d).allowDragging && 0 != (r.allowDragging & AllowDragging.Columns);\n        setAttribute(o, \"draggable\", ce ? \"true\" : null);\n      }\n      if ([b.ColumnHeader, b.RowHeader].includes(C) && [HeadersFocusability.All, HeadersFocusability.Column].includes(r.headersFocusability)) {\n        colHdrAriaAttributes(o, d, e, r, b.RowHeader === C);\n        setAttribute(e.hostElement.parentElement, \"aria-hidden\", !1);\n      }\n      w += v;\n      o.className != w && (o.className = w);\n      var de = o.style;\n      for (var he in y) de[he] !== y[he] && (de[he] = y[he]);\n      if (r._edtHdl._edt && r._edtHdl._edt.parentElement == o) {\n        var pe = r._root,\n          fe = pe.getBoundingClientRect(),\n          ge = o.getBoundingClientRect(),\n          _e = fe.top + pe.clientHeight - ge.top,\n          me = fe.left + pe.clientWidth - ge.left;\n        ge.height > _e && (o.style.height = _e + \"px\");\n        ge.width > me && (o.style.width = me + \"px\");\n      }\n      if ((C == b.Cell || C == b.RowHeader) && r._getShowErrors()) {\n        var Ce = r._getError(e, t, i, !1);\n        r._edtHdl._setCellError(o, Ce);\n      }\n      r.itemFormatter && r.itemFormatter(e, t, i, o);\n      if (r.formatItem.hasHandlers) {\n        var we = CellFactory._fmtItemArgs;\n        if (we) {\n          we._p = e;\n          we._rng.setRange(t, i, h, p);\n          we._cell = o;\n        } else we = CellFactory._fmtItemArgs = new FormatItemEventArgs(e, new CellRange(t, i, h, p), o);\n        we._updateContent = !1 !== l;\n        r.onFormatItem(we);\n      }\n    };\n    CellFactory.prototype.disposeCell = function (e) {};\n    CellFactory.prototype.getEditorValue = function (e) {\n      var t = e._edtHdl._edt;\n      if (t instanceof HTMLInputElement) switch (t.type) {\n        case \"checkbox\":\n          return t.checked;\n        case \"radio\":\n          return t.value;\n      }\n      if (t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement) {\n        var i = t[_MASK_PROVIDER],\n          o = i ? i._applyMask() : t.value,\n          n = t.maxLength;\n        if (isNumber(n) && n > -1 && o.length > n) {\n          var l = culture.Globalize.numberFormat[\"%\"] || \"%\",\n            r = o.length && o[o.length - 1] == l;\n          o = o.substr(0, n);\n          r && o.indexOf(l) < 0 && (o += l);\n        }\n        return o;\n      }\n      return null;\n    };\n    CellFactory._WJC_RADIOMAP = \"wj-radio-map\";\n    CellFactory._WJC_CHECKBOX = \"wj-cell-check\";\n    CellFactory._WJC_COLLAPSE = \"wj-elem-collapse\";\n    CellFactory._WJC_DROPDOWN = \"wj-elem-dropdown\";\n    CellFactory._WJC_PIN = \"wj-elem-pin\";\n    CellFactory._tplDdBtn = _getButton(CellFactory._WJC_DROPDOWN, \"down\");\n    CellFactory._tplCtx = {\n      row: null,\n      col: null,\n      value: null,\n      text: null,\n      item: null\n    };\n    return CellFactory;\n  }();\nexport { CellFactory };\nfunction _renderTemplate(e, t, i, o, n, l) {\n  var r = CellFactory._tplCtx;\n  r.value = i;\n  r.text = o;\n  r.item = n.dataItem;\n  r.row = n;\n  r.col = l;\n  var s = isString(e) ? evalTemplate(e, r) : e(r, t);\n  null != s && (t.innerHTML = s);\n}\nfunction _getEditString(e, t) {\n  t = t || \"n\";\n  var i = Globalize._parseNumericFormat(t);\n  switch (i.spec) {\n    case \"d\":\n    case \"x\":\n      break;\n    case \"e\":\n      t = t.replace(/[0-9]/g, \"\");\n      break;\n    default:\n      t = \"p\" == i.spec ? \"P15\" : \"r\";\n      i.scale && (t += Array(i.scale / 3 + 1).join(\",\"));\n  }\n  return Globalize.formatNumber(e, t, !0);\n}\nfunction _isEditingCell(e, t, i) {\n  return e.editRange && e.editRange.contains(t, i);\n}\nfunction _getDropDownBtn() {\n  var e = CellFactory._ddBtn;\n  if (!e) {\n    e = CellFactory._ddBtn = createElement(CellFactory._tplDdBtn);\n    setAriaLabel(e, culture.FlexGrid.ariaLabels.toggleDropDown);\n    setAttribute(e, \"aria-expanded\", !1);\n  }\n  return e.cloneNode(!0);\n}\nfunction _addPinButton(e, t) {\n  var i = _getButton(CellFactory._WJC_PIN, \"pin\"),\n    o = createElement(i);\n  toggleClass(o, \"wj-state-pinned\", t);\n  setAttribute(o, \"aria-pressed\", t);\n  e.insertBefore(o, e.firstChild);\n}\nfunction _getSortGlyph(e) {\n  var t = _getGlyph(\"+\" == e.currentSort ? \"up\" : \"down\"),\n    i = e.grid.collectionView;\n  if (i && i.sortDescriptions.length > 1) {\n    var o = e.currentSortIndex;\n    o > -1 && (t += '<span class=\"wj-sort-index\">' + (o + 1) + \"</span>\");\n  }\n  return t;\n}\nfunction _getTreeBtn(e, t) {\n  var i = CellFactory._WJC_COLLAPSE,\n    o = (e.isCollapsed ? \"\" : \"down-\") + (e.grid.rightToLeft ? \"left\" : \"right\"),\n    n = createElement('<button class=\"wj-btn wj-btn-glyph ' + i + '\" type=\"button\" tabindex=\"-1\">' + _getGlyph(o) + \"</button>\");\n  setAriaLabel(n, culture.FlexGrid.ariaLabels.toggleGroup);\n  setAttribute(n, \"aria-expanded\", !e.isCollapsed);\n  setAttribute(t, \"aria-expanded\", !e.isCollapsed);\n  return n;\n}\nfunction _getGlyph(e) {\n  return '<span class=\"wj-glyph-' + e + '\"></span>';\n}\nfunction _getButton(e, t) {\n  return '<button class=\"wj-btn wj-btn-glyph wj-right {cls}\" type=\"button\" tabindex=\"-1\">{glyph}</button>'.replace(\"{cls}\", e).replace(\"{glyph}\", _getGlyph(t));\n}\nvar _LB_PAGE_SIZE = 4,\n  _EditHandler = function () {\n    function _EditHandler(e) {\n      var t = this;\n      this._rng = null;\n      this._edt = null;\n      this._edItem = null;\n      this._edtCanceled = !1;\n      this._list = null;\n      this._mapSearch = null;\n      this._fullEdit = !1;\n      this._evtInput = null;\n      this._evtChange = null;\n      this._cstEdtValue = null;\n      this._validating = !1;\n      this._composing = !1;\n      this._g = e;\n      this._evtInput = document.createEvent(\"HTMLEvents\");\n      this._evtInput.initEvent(\"input\", !0, !1);\n      this._evtChange = document.createEvent(\"HTMLEvents\");\n      this._evtChange.initEvent(\"change\", !0, !1);\n      e.selectionChanging.addHandler(function (e, i) {\n        return t._selectionChanging(i);\n      });\n      e.lostFocus.addHandler(function () {\n        var e = getActiveElement();\n        e && \"fixed\" == getComputedStyle(e).position ? t.finishEditing() : t._commitRowEdits();\n      });\n      var i = e.hostElement;\n      e.addEventListener(i, \"mousedown\", function (i) {\n        if (!i.defaultPrevented && 0 == i.button && !e._mouseHdl._szRowCol) {\n          var o = e.hitTest(i);\n          o.cellType != CellType.Cell && o.cellType != CellType.None && (t.finishEditing() || t.finishEditing(!0));\n        }\n      }, !0);\n      e.addEventListener(i, \"compositionend\", function () {\n        t._composing = !1;\n        t._keypress.bind(t);\n      });\n      e.addEventListener(i, \"compositionstart\", function (i) {\n        var o = t._getCustomEditor(e),\n          n = null != i ? closest(i.target, \".wj-flexgrid\") : null,\n          l = Control.getControl(n),\n          r = l && l._edtHdl ? null != l._edtHdl.activeEditor : null != t.activeEditor;\n        if (!o || r || e.imeEnabled) t._composing = !0;else {\n          var s = window.getSelection(),\n            a = s.rangeCount > 0 ? s.getRangeAt(0) : null,\n            u = document.activeElement;\n          if (null != u) {\n            u.blur();\n            window.getSelection().removeAllRanges();\n            setTimeout(function () {\n              null != a && window.getSelection().addRange(a);\n              u.focus();\n            }, 20);\n          }\n        }\n      });\n    }\n    _EditHandler.prototype.startEditing = function (e, t, i, o, n) {\n      void 0 === e && (e = !0);\n      var l = this._g,\n        r = l._selHdl.selection;\n      t = asNumber(t, !0, !0);\n      i = isString(i) ? l.columns.indexOf(i) : asNumber(i, !0, !0);\n      null == t && (t = r.row);\n      null == i && (i = r.col);\n      null == o && (o = !0);\n      if (!this._allowEdit(t, i)) return !1;\n      var s = l.getMergedRange(l.cells, t, i, !1);\n      s || (s = new CellRange(t, i));\n      var a = l.rows[t].dataItem;\n      l.scrollIntoView(s.row, s.col, !0);\n      if (!l.select(s, !0)) return !1;\n      if (!l.rows[t] || a != l.rows[t].dataItem) return !1;\n      if (this.activeEditor) {\n        if (s.equals(this._rng)) return !0;\n        if (!this.finishEditing()) return !1;\n      }\n      var u = new CellRangeEventArgs(l.cells, s, n);\n      if (!l.onBeginningEdit(u)) return !1;\n      var c = l.editableCollectionView,\n        d = !1;\n      if (c) {\n        (d = (a = l.rows[t].dataItem) != c.currentEditItem) && l.onRowEditStarting(u);\n        c.editItem(a);\n        if (d) {\n          l.onRowEditStarted(u);\n          this._edItem = a;\n        }\n      }\n      var h = l.rows[t],\n        p = l._getBindingColumn(l.cells, t, l.columns[i]),\n        f = p.dataMap || h.dataMap,\n        g = DataMapEditor.RadioButtons,\n        _ = h.dataMap && h.dataMapEditor == g || p.dataMap && p.dataMapEditor == g;\n      this._fullEdit = asBoolean(e);\n      this._rng = s;\n      this._list = null;\n      if (f && !_ && !p.editor) {\n        var m = f.getDisplayValues(a);\n        (p.isContentHtml || h.isContentHtml) && (m = m.map(function (e) {\n          return toPlainText(e);\n        }));\n        this._list = m;\n        this._mapSearch = f.search;\n      }\n      if (_) {\n        var C = l._activeCell || l.hostElement.querySelector(\".wj-cell.wj-state-active\");\n        if (C) {\n          var w = n ? n.target : null;\n          w instanceof HTMLSpanElement && (w = closest(w, \"label\"));\n          w instanceof HTMLLabelElement && (w = w.querySelector(\"input\"));\n          if (w instanceof HTMLInputElement) this._edt = w;else {\n            var v = C.querySelectorAll(\"input[checked]\");\n            v.length > 0 ? this._edt = v[0] : this._edt = C.querySelector(\"input\");\n          }\n          this._updateRowHeaderCell(t);\n        }\n      } else s.isSingleCell ? this._updateEditorCell(t, i, d) : l.refresh(!1);\n      var y = this._edt;\n      if (y) {\n        if (\"checkbox\" == y.type || \"radio\" == y.type) this._fullEdit = !1;else if (o) {\n          var b = 0,\n            R = y.value.length,\n            E = !1,\n            x = culture.Globalize.numberFormat[\"%\"] || \"%\",\n            S = l.getCellData(t, i, !1);\n          isNumber(S) ? E = y.value.indexOf(x) > -1 : null == S && (E = /^p/i.test(p.format)) && y.value.indexOf(x) < 0 && (y.value += x);\n          if (E) {\n            var H = y.value;\n            b = 0;\n            R = H.length;\n            for (; R > 0 && (H[R - 1] == x || \" \" == H[R - 1]);) R--;\n            for (; b < R && H[b] == x;) b++;\n          }\n          n && \"keydown\" == n.type && n.keyCode == Key.Space && (b = R);\n          this._setSelectionRange(y, b, R, !0, isEdge());\n          isIE() && \"right\" == y.style.textAlign && (y.style.paddingRight = \"1px\");\n        }\n        l.onPrepareCellForEdit(u);\n      }\n      o && !l.containsFocus() && l.focus();\n      return null != y && !y.disabled && !y.readOnly;\n    };\n    _EditHandler.prototype.finishEditing = function (e) {\n      var t = this._edt;\n      if (!t) {\n        this._removeListBox();\n        return !0;\n      }\n      var i = this._g,\n        o = this._rng,\n        n = new CellEditEndingEventArgs(i.cells, o),\n        l = i.containsFocus();\n      if (!e) {\n        var r = i.hostElement.querySelector(\".wj-control.wj-state-focused\");\n        if (r) {\n          var s = Control.getControl(r);\n          s && (s.containsFocus() || s._focus) && s.onLostFocus(n);\n        }\n      }\n      n.cancel = e;\n      if (!e && i.validateEdits) {\n        if (C = this._getValidationError()) {\n          n.cancel = !0;\n          var a = i.cells.getCellElement(o.row, o.col);\n          if (a) {\n            this._setCellError(a, C);\n            n.stayInEditMode = !0;\n          }\n        }\n      }\n      this._cstEdtValue = null;\n      n.data = i.cells.getCellData(o.topRow, o.leftCol, !1);\n      if (!i.onCellEditEnding(n) && n.stayInEditMode) {\n        l ? setTimeout(function () {\n          t.select();\n        }) : t.select();\n        this._fullEdit = !0;\n        return !1;\n      }\n      if (!n.cancel) {\n        var u = null,\n          c = !1;\n        if (null != this._lbx_SelectedValue) {\n          u = this._lbx_SelectedValue;\n          c = !0;\n        } else {\n          var d = this._cstEdtValue;\n          u = d && !isUndefined(d.value) ? d.value : i.cellFactory.getEditorValue(i);\n        }\n        for (var h = o.topRow; h <= o.bottomRow && h < i.rows.length; h++) for (var p = o.leftCol; p <= o.rightCol && p < i.columns.length; p++) {\n          var f = i._getBindingColumn(i.cells, h, i.columns[p]),\n            g = i.rows[h],\n            _ = f && f.dataMap || g && g.dataMap,\n            m = !_ || _.serializeKeys;\n          if (c || !_ || !this.isEqualValue(_.getDisplayValue(n.data), u)) {\n            if (!i.cells.setCellData(h, p, u, m, !1, c) && i.validateEdits) {\n              var C;\n              if (C = this._getValidationError(!0)) {\n                n.cancel = !0;\n                var w = i.cells.getCellElement(o.row, o.col);\n                if (w) {\n                  this._setCellError(w, C);\n                  n.stayInEditMode = !0;\n                }\n                return !1;\n              }\n            }\n          }\n        }\n        t.value == this._edtValue && t.dispatchEvent(this._evtChange);\n      }\n      this._edt = null;\n      this._rng = null;\n      this._list = null;\n      this._edtValue = null;\n      this._edtCanceled = n.cancel;\n      this._removeListBox();\n      this._lbx_SelectedValue = null;\n      var v = closest(t, \".wj-cell\");\n      if (contains(v, getActiveElement())) {\n        i._setFocusNoScroll(v);\n        i._isScrollingByWheel = !1;\n      }\n      !n.cancel && n.refresh && i._refreshOnEdit ? i.refresh(!1) : this._updateEditorCell(o.row, o.col, !1);\n      l && i.focus();\n      i.onCellEditEnded(n);\n      return !0;\n    };\n    _EditHandler.prototype._setSelectionRange = function (e, t, i, o, n) {\n      void 0 === o && (o = !0);\n      void 0 === n && (n = !1);\n      if (!n) return setSelectionRange(e, t, i, o);\n      if (contains(document.body, e) && !e.disabled && e.offsetHeight) {\n        try {\n          e.setSelectionRange(t, i, \"backward\");\n        } catch (e) {}\n        if (o) try {\n          this._g._setFocusNoScroll(e);\n          return !0;\n        } catch (e) {}\n      }\n      return !1;\n    };\n    _EditHandler.prototype._setCustomEditorValue = function (e) {\n      this._cstEdtValue = {\n        value: e\n      };\n    };\n    _EditHandler.prototype._getCustomEditor = function (e) {\n      var t = null,\n        i = e.selection;\n      if (null != i) {\n        var o = e._getBindingColumn(e.cells, i.row, e.columns[i.col]);\n        t = o && o._edt;\n      }\n      return t;\n    };\n    _EditHandler.prototype._setCellError = function (e, t) {\n      var i = this._g;\n      \"\" == t && (t = null);\n      toggleClass(e, \"wj-state-invalid\", null != t);\n      var o = i.errorTip,\n        n = i.activeEditor;\n      if (o) {\n        o.setTooltip(e, t);\n        n && contains(e, n) && setAttribute(n, \"title\", \"\");\n      } else setAttribute(e, \"title\", t);\n      n && e == i.activeCell && !contains(e, n) && o && o.setTooltip(n, t);\n    };\n    Object.defineProperty(_EditHandler.prototype, \"activeEditor\", {\n      get: function () {\n        return this._edt;\n      },\n      enumerable: !0,\n      configurable: !0\n    });\n    Object.defineProperty(_EditHandler.prototype, \"editRange\", {\n      get: function () {\n        return this._rng;\n      },\n      enumerable: !0,\n      configurable: !0\n    });\n    _EditHandler.prototype.getClipString = function (e, t, i, o) {\n      var n,\n        l = this,\n        r = this._g,\n        s = r.selectionMode,\n        a = [],\n        u = 0 != (t & ClipStringOptions.CSV),\n        c = u ? \"\\r\\n\" : \"\\n\",\n        d = u ? \",\" : \"\\t\",\n        h = 0 != (t & ClipStringOptions.InvisibleRows),\n        p = SelectionMode,\n        f = null != e;\n      if (!e && s != p.ListBox) for (var g = r.rows, _ = 0; _ < g.length; _++) if (g[_].isSelected) {\n        s = p.ListBox;\n        break;\n      }\n      if (!e) {\n        r._selHdl._expandSelection();\n        e = r.selection;\n        switch (s) {\n          case p.Row:\n          case p.RowRange:\n          case p.ListBox:\n            e.col = 0;\n            e.col2 = r.columns.length - 1;\n            break;\n          case p.MultiRange:\n            var m = r.selectedRanges;\n            if (m.length > 1) {\n              var C = this._sameCols(m),\n                w = this._sameRows(m);\n              if (C || w) {\n                (m = m.slice()).sort(function (e, t) {\n                  var i = e.topRow - t.topRow;\n                  return i || e.leftCol - t.leftCol;\n                });\n                for (var v = 0; v < m.length; v++) for (var y = m[v], b = v + 1; b < m.length; b++) if (y.contains(m[b])) {\n                  m.splice(b, 1);\n                  b--;\n                }\n                if (C) {\n                  var R = [];\n                  m.forEach(function (e) {\n                    R.push(l.getClipString(e, t, i, o));\n                    i = !1;\n                  });\n                  return R.join(c);\n                }\n                if (w) {\n                  var E;\n                  m.forEach(function (e) {\n                    var n = l.getClipString(e, t, i, o).split(c);\n                    if (null == E) {\n                      E = n;\n                      o = !1;\n                    } else n.forEach(function (e, t) {\n                      E[t] += d + e;\n                    });\n                  });\n                  return E.join(c);\n                }\n              }\n            }\n        }\n      }\n      var x = e.col > -1 && e.col2 > -1;\n      i && x && (n = r.columnHeaders).rows.forEach(function (i, r) {\n        if (h || i.isVisible) {\n          var s = l._getRowClipString(n, r, e, t, o);\n          a.push(s);\n        }\n      });\n      if (e.row > -1 && e.row2 > -1) {\n        n = r.cells;\n        if (s != p.ListBox || f) {\n          assert(e.bottomRow < n.rows.length, \"Row index must be less than the number of rows.\");\n          for (v = e.topRow; v <= e.bottomRow; v++) if (h || n.rows[v].isVisible) {\n            var S = this._getRowClipString(n, v, e, t, o);\n            a.push(S);\n          }\n        } else n.rows.forEach(function (i, r) {\n          if (i.isSelected && (h || i.isVisible)) {\n            var s = l._getRowClipString(n, r, e, t, o);\n            a.push(s);\n          }\n        });\n      }\n      return a.join(c);\n    };\n    _EditHandler.prototype._getRowClipString = function (e, t, i, o, n) {\n      var l = [],\n        r = e.rows[t],\n        s = ClipStringOptions,\n        a = 0 != (o & s.CSV),\n        u = 0 != (o & s.InvisibleColumns),\n        c = 0 == (o & s.Unformatted),\n        d = 0 != (o & s.SkipMerged);\n      if (r.isVisible) {\n        if (n) for (var h = e.cellType == CellType.ColumnHeader ? e.grid.topLeftCells : e.grid.rowHeaders, p = 0; p < h.columns.length; p++) if (u || h.columns[p].isVisible) {\n          var f = h.getCellData(t, p, !0);\n          d && this._skipMergedCell(e, null, t, p) && (f = \"\");\n          l.push(this._getCellClipString(f, o));\n        }\n        if (i.col > -1 && i.col2 > -1) {\n          assert(i.rightCol < e.columns.length, \"Column index must be less than the number of columns.\");\n          for (p = i.leftCol; p <= i.rightCol; p++) if (u || e.columns[p].isVisible) {\n            !(f = e.getCellData(t, p, c)) && r instanceof GroupRow && p == e.columns.firstVisibleIndex && (f = toPlainText(r.getGroupHeader()));\n            d && this._skipMergedCell(e, null, t, p) && (f = \"\");\n            l.push(this._getCellClipString(f, o));\n          }\n        }\n      }\n      return l.join(a ? \",\" : \"\\t\");\n    };\n    _EditHandler.prototype._skipMergedCell = function (e, t, i, o) {\n      var n = e.grid.getMergedRange(e, i, o, !1);\n      if (n) {\n        if (t) {\n          n.row = Math.max(t.topRow, n.row);\n          n.col = Math.max(t.leftCol, n.col);\n        }\n        if (n.row != i || n.col != o) return !0;\n      }\n      return !1;\n    };\n    _EditHandler.prototype._getCellClipString = function (e, t) {\n      isString(e) || (e = isDate(e) ? e.toJSON() : null != e ? e.toString() : \"\");\n      e = e.replace(/\\t/g, \" \");\n      var i = 0 != (t & ClipStringOptions.QuoteAll);\n      (i = i || /\\n|^\"|\"$/.test(e)) || 0 == (t & ClipStringOptions.CSV) || (i = e.indexOf(\",\") > -1);\n      i && (e = '\"' + (e = e.replace(/\"/g, '\"\"')) + '\"');\n      return e;\n    };\n    _EditHandler.prototype._sameRows = function (e) {\n      for (var t = e[0], i = 1; i < e.length; i++) if (e[i].topRow != t.topRow || e[i].bottomRow != t.bottomRow) return !1;\n      return !0;\n    };\n    _EditHandler.prototype._sameCols = function (e) {\n      for (var t = e[0], i = 1; i < e.length; i++) if (e[i].leftCol != t.leftCol || e[i].rightCol != t.rightCol) return !1;\n      return !0;\n    };\n    _EditHandler.prototype.setClipString = function (e, t) {\n      var i = this,\n        o = this._g,\n        n = o.editableCollectionView,\n        l = null == t,\n        r = SelectionMode;\n      if (l) {\n        o._selHdl._expandSelection();\n        t = o.selection;\n        switch (o.selectionMode) {\n          case r.Row:\n          case r.RowRange:\n          case r.ListBox:\n            t.col = 0;\n            t.col2 = o.columns.length - 1;\n            break;\n          case r.MultiRange:\n            var s = o.selectedRanges;\n            if (s.length > 1) {\n              n && n.beginUpdate();\n              s.forEach(function (t) {\n                o.setClipString(e, t);\n              });\n              n && n.endUpdate();\n              o.selectedRanges = s;\n              return;\n            }\n        }\n      }\n      t = asType(t, CellRange);\n      var a = this._parseClipString(asString(e));\n      !l && a.length > t.rowSpan && (a = a.slice(0, t.rowSpan));\n      this._expandClipRows(a, t);\n      var u = 0;\n      if (a.length) for (var c = t.leftCol, d = o.columns.length, h = 0; h < a[0].length; h++) for (var p = c + h + u; p < d && !o.columns[p].visible;) {\n        u++;\n        p++;\n      }\n      var f = l ? new CellRange(t.topRow, t.leftCol, Math.min(t.topRow + a.length - 1, o.rows.length - 1), Math.min(t.leftCol + a[0].length - 1 + u, o.columns.length - 1)) : t,\n        g = new CellRangeEventArgs(o.cells, f, e);\n      if (!o.onPasting(g)) return !1;\n      f = new CellRange(t.topRow, t.leftCol);\n      var _ = new CellRangeEventArgs(o.cells, new CellRange(t.topRow, -1)),\n        m = !1,\n        C = 0,\n        w = t.topRow,\n        v = o.rows,\n        y = o.columns,\n        b = o._getRowsPerItem(),\n        R = a.length > b,\n        E = this._deferPaste(t, a.length);\n      assert(b >= 1, \"Invalid RPI value = \" + b);\n      o.deferUpdate(function () {\n        var e = -1;\n        if (n && E) {\n          e = n.currentPosition;\n          n.beginUpdate();\n        }\n        for (var l = 0; l < a.length && w < v.length; l++, w++) {\n          var r = v[w];\n          if (r.isVisible) {\n            if (!R || !r.isReadOnly) {\n              var s = r.dataItem,\n                u = n ? n.currentEditItem : null;\n              if (u && s != u) {\n                o.onRowEditEnding(_);\n                o.onRowEditEnded(_);\n              }\n              if (r instanceof _NewRowTemplate && n) {\n                if (E) {\n                  r.dataItem = n.addNew();\n                  _._rng.setRange(o.newRowAtTop ? 0 : w, -1);\n                  if (!o.onRowEditStarting(_)) {\n                    w--;\n                    n.cancelNew();\n                    continue;\n                  }\n                  o.onRowEditStarted(_);\n                } else if (1 == b || (w + 1) % b == 1) {\n                  _._rng.setRange(o.newRowAtTop ? w % b : w, -1);\n                  if (!o.onRowEditStarting(_)) {\n                    w--;\n                    continue;\n                  }\n                  o.onRowEditStarted(_);\n                }\n              } else if (s != u) {\n                _._rng.setRange(w, -1);\n                o.onRowEditStarting(_);\n                o.onRowEditStarted(_);\n              }\n              for (var c = a[l], d = t.leftCol, h = 0; h < c.length && d < y.length; h++, d++) {\n                var p = y[d];\n                if (p.isVisible) {\n                  if (!R || !p.isReadOnly) {\n                    var g = o.getMergedRange(o.cells, w, d, !1);\n                    if (!(g && (g.leftCol != d || g.topRow != w)) && i._allowEdit(w, d)) {\n                      var x = c[h],\n                        S = x.length;\n                      S > 1 && '\"' == x[0] && '\"' == x[S - 1] && x.indexOf(\"\\n\") > -1 && (x = x.substr(1, S - 2));\n                      var H = p.maxLength || r.maxLength;\n                      H && (x = x.substr(0, H));\n                      var F = new CellRangeEventArgs(o.cells, new CellRange(w + C, d), x);\n                      if (o.onPastingCell(F)) {\n                        if (n) {\n                          n.editItem(s);\n                          i._edItem = n.currentEditItem;\n                        }\n                        var M = o.getCellData(w, d, !1),\n                          T = F.data,\n                          G = softInput();\n                        if (G) {\n                          var P = o._getBindingColumn(o.cells, w, o.columns[d]),\n                            I = P.editor,\n                            A = null,\n                            z = null;\n                          if (I instanceof G.InputNumber) {\n                            A = I.clamp.bind(I);\n                            z = DataType.Number;\n                          } else if (I instanceof G.InputDate || I instanceof G.InputTime) {\n                            A = I._clamp.bind(I);\n                            z = DataType.Date;\n                          }\n                          if (A) {\n                            T = changeType(T, z, P.format, M);\n                            getType(T) == z && (T = A(T));\n                          }\n                        }\n                        if (o.setCellData(w, d, T)) {\n                          F.data = M;\n                          o.onPastedCell(F);\n                          m = !0;\n                        }\n                      }\n                      f.row2 = Math.max(f.row2, w + C);\n                      f.col2 = Math.max(f.col2, d);\n                    }\n                  }\n                } else h--;\n              }\n              if (i._edItem && n instanceof CollectionView) {\n                var D = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change, i._edItem, w);\n                n.onCollectionChanged(D);\n              }\n              if (r instanceof _NewRowTemplate && n) if (E) {\n                r.dataItem = null;\n                if (m) {\n                  _._rng.setRange(o.newRowAtTop ? 0 : w, -1);\n                  o.onRowEditEnding(_);\n                  o.onRowEditEnded(_);\n                  w--;\n                  C++;\n                  n.commitNew();\n                } else n.cancelNew();\n              } else if (R && b > 1 && (w + 1) % b == 0 && m) {\n                _._rng.setRange(o.newRowAtTop ? w % b : w, -1);\n                o.onRowEditEnding(_);\n                o.onRowEditEnded(_);\n                w -= b;\n                C++;\n              }\n            }\n          } else l--;\n        }\n        if (n) if (E) {\n          if (n.currentEditItem) {\n            n.commitEdit();\n            o.onRowEditEnding(_);\n            o.onRowEditEnded(_);\n          }\n          n.moveCurrentToPosition(e);\n          n.endUpdate(!0);\n        } else {\n          var L = n.currentAddItem;\n          !L && 0 == t.row && o.newRowAtTop && v[0] instanceof _NewRowTemplate && (L = v[0].dataItem);\n          if (L) {\n            n.editItem(L);\n            i._edItem = L;\n          }\n        }\n        f.rowSpan > 1 && 0 == f.topRow && v[0] instanceof _NewRowTemplate && (f.row = f.row2 = 0);\n        o.select(f);\n      });\n      o.onPasted(g);\n      if (m && closest(o.hostElement, \"form\")) {\n        var x = document.createEvent(\"HTMLEvents\"),\n          S = createElement(\"<input>\", o.hostElement);\n        x.initEvent(\"change\", !0, !1);\n        S.dispatchEvent(x);\n        removeChild(S);\n      }\n    };\n    _EditHandler.prototype._deferPaste = function (e, t) {\n      var i = this._g.rows,\n        o = i.length;\n      if (t > 1) {\n        if (o > 1 && i[0].dataItem != i[1].dataItem) return !0;\n        if (1 == o && i[0] instanceof _NewRowTemplate) return !0;\n      }\n      return !1;\n    };\n    _EditHandler.prototype._parseClipString = function (e) {\n      var t = [],\n        i = (e = (e = e.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\")).replace(/\\n$/, \"\")).length,\n        isTabOrNewLineChar = function (e) {\n          return \"\\n\" === e || \"\\t\" === e;\n        },\n        o = 0,\n        n = 0;\n      for (o = 0; o < i; o++) {\n        var l = !1,\n          r = !1,\n          s = !1;\n        if ('\"' === e[o]) {\n          for (var a = !1, u = !1, c = o + 1; c < i; c++) {\n            var d = e[c];\n            if ('\"' === d) {\n              var h = c + 1;\n              if (h < i) {\n                isTabOrNewLineChar(e[h]) && (u = !0);\n              } else u = !0;\n            } else !a && isTabOrNewLineChar(d) && (a = !0);\n            if (u) break;\n          }\n          u && a && (l = !0);\n        }\n        for (n = o; n < i && !s; n++) {\n          var p = e[n];\n          if ('\"' === p) l && (r = !r);else if (isTabOrNewLineChar(p) && !r) {\n            this._parseClipCell(t, e, o, n, \"\\n\" == p);\n            o = n;\n            n == i - 1 && (o = n + 1);\n            s = !0;\n          }\n        }\n        if (n == i) {\n          this._parseClipCell(t, e, o, n, !1);\n          break;\n        }\n      }\n      0 == t.length && t.push([\"\"]);\n      return t;\n    };\n    _EditHandler.prototype._parseClipCell = function (e, t, i, o, n) {\n      e.length || e.push([]);\n      var l = t.substr(i, o - i),\n        r = l.length;\n      if (r > 2 && '\"' == l[0] && '\"' == l[r - 1]) {\n        var s = l.substr(1, r - 2),\n          unquotedStringHasChar = function (e) {\n            return s.indexOf(e) > -1;\n          };\n        (unquotedStringHasChar('\"\"') || unquotedStringHasChar(\"\\t\") || unquotedStringHasChar(\"\\n\")) && (l = s.replace(/\"\"/g, '\"'));\n      } else \"\\t\" == l && (l = \"\");\n      e[e.length - 1].push(l);\n      n && e.push([]);\n    };\n    _EditHandler.prototype._expandClipRows = function (e, t) {\n      for (var i = e.length, o = 0, n = 0; n < i; n++) o = Math.max(o, e[n].length);\n      for (var l = this._g, r = 0, s = 0, a = t.topRow; a <= t.bottomRow; a++) l.rows[a].isVisible && r++;\n      for (var u = t.leftCol; u <= t.rightCol; u++) l.columns[u].isVisible && s++;\n      if (r > 1 || s > 1) {\n        1 == r && (r = i);\n        1 == s && (s = o);\n        if (s % o == 0 && r % i == 0) {\n          for (u = o; u < s; u++) for (a = 0; a < i; a++) e[a].push(e[a % i][u % o]);\n          for (a = i; a < r; a++) e.push(e[a % i]);\n        }\n      }\n    };\n    _EditHandler.prototype._updateEditorCell = function (e, t, i) {\n      var o = this._g,\n        n = o.cells.getCellElement(e, t),\n        l = o._useFrozenDiv() && (e < o.frozenRows || t < o.frozenColumns);\n      if (!n || l || o._hasPendingUpdates()) o.refresh(!1);else if (o.onUpdatingView(new CancelEventArgs())) {\n        this._updateCell(n);\n        (i || o._getHasValidation()) && this._updateRowHeaderCell(e);\n        o.onUpdatedView();\n      }\n    };\n    _EditHandler.prototype._updateRowHeaderCell = function (e) {\n      var t = this._g;\n      if (t.headersVisibility & HeadersVisibility.Row) {\n        var i = t.rowHeaders,\n          o = t._getEditColumnIndex(),\n          n = i.getCellElement(e, o);\n        n && this._updateCell(n);\n      }\n    };\n    _EditHandler.prototype._updateCell = function (e) {\n      var t = new HitTestInfo(e, null),\n        i = FlexGrid._WJS_UPDATING;\n      if (t.panel) {\n        addClass(e, i);\n        t.grid.cellFactory.updateCell(t.panel, t.row, t.col, e, t.range);\n        removeClass(e, i);\n      }\n    };\n    _EditHandler.prototype._getValidationError = function (e) {\n      var t = this,\n        i = this._g,\n        o = \"\";\n      if (i && this._rng && !this._validating) {\n        var n = this._rng.row,\n          l = this._rng.col,\n          r = i.activeEditor,\n          s = i.cellFactory.getEditorValue(i),\n          a = i.getCellData(n, l, !1);\n        e && (o = i._getError(i.cells, n, l, !0));\n        if (!o && i._getHasValidation()) {\n          r && (o = r.validationMessage);\n          if (!o) {\n            var u = i.columns[l],\n              c = i.rows[n];\n            !i._getBindingColumn(i.cells, n, u).getIsRequired(c) || null != s && \"\" !== s || (o = this._getRequiredMsg());\n          }\n          if (!o && i.setCellData(n, l, s, !0, !1)) {\n            o = i._getError(i.cells, n, l, !1);\n            i.setCellData(n, l, a, !1, !1);\n          }\n        }\n        if (!o) {\n          var d = Control.getControl(closest(r, \".wj-control\"));\n          if (d && d != i && d.invalidInput.hasHandlers) {\n            var invInputHandler = function (e, r) {\n              if (r.cancel) {\n                o = i._getError(i.cells, n, l, !0) || t._getBadInputMsg();\n                r.cancel = !1;\n              }\n            };\n            this._validating = !0;\n            var h = r.value;\n            d.invalidInput.addHandler(invInputHandler);\n            if (d._containsFocus()) {\n              var p = closest(d.hostElement, \".wj-cell\");\n              p && p.focus();\n            }\n            d.onLostFocus();\n            d.invalidInput.removeHandler(invInputHandler);\n            r.value = h;\n            o && r.select();\n            this._validating = !1;\n          }\n        }\n      }\n      return o;\n    };\n    _EditHandler.prototype._getRequiredMsg = function () {\n      if (!_EditHandler._msgRequired) {\n        var e = document.createElement(\"input\");\n        e.required = !0;\n        _EditHandler._msgRequired = e.validationMessage;\n      }\n      return _EditHandler._msgRequired;\n    };\n    _EditHandler.prototype._getBadInputMsg = function () {\n      if (!_EditHandler._msgBadInput) {\n        var e = document.createElement(\"input\");\n        e.pattern = \"x\";\n        e.value = \"a\";\n        _EditHandler._msgBadInput = e.validationMessage || \"Bad Input\";\n      }\n      return _EditHandler._msgBadInput;\n    };\n    _EditHandler.prototype._allowEdit = function (e, t) {\n      var i = this._g;\n      if (i.isReadOnly || i.selectionMode == SelectionMode.None) return !1;\n      if (i.collectionView && !i.editableCollectionView) return !1;\n      if (null != e) {\n        if (e < 0 || e >= i.rows.length) return !1;\n        var o = i.rows[e];\n        if (!o || o.isReadOnly || !o.isVisible) return !1;\n      }\n      if (null != t) {\n        if (t < 0 || t >= i.columns.length) return !1;\n        var n = i._getBindingColumn(i.cells, e, i.columns[t]);\n        if (!n || n.isReadOnly || !n.isVisible) return !1;\n      }\n      return !0;\n    };\n    _EditHandler.prototype._commitRowEdits = function () {\n      var e = this._g;\n      if (this.finishEditing() && this._edItem) {\n        var t = e.editableCollectionView;\n        if (t && (t.currentEditItem || t.currentAddItem)) {\n          var i = new CellRangeEventArgs(e.cells, e.selection);\n          e.onRowEditEnding(i);\n          t.commitEdit();\n          e.onRowEditEnded(i);\n        }\n        this._edItem = null;\n      }\n    };\n    _EditHandler.prototype._keydown = function (e) {\n      var t = this._edt;\n      switch (e.keyCode) {\n        case Key.F2:\n          this._fullEdit = !this._fullEdit;\n          e.preventDefault();\n          return !0;\n        case Key.F4:\n          this._toggleListBox(e);\n          e.preventDefault();\n          return !0;\n        case Key.Space:\n          if (t && \"checkbox\" == t.type && !t.disabled && !t.readOnly) {\n            setChecked(t, t.indeterminate || !t.checked);\n            this.finishEditing();\n            e.preventDefault();\n          }\n          return !0;\n        case Key.Enter:\n          e.preventDefault();\n          if (t && e.altKey) {\n            var i = e.target;\n            if (i instanceof HTMLTextAreaElement && \"soft\" == i.wrap) {\n              if (this._composing) {\n                i.blur();\n                i.focus();\n              }\n              i.style.setProperty(\"ime-mode\", \"auto\", \"important\");\n              var o = i.value,\n                n = i.selectionStart,\n                l = i.selectionEnd;\n              i.value = o.substr(0, n) + \"\\n\" + o.substr(l);\n              setSelectionRange(i, n + 1);\n              i.blur();\n              i.focus();\n              i.style.imeMode = \"\";\n            }\n            return !0;\n          }\n          if (t && this._lbx) {\n            this._toggleListBox(e);\n            this.finishEditing();\n            return !0;\n          }\n          return !this.finishEditing();\n        case Key.Tab:\n          e.preventDefault();\n          return !this.finishEditing();\n        case Key.Escape:\n          e.preventDefault();\n          this.finishEditing(!0);\n          return !0;\n        case Key.Up:\n        case Key.Down:\n        case Key.Left:\n        case Key.Right:\n        case Key.PageUp:\n        case Key.PageDown:\n        case Key.Home:\n        case Key.End:\n          if (this._lbx) return this._keydownListBox(e);\n          if (e.altKey) switch (e.keyCode) {\n            case Key.Up:\n            case Key.Down:\n              this._toggleListBox(e);\n              e.preventDefault();\n              return !0;\n          }\n          if (this._fullEdit) switch (e.keyCode) {\n            case Key.PageUp:\n            case Key.PageDown:\n              e.preventDefault();\n          } else if (this.finishEditing()) return !1;\n      }\n      return !0;\n    };\n    _EditHandler.prototype._keydownListBox = function (e) {\n      var t = !0;\n      if (this._lbx) switch (e.keyCode) {\n        case Key.Up:\n          e.altKey ? this._toggleListBox(e) : this._lbx.selectedIndex > 0 && this._lbx.selectedIndex--;\n          break;\n        case Key.Down:\n          e.altKey ? this._toggleListBox(e) : this._lbx.selectedIndex++;\n          break;\n        case Key.Home:\n        case Key.PageUp:\n          this._lbx.selectedIndex = 0;\n          break;\n        case Key.End:\n        case Key.PageDown:\n          this._lbx.selectedIndex = this._lbx.collectionView.items.length - 1;\n          break;\n        default:\n          t = !1;\n      }\n      if (t) {\n        e.preventDefault();\n        return !0;\n      }\n      return !1;\n    };\n    _EditHandler.prototype._keypress = function (e) {\n      if (\"AltLeft\" != e.code && \"AltRight\" != e.code) {\n        var t = this._edt,\n          i = e.charCode || 32,\n          o = this._list;\n        if (isEdge()) {\n          var n = t;\n          n && (1 == n.value.length || 0 == n.selectionStart && n.selectionEnd == n.value.length) && (window.wijmo.InvalidScroll = !0);\n        }\n        if (t && \"checkbox\" != t.type && getActiveElement() == t && o && o.length > 0 && i >= 32) {\n          var l = t.selectionStart,\n            r = t.value.substr(0, l);\n          if (e.target == t && e.charCode) {\n            r += String.fromCharCode(e.charCode);\n            l++;\n          }\n          var s = this._mapSearch,\n            a = -1;\n          if (s) for (var u = 0; u < o.length; u++) {\n            var c = o[u];\n            if (s(null == c ? c : c.toString(), r)) {\n              a = u;\n              break;\n            }\n          } else (a = this._findString(o, r, !0)) < 0 && !this._g.caseSensitiveSearch && (a = this._findString(o, r, !1));\n          if (a > -1) {\n            var d = this._lbx;\n            d && (d.selectedIndex = a);\n            t.value = o[a];\n            setSelectionRange(t, l, t.value.length);\n            t.dispatchEvent(this._evtInput);\n            e.preventDefault && e.preventDefault();\n          } else this._lbx && (this._lbx_SelectedValue = null);\n        }\n      } else e.preventDefault();\n    };\n    _EditHandler.prototype._findString = function (e, t, i) {\n      i || (t = t.toLowerCase());\n      for (var o = 0; o < e.length; o++) {\n        var n = e[o];\n        if (null != n) {\n          n = n.toString();\n          i || (n = n.toLowerCase());\n          if (0 == n.indexOf(t)) return o;\n        }\n      }\n      return -1;\n    };\n    _EditHandler.prototype._toggleListBox = function (e, t) {\n      var i = this._g,\n        o = i._selHdl.selection,\n        n = i.isTouching;\n      t || (t = o);\n      if (this._lbx) {\n        this._removeListBox();\n        if (o.intersects(t)) {\n          i.activeEditor ? i.activeEditor.focus() : i.containsFocus() || i.focus();\n          return !0;\n        }\n      }\n      if (!t.isValid) return !1;\n      var l = i.rows[t.row],\n        r = i._getBindingColumn(i.cells, t.row, i.columns[t.col]),\n        s = l.dataMap || r.dataMap,\n        a = i._getMapEditor(l, r);\n      if (!s || a != DataMapEditor.DropDownList || !softInput()) return !1;\n      if (null != r.editor) return !1;\n      if (!t.intersects(i.editRange) && !this.startEditing(!0, t.row, t.col, !n, e)) return !1;\n      var u = this._lbx = this._createListBox();\n      requestAnimationFrame(function () {\n        return u.showSelection();\n      });\n      n && u.focus();\n      return !0;\n    };\n    _EditHandler.prototype._createListBox = function () {\n      var e = this,\n        t = this._g,\n        i = t.activeEditor,\n        o = this._rng,\n        n = t.rows[o.row],\n        l = t._getBindingColumn(t.cells, o.row, t.columns[o.col]),\n        r = l.isContentHtml || n.isContentHtml,\n        s = l.dataMap || n.dataMap,\n        a = l.dropDownCssClass || n.dropDownCssClass,\n        u = document.createElement(\"div\");\n      this._removeListBox();\n      addClass(u, \"wj-dropdown-panel wj-grid-listbox\");\n      addClass(u, a);\n      var c = i ? i.value : t.getCellData(o.row, o.col, !0),\n        d = new mInput.ListBox(u, {\n          maxHeight: n.renderHeight * _LB_PAGE_SIZE,\n          isContentHtml: r,\n          itemsSource: s.getDisplayValues(n.dataItem)\n        });\n      if (s._displayPath == s._keyPath) d.selectedValue = c;else {\n        var h = t.getCellData(o.row, o.col, !1),\n          p = -1,\n          f = this._findDuplicateValues(s, c, r),\n          g = s._cv.items.findIndex(function (t) {\n            return e.isEqualValue(t[s._keyPath], h, r);\n          });\n        if (g > -1) {\n          var _ = s._cv.items[g][s._displayPath];\n          if (this.isEqualValue(c, _, r)) if (1 == f.length) p = g > d.itemsSource.length || !this.isEqualValue(d.itemsSource[g], c, r) ? d.itemsSource.findIndex(function (t) {\n            return e.isEqualValue(_, t, r);\n          }) : g;else for (var m = -1, C = 0; C < d.itemsSource.length; C++) if (this.isEqualValue(d.itemsSource[C], _, r)) {\n            m++;\n            if (this.isEqualValue(f[m], h, r)) {\n              p = C;\n              break;\n            }\n          }\n        }\n        p < 0 && (p = d.itemsSource.findIndex(function (t) {\n          return e.isEqualValue(c, t, r);\n        }));\n        p >= 0 ? d.selectedIndex = p : d.selectedValue = null;\n      }\n      d.addEventListener(u, \"keydown\", function (i) {\n        switch (i.keyCode) {\n          case Key.Enter:\n          case Key.Escape:\n            e._removeListBox();\n            t.focus();\n        }\n      });\n      d.addEventListener(u, \"click\", function () {\n        e._lbx && (e._lbx_SelectedValue = e._findKeyValue(s, r));\n        e._removeListBox();\n        t.focus();\n        e.finishEditing();\n      });\n      d.gotFocus.addHandler(function () {\n        d.containsFocus() && i && i.focus();\n      });\n      d.selectedIndexChanged.addHandler(function () {\n        var i = t.activeEditor;\n        if (i) {\n          i.value = e._list[d.selectedIndex];\n          i.dispatchEvent(e._evtInput);\n          setSelectionRange(i, 0, i.value.length);\n        }\n      });\n      var w = t.cells.getCellElement(o.row, o.col);\n      if (w) {\n        showPopup(u, w, !1, !1, !1);\n        var v = w.querySelector(\".\" + CellFactory._WJC_DROPDOWN);\n        setAttribute(v, \"aria-expanded\", !0);\n      } else {\n        showPopup(u, t.getCellBoundingRect(o.row, o.col));\n        u[Control._OWNR_KEY] = t.hostElement;\n      }\n      return d;\n    };\n    _EditHandler.prototype._findKeyValue = function (e, t) {\n      void 0 === t && (t = !1);\n      var i = this._lbx.selectedValue,\n        o = this._findDuplicateValues(e, i, t),\n        n = e.getKeyValue(i);\n      if (this._lbx.selectedIndex > 0 && o.length > 1) {\n        for (var l = -1, r = 0; r <= this._lbx.selectedIndex; r++) this.isEqualValue(this._lbx.itemsSource[r], i, t) && l++;\n        l >= 0 && (n = o[l]);\n      }\n      return n;\n    };\n    _EditHandler.prototype._findDuplicateValues = function (e, t, i) {\n      void 0 === i && (i = !1);\n      for (var o = [], n = e.getKeyValues(), l = 0; l < n.length; l++) this.isEqualValue(e.getDisplayValue(n[l]), t, i) && o.push(n[l]);\n      return o;\n    };\n    _EditHandler.prototype._removeListBox = function () {\n      var e = this._lbx;\n      if (e) {\n        this._lbx = null;\n        hidePopup(e.hostElement, function () {\n          e.dispose();\n        });\n      }\n    };\n    _EditHandler.prototype.isEqualValue = function (e, t, i) {\n      void 0 === i && (i = !1);\n      if (e instanceof Date && t instanceof Date) return e.getTime() == t.getTime();\n      null != e && null != e || (e = \"\");\n      null != t && null != t || (t = \"\");\n      Number.isNaN(e) && (e = \"NaN\");\n      Number.isNaN(t) && (t = \"NaN\");\n      if (i) {\n        isString(e) && e.indexOf(\"<\") > -1 && (e = toPlainText(e));\n        isString(t) && t.indexOf(\"<\") > -1 && (t = toPlainText(t));\n      }\n      return e.toString() == t.toString();\n    };\n    _EditHandler.prototype._selectionChanging = function (e) {\n      var t = this;\n      if (this.finishEditing()) {\n        var i = this._g._selHdl.selection.row;\n        if (i != e.row) {\n          var o = this._g.rows.length;\n          if ((i > -1 && i < o ? this._g.rows[i].dataItem : null) != (e.row > -1 && e.row < o ? this._g.rows[e.row].dataItem : null)) {\n            this._commitRowEdits();\n            if (this._g._getHasValidation() && this._g.validateEdits) {\n              var n = !this._g.rows[i] || this._g.rows[i] && Object.getPrototypeOf(this._g.rows[i]) !== Row.prototype ? null : this._g.getEmptyRequiredCell(i);\n              null !== n && setTimeout(function () {\n                t._g.select(new CellRange(i, n));\n                t.startEditing(!0, i, n, !0, e);\n              });\n            }\n          }\n        }\n      } else e.cancel = !0;\n    };\n    _EditHandler._msgRequired = \"\";\n    _EditHandler._msgBadInput = \"\";\n    return _EditHandler;\n  }();\nexport { _EditHandler };\nvar _CustomEditor = function () {\n  function _CustomEditor(e, t) {\n    this._col = asType(e, Column);\n    this._ctl = t;\n    this._tbx = t.hostElement.querySelector(\"input\");\n    assert(this._col instanceof Column, \"Invalid Column\");\n    assert(this._ctl instanceof Control, \"Invalid edit control\");\n    assert(this._tbx instanceof HTMLInputElement, \"Input element not found in editor\");\n    var i = this._ctl;\n    this._prop = isUndefined(i.value) ? isUndefined(i.checkedItems) ? isUndefined(i.text) ? null : \"text\" : \"checkedItems\" : \"value\";\n    assert(null != this._prop, \"value, text properties not found in editor\");\n    var o = softInput();\n    if (o) {\n      this._isDropDown = i instanceof o.DropDown;\n      this._isComboBox = i instanceof o.ComboBox;\n      this._isAutoComplete = i instanceof o.AutoComplete;\n      this._isInputDateTime = i instanceof o.InputDateTime;\n      this._isInputNumber = i instanceof o.InputNumber;\n      this._isInputMask = i instanceof o.InputMask;\n    }\n    this._updateFocusBnd = this._updateFocus.bind(this);\n    this._keydownBnd = this._keydown.bind(this);\n    this._cmpstartBnd = this._cmpstart.bind(this);\n    this._mousedownBnd = this._mousedown.bind(this);\n    this._connect();\n    this._col.gridChanged.addHandler(this._connect, this);\n    this._hideEditor();\n    this._updateFocus();\n  }\n  Object.defineProperty(_CustomEditor.prototype, \"grid\", {\n    get: function () {\n      return this._g;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(_CustomEditor.prototype, \"column\", {\n    get: function () {\n      return this._col;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  Object.defineProperty(_CustomEditor.prototype, \"control\", {\n    get: function () {\n      return this._ctl;\n    },\n    enumerable: !0,\n    configurable: !0\n  });\n  _CustomEditor.prototype.dispose = function () {\n    this._disconnect();\n    this._isDropDown && (this._isDropDown = !1);\n    this._g = this._col = this._ctl = this._tbx = null;\n  };\n  _CustomEditor.prototype._connect = function () {\n    var e = this._col ? this._col.grid : null;\n    if (e != this._g) {\n      this._disconnect();\n      if (e) {\n        var t = e.hostElement,\n          i = e.addEventListener.bind(e),\n          o = this._updateFocusBnd;\n        this._g = e;\n        this._hideEditor();\n        this._updateFocus();\n        i(t, \"keydown\", this._keydownBnd, !0);\n        i(t, \"mousedown\", this._mousedownBnd, !0);\n        i(t, \"mouseup\", o, !0);\n        i(t, \"blur\", o, !0);\n        i(t, \"focus\", o);\n        i(this._tbx, \"compositionstart\", this._cmpstartBnd);\n        e.gotFocus.addHandler(o, this);\n        e.selectionChanged.addHandler(o, this);\n        e.prepareCellForEdit.addHandler(this._prepareCellForEdit, this);\n        e.cellEditEnding.addHandler(this._cellEditEnding, this);\n        e.cellEditEnded.addHandler(this._cellEditEnded, this);\n      }\n    }\n  };\n  _CustomEditor.prototype._disconnect = function () {\n    var e = this._g;\n    if (e) {\n      var t = e.hostElement,\n        i = e.removeEventListener.bind(e),\n        o = this._updateFocusBnd;\n      i(t, \"keydown\", this._keydownBnd);\n      i(t, \"mousedown\", this._mousedownBnd);\n      i(t, \"mouseup\", o);\n      i(t, \"blur\", o);\n      i(t, \"focus\", o);\n      i(this._tbx, \"compositionstart\", this._cmpstartBnd);\n      e.gotFocus.removeHandler(o, this);\n      e.selectionChanged.removeHandler(o, this);\n      e.prepareCellForEdit.removeHandler(this._prepareCellForEdit, this);\n      e.cellEditEnding.removeHandler(this._cellEditEnding, this);\n      e.cellEditEnded.removeHandler(this._cellEditEnded, this);\n      this._g = null;\n    }\n  };\n  _CustomEditor.prototype._prepareCellForEdit = function (e, t) {\n    if (!t.cancel && t.getColumn(!0) == this._col) {\n      var i = this.grid,\n        o = this._ctl,\n        n = this._tbx,\n        l = this._prop,\n        r = t.range,\n        s = t.data,\n        a = s && void 0 !== s.type ? s.type : \"\",\n        u = i.getCellData(r.row, r.col, \"text\" == l || this._isInputMask),\n        c = !1;\n      if (this._isComboBox) {\n        \"\" != u && (o._emptyValueAction = !1);\n        this._isInputDateTime && o._setDropdown(o._ddDate);\n      }\n      this._isInputMask && (o._fullEdit = !0);\n      if (\"checkedItems\" == l) {\n        if (o.showFilterInput) {\n          o.showFilterInput = !1;\n          o.showFilterInput = !0;\n        }\n        if (null == u || 0 == u.length) {\n          o[l] = [];\n          o.selectedIndex = 0;\n        }\n      }\n      if (null != u || !o.isRequired) {\n        if (\"checkedItems\" == l && o.selectedValuePath) {\n          for (var d = [], _loop_1 = function (e) {\n              var t = o.collectionView.items.findIndex(function (t) {\n                return t[o.selectedValuePath] === u[e][o.selectedValuePath];\n              });\n              o._lbx.toggleItemChecked(t);\n              d.push(o.collectionView.items[t]);\n            }, h = 0; h < u.length; h++) _loop_1(h);\n          o[l] = d;\n        } else o[l] = u;\n        if (this._isAutoComplete) {\n          clearTimeout(o._toSearch);\n          if ((f = o.collectionView) && (f.filter || o._rxHighlight)) {\n            o._rxHighlight = null;\n            f.filter = null;\n          }\n          if (u) {\n            var p = o._findNext(u, 1, -1);\n            o.selectedIndex != p && (o.selectedIndex = p);\n          }\n        }\n      }\n      switch (a) {\n        case \"keydown\":\n        case \"mousedown\":\n          if (isUndefined(s.keyCode) || s.keyCode == Key.F4 || s.altKey) {\n            c = this._isDropDown;\n            if (this._isAutoComplete && (null == u || isString(u))) {\n              var f;\n              if (f = o.collectionView) {\n                if (f.filter || o._rxHighlight) {\n                  o._rxHighlight = null;\n                  f.filter = null;\n                }\n                p = u ? o._findNext(u, 1, -1) : -1;\n                o.selectedIndex != p && (o.selectedIndex = p);\n              }\n            }\n          }\n      }\n      i.showPlaceholders && !o.placeholder && (n.placeholder = this._col.header);\n      this._showEditor();\n      i._edtHdl._fullEdit = !0;\n      if (0 == a.indexOf(\"key\") && 32 == s.keyCode) {\n        setSelectionRange(n, n.value.length);\n        s.preventDefault();\n      }\n      if (isIE() && !i.imeEnabled) if (\"keypress\" == a && s.key) {\n        setTimeout(function () {\n          n.value = s.key;\n          setSelectionRange(n, 1);\n          var e = document.createEvent(\"HTMLEvents\");\n          e.initEvent(\"input\", !0, !1);\n          n.dispatchEvent(e);\n        });\n        s.preventDefault();\n      } else if (\"compositionstart\" == a) {\n        var g = n.value.length;\n        setSelectionRange(n, g);\n      }\n      this._isDropDown && (o.isDroppedDown = c);\n    }\n  };\n  _CustomEditor.prototype._cellEditEnding = function (e, t) {\n    if (!t.cancel && t.getColumn(!0) == this._col) {\n      var i = this.grid,\n        o = this._ctl,\n        n = this._prop;\n      if (this._isAutoComplete) {\n        var l = o.selectedIndex;\n        if (isNumber(l) && l < 0) {\n          var r = o.collectionView;\n          r && 1 == r.items.length ? o.selectedIndex = 0 : this._col.isRequired && (t.cancel = !0);\n        }\n      }\n      if (!t.cancel && n) {\n        var s = !1;\n        if (this._isInputMask) {\n          var a = o;\n          if (null != a) {\n            i._edtHdl._setCustomEditorValue(a._msk._applyMask());\n            s = !0;\n          }\n        }\n        s || i._edtHdl._setCustomEditorValue(o[n]);\n      }\n    }\n  };\n  _CustomEditor.prototype._cellEditEnded = function (e, t) {\n    this._hideEditor();\n    this._updateFocus();\n  };\n  _CustomEditor.prototype._cmpstart = function (e) {\n    var t = this;\n    this.grid.imeEnabled && (isIE() ? setTimeout(function () {\n      t._activateEditor(e);\n    }) : this._activateEditor(e));\n  };\n  _CustomEditor.prototype._keydown = function (e) {\n    if (!e.defaultPrevented && this._checkColumn(e.target)) if (this.grid.activeEditor) {\n      if (e.keyCode == Key.Enter && this._isDropDown) {\n        var t = this._ctl;\n        if (t.isDroppedDown) {\n          t.isDroppedDown = !1;\n          e.preventDefault();\n          e.stopImmediatePropagation();\n        }\n      }\n    } else if (this._isDropDown) {\n      var i = e.keyCode;\n      switch (i) {\n        case Key.F4:\n        case Key.Up:\n        case Key.Down:\n          if (i == Key.F4 || e.altKey) {\n            this._activateEditor(e);\n            e.preventDefault();\n          }\n      }\n    }\n  };\n  _CustomEditor.prototype._checkColumn = function (e) {\n    var t = this._g;\n    if (contains(e, this._tbx) || null != e && this._imeEditor() === e) {\n      var i = t._selHdl.selection;\n      return t._getBindingColumn(t.cells, i.row, t.columns[i.col]) == this._col;\n    }\n    return !1;\n  };\n  _CustomEditor.prototype._mousedown = function (e) {\n    if (!e.defaultPrevented && 0 == e.button && !e.shiftKey && !e.ctrlKey && !e.metaKey && this._isDropDown && closestClass(e.target, CellFactory._WJC_DROPDOWN)) {\n      var t = this.grid,\n        i = t.hitTest(e);\n      if (i.getColumn(!0) == this._col) {\n        t.select(i.range);\n        t.refresh();\n        this._activateEditor(e);\n        e.preventDefault();\n      }\n    }\n  };\n  _CustomEditor.prototype._activateEditor = function (e) {\n    var t = this.grid;\n    if (!t.activeEditor) {\n      var i = t._selHdl.selection;\n      if (i.isValid) return t.startEditing(!0, i.row, i.col, !0, e);\n    }\n    return !1;\n  };\n  _CustomEditor.prototype._showEditor = function () {\n    var e = this.grid,\n      t = e.activeEditor,\n      i = closest(t, \".wj-cell\");\n    if (i) {\n      var o = this._tbx,\n        n = this._ctl.hostElement;\n      setCss(n, _CustomEditor._cssVisible);\n      toggleClass(o, \"wj-grid-ime\", !1);\n      i.innerHTML = \"\";\n      i.appendChild(n);\n      e._edtHdl._edt = o;\n      if (this._imeEditor()) this._initImeEditInput();else {\n        o.select();\n        o.focus();\n        t.value = \"\";\n      }\n    }\n  };\n  _CustomEditor.prototype._hideEditor = function () {\n    var e = this.grid,\n      t = this._ctl.hostElement,\n      i = this._tbx;\n    this._isDropDown && (this._ctl.isDroppedDown = !1);\n    i.setCustomValidity(\"\");\n    var o = i.value;\n    i.value = o + \" \";\n    i.value = o;\n    setCss(t, _CustomEditor._cssHidden);\n    toggleClass(i, \"wj-grid-ime\", !0);\n    e && t.parentElement != e._root && e._root.appendChild(t);\n  };\n  _CustomEditor.prototype._resetTabIndex = function () {\n    this._tbx.tabIndex = -1;\n  };\n  _CustomEditor.prototype._updateFocus = function () {\n    var e = this.grid;\n    if (e && !e.activeEditor) {\n      var t = e.hostElement,\n        i = \".wj-flexgrid\",\n        o = this._tbx,\n        n = getActiveElement(),\n        l = e._getTabIndex();\n      if (closest(n, i) == t) if (closest(o, i) != t) this._hideEditor();else if (e.imeEnabled) o.tabIndex > -1 && (o.tabIndex = -1);else {\n        var r = e._selHdl.selection,\n          s = e._getBindingColumn(e.cells, r.row, e.columns[r.col]);\n        if (s && s == this._col && e.canEditCell(r.row, r.col)) {\n          if (n !== o) {\n            e.activeCell && (e.activeCell.tabIndex = -1);\n            o.tabIndex = l;\n            if (!e.isTouching) {\n              o.select();\n              o.focus();\n            }\n          }\n        } else if (o.tabIndex > -1) {\n          o.tabIndex = -1;\n          n == o && e.focus(!0);\n        }\n      }\n    }\n  };\n  _CustomEditor.prototype._initImeEditInput = function () {\n    var e = this,\n      t = this._imeEditor();\n    if (t) {\n      var i = this._tbx,\n        o = i && i.style.color,\n        n = this._ctl,\n        compEndEh_1 = function () {\n          t.removeEventListener(\"compositionend\", compEndEh_1);\n          setCss(t, _ImeHandler._cssHidden);\n          if (i) {\n            i.style.color = o;\n            var gotF = function () {\n              n.gotFocus.removeHandler(gotF);\n              e._g._edtHdl._edt = i;\n              var o = t.value;\n              if (o) {\n                i.value = o;\n                e._isInputMask ? setTimeout(function () {\n                  _CustomEditor._setSelectionRange(i, o.length, o.length);\n                }, 0) : _CustomEditor._setSelectionRange(i, o.length, o.length);\n                var l = document.createEvent(\"HTMLEvents\");\n                l.initEvent(\"input\", !0, !1);\n                i.dispatchEvent(l);\n              }\n            };\n            n.gotFocus.addHandler(gotF);\n            i.focus();\n          }\n        };\n      t.addEventListener(\"compositionend\", compEndEh_1);\n      i && (i.style.color = \"transparent\");\n    }\n  };\n  _CustomEditor._setSelectionRange = function (e, t, i) {\n    void 0 === i && (i = t);\n    if (contains(document.body, e) && !e.disabled && \"none\" != e.style.display) try {\n      e.setSelectionRange(asNumber(t), asNumber(i), isIE() ? null : \"backward\");\n      e.focus();\n    } catch (e) {}\n  };\n  _CustomEditor.prototype._imeEditor = function () {\n    var e = this.grid;\n    if (e && e.imeEnabled) {\n      var t = getActiveElement();\n      if (t && (t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement) && hasClass(t, \"wj-grid-ime\")) return t;\n    }\n    return null;\n  };\n  _CustomEditor._cssHidden = {\n    position: \"fixed\",\n    left: -32e3,\n    top: -32e3,\n    width: \"1px\",\n    height: \"1px\",\n    overflow: \"hidden\",\n    border: \"none\"\n  };\n  _CustomEditor._cssVisible = {\n    position: \"absolute\",\n    left: 0,\n    top: 0,\n    width: \"100%\",\n    height: \"100%\"\n  };\n  return _CustomEditor;\n}();\nexport { _CustomEditor };\nexport var KeyAction;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.MoveDown = 1] = \"MoveDown\";\n  e[e.MoveAcross = 2] = \"MoveAcross\";\n  e[e.Cycle = 3] = \"Cycle\";\n  e[e.CycleOut = 4] = \"CycleOut\";\n  e[e.CycleEditable = 5] = \"CycleEditable\";\n}(KeyAction || (KeyAction = {}));\nvar _KeyboardHandler = function () {\n  function _KeyboardHandler(e) {\n    this._kaTab = KeyAction.None;\n    this._kaEnter = KeyAction.MoveDown;\n    this._g = e;\n    var t = e.hostElement;\n    e.addEventListener(t, \"keypress\", this._keypress.bind(this));\n    e.addEventListener(t, \"keydown\", this._keydown.bind(this));\n  }\n  _KeyboardHandler.prototype._keydown = function (e) {\n    var t = this._g,\n      i = t._edtHdl,\n      o = t.selection,\n      n = e.ctrlKey || e.metaKey,\n      l = e.shiftKey,\n      r = e.altKey,\n      s = e.target,\n      a = e.char || e.key,\n      u = !0;\n    if (!n && !r && a && 1 == a.length && closest(s, \".wj-cell\") && s.firstElementChild && (\" \" != a || !l)) {\n      var c = s.querySelectorAll(\".\" + CellFactory._WJC_RADIOMAP + \" label input\");\n      if (c && c.length) {\n        for (var d = -1, h = 0; h < c.length; h++) if (c[h].checked) {\n          d = h;\n          break;\n        }\n        a = a.toLowerCase();\n        for (h = 0; h < c.length; h++) {\n          var p = c[(d + h + 1) % c.length];\n          if (\" \" == a || p.value.toLowerCase()[0] == a) {\n            p.click();\n            break;\n          }\n        }\n        e.preventDefault();\n        return;\n      }\n    }\n    if (!t._wantsInput(s)) {\n      var f = tryCast(t.rows[o.row], GroupRow),\n        g = t.editableCollectionView,\n        _ = t._getKeyCode(e),\n        m = SelMove,\n        C = SelectionMode,\n        w = e.defaultPrevented && !(s instanceof HTMLInputElement);\n      if ((t.isRangeValid(o) && !w || n && 65 == _) && (!t.activeEditor || !i._keydown(e) || t._isNativeCheckbox(t.activeEditor))) {\n        if (t.autoClipboard) {\n          if (n && (67 == _ || 45 == _)) {\n            var v = new CellRangeEventArgs(t.cells, o);\n            if (t.onCopying(v)) {\n              var y = HeadersVisibility,\n                b = 0 != (t.copyHeaders & y.Column),\n                R = 0 != (t.copyHeaders & y.Row),\n                E = t.getClipString(null, !1, b, R) + \"\\r\\n\";\n              t._eFocus.focus();\n              Clipboard.copy(E);\n              t.onCopied(v);\n            }\n            e.stopPropagation();\n            return;\n          }\n          if (n && 86 == _ || l && 45 == _) {\n            t.isReadOnly || Clipboard.paste(function (e) {\n              t.setClipString(e);\n            });\n            e.stopPropagation();\n            return;\n          }\n        }\n        (l || n) && \"Space\" == e.code && (_ = Key.Space);\n        var x = e.target,\n          S = x.closest(\".wj-cell\"),\n          H = x && S && S[\"wj-cell-index\"] && S[\"wj-cell-index\"].panel,\n          F = [HeadersFocusability.Column, HeadersFocusability.All].includes(t.headersFocusability),\n          M = [HeadersFocusability.Row, HeadersFocusability.All].includes(t.headersFocusability);\n        switch (_) {\n          case Key.Space:\n            if (S && H && [CellType.RowHeader, CellType.TopLeft, CellType.ColumnHeader].includes(H._ct) && M) {\n              var T = t.activePanelType;\n              t.activePanelType = T;\n              var G = S.querySelector(\".wj-cell-check\"),\n                P = G && !G.checked;\n              setTimeout(function () {\n                t.activePanelType = T;\n                S.classList.add(\"wj-focus-header-cell\");\n                t._hideMarquee();\n                S.focus();\n                P && t._activeCell && t._activeCell.classList.add(\"wj-state-multi-selected\");\n              }, 200);\n              t._activeCell = null;\n            } else if (l && o.isValid) switch (t.selectionMode) {\n              case C.CellRange:\n              case C.MultiRange:\n              case C.Row:\n              case C.RowRange:\n              case C.ListBox:\n                t.select(new CellRange(o.row, 0, o.row, t.columns.length - 1), !1);\n            } else if (n && o.isValid) switch (t.selectionMode) {\n              case C.CellRange:\n              case C.MultiRange:\n                t.select(new CellRange(0, o.col, t.rows.length - 1, o.col), !1);\n            } else {\n              (u = this._startEditing(!0, e)) && setTimeout(function () {\n                var e = t.activeEditor;\n                if (e) if (e.disabled || e.readOnly && !closest(e, \".wj-control\")) t.finishEditing();else if (\"checkbox\" == e.type) {\n                  setChecked(e, e.indeterminate || !e.checked);\n                  t.finishEditing();\n                }\n              });\n              u = !0;\n            }\n            break;\n          case 65:\n            if (n) switch (t.selectionMode) {\n              case C.None:\n              case C.Cell:\n                break;\n              default:\n                t.selectAll();\n            } else u = !1;\n            break;\n          case Key.Left:\n            if (S && H && H._ct === CellType.ColumnHeader && F) {\n              e.preventDefault();\n              t._selHdl.moveSelection(SelMove.None, SelMove.Prev, !1);\n            } else if (n || r) u = !1;else if (o.isValid && 0 == o.leftCol && f && !f.isCollapsed && f.hasChildren) f.isCollapsed = !0;else if (M && f && !f.isCollapsed && f.hasChildren) f.isCollapsed = !0;else {\n              if (t.selectionMode == C.None) return;\n              this._moveSel(m.None, n ? m.Home : m.Prev, l);\n            }\n            break;\n          case Key.Right:\n            if (S && H && H._ct === CellType.ColumnHeader && F) {\n              e.preventDefault();\n              t._selHdl.moveSelection(SelMove.None, SelMove.Next, !1);\n            } else if (n || e.altKey) u = !1;else if (o.isValid && 0 == o.leftCol && f && f.isCollapsed) f.isCollapsed = !1;else if (M && f && f.isCollapsed && (!H || H && H._ct === CellType.Cell)) f.isCollapsed = !1;else {\n              if (t.selectionMode == C.None) return;\n              this._moveSel(m.None, n ? m.End : m.Next, l);\n            }\n            break;\n          case Key.Up:\n            if (n) u = !1;else if (e.altKey && i._toggleListBox(e)) u = !0;else {\n              if (t.selectionMode == C.None) return;\n              this._moveSel(m.Prev, m.None, l);\n            }\n            break;\n          case Key.Down:\n            if (n) u = !1;else if (e.altKey && i._toggleListBox(e)) u = !0;else {\n              if (t.selectionMode == C.None) return;\n              this._moveSel(m.Next, m.None, l);\n            }\n            break;\n          case Key.PageUp:\n            this._moveSel(e.altKey ? m.Home : m.PrevPage, m.None, l);\n            if (t.rows.frozen && t.selection.row < t.rows.frozen) {\n              var I = t.scrollPosition;\n              I.y && (t.scrollPosition = new Point(I.x, 0));\n            }\n            break;\n          case Key.PageDown:\n            this._moveSel(e.altKey ? m.End : m.NextPage, m.None, l);\n            break;\n          case Key.Home:\n            this._moveSel(n ? m.Home : m.None, m.Home, l);\n            break;\n          case Key.End:\n            this._moveSel(n ? m.End : m.None, m.End, l);\n            break;\n          case Key.Tab:\n            if (!(u = this._performKeyAction(t.keyActionTab, l)) && !t.activeCell) {\n              t.focus(!0);\n              if (t.imeEnabled) {\n                var A = t._imeHdl;\n                A && A._resetTabIndex();\n              } else {\n                (z = this._getCustomEditor(t, o.row, o.col)) && z._resetTabIndex();\n              }\n            }\n            break;\n          case Key.Enter:\n            if (S && H && H._ct === CellType.ColumnHeader && F) {\n              e.preventDefault();\n              S.click();\n              setTimeout(function () {\n                t.activePanelType = CellType.ColumnHeader;\n                S.classList.add(\"wj-focus-header-cell\");\n                t._hideMarquee();\n                S.focus();\n              }, 30);\n            } else if (S && H && H._ct === CellType.RowHeader && M) {\n              e.preventDefault();\n              t._selHdl.moveSelection(SelMove.Next, SelMove.None, !1);\n            } else {\n              var z;\n              t.rows[o.row] instanceof _NewRowTemplate || (u = this._performKeyAction(t.keyActionEnter, l));\n              (z = this._getCustomEditor(t, o.row, o.col)) || t.focus(!0);\n              !l && g && null != g.currentEditItem && i._commitRowEdits();\n            }\n            break;\n          case Key.Escape:\n            u = !1;\n            if (g && (g.currentAddItem || g.currentEditItem)) {\n              var D = new CellRangeEventArgs(t.cells, t.selection);\n              D.cancel = !0;\n              t.onRowEditEnding(D);\n              g.currentAddItem && g.cancelNew();\n              g.currentEditItem && g.cancelEdit();\n              t.onRowEditEnded(D);\n              u = !0;\n            }\n            t._mouseHdl.resetMouseState();\n            break;\n          case Key.Delete:\n          case Key.Back:\n            u = this._deleteSel(e);\n            break;\n          case Key.F2:\n            u = this._startEditing(!0, e);\n            break;\n          case Key.F4:\n            u = i._toggleListBox(e);\n            break;\n          default:\n            u = !1;\n        }\n        if (u) {\n          t.containsFocus() || t.focus();\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      }\n    }\n  };\n  _KeyboardHandler.prototype._performKeyAction = function (e, t) {\n    var i = KeyAction,\n      o = SelMove;\n    switch (e) {\n      case i.MoveDown:\n        this._moveSel(t ? o.Prev : o.Next, o.None, !1);\n        return !0;\n      case i.MoveAcross:\n        this._moveSel(o.None, t ? o.Prev : o.Next, !1);\n        return !0;\n      case i.Cycle:\n        this._moveSel(o.None, t ? o.PrevCell : o.NextCell, !1);\n        return !0;\n      case i.CycleEditable:\n        this._moveSel(o.None, t ? o.PrevEditableCell : o.NextEditableCell, !1);\n        return !0;\n      case i.CycleOut:\n        var n = this._g.selection;\n        this._moveSel(o.None, t ? o.PrevCell : o.NextCell, !1);\n        return !n.equals(this._g.selection);\n    }\n    return !1;\n  };\n  _KeyboardHandler.prototype._keypress = function (e) {\n    var t = this,\n      i = this._g;\n    if (!i._wantsInput(e.target) && !e.defaultPrevented) {\n      var o = i._edtHdl;\n      if (i.activeEditor) o._keypress(e);else if (e.charCode > Key.Space && \"AltLeft\" != e.code && \"AltRight\" != e.code) if (this._startEditing(!1, e) && i.activeEditor) {\n        var n = getActiveElement();\n        if (n instanceof HTMLInputElement && \"checkbox\" != n.type || n instanceof HTMLTextAreaElement) {\n          var l = i._selHdl.selection,\n            r = i.getCellData(l.row, l.col, !0),\n            s = i.getCellData(l.row, l.col, !1),\n            a = culture.Globalize.numberFormat[\"%\"] || \"%\",\n            u = String.fromCharCode(e.charCode),\n            c = isNumber(s) && r.indexOf(a) > -1 || \"\" == r && n.value == a,\n            d = !0,\n            initEditor_1 = function () {\n              n.value = c ? u + a : u;\n              setSelectionRange(n, 1);\n              n.dispatchEvent(o._evtInput);\n              o._keypress(e);\n              o._edtValue = n.value != r ? n.value : null;\n            };\n          if (i.imeEnabled) {\n            var h = this._getCustomEditor(i, l.row, l.col),\n              p = h && h.control;\n            if (p && !p._focus) {\n              var gotF_1 = function () {\n                p.gotFocus.removeHandler(gotF_1);\n                d = !1;\n                initEditor_1();\n              };\n              p.gotFocus.addHandler(gotF_1);\n            }\n          }\n          d && initEditor_1();\n          e.preventDefault();\n        }\n      } else if (i.autoSearch) {\n        var f = !1;\n        l = i._selHdl.selection;\n        if (e.charCode > 32 || 32 == e.charCode && this._search) {\n          e.preventDefault();\n          this._search += String.fromCharCode(e.charCode);\n          this._toSearch && clearTimeout(this._toSearch);\n          this._toSearch = setTimeout(function () {\n            t._toSearch = null;\n            t._search = \"\";\n          }, Control._SEARCH_DELAY);\n          var g = this._findNext(l.row, l.col);\n          if (g < 0 && this._search.length > 1) {\n            this._search = this._search[this._search.length - 1];\n            g = this._findNext(l.row, l.col);\n          }\n          if (g > -1) {\n            f = !0;\n            i.select(g, l.col);\n          }\n        }\n        f || (this._search = \"\");\n      }\n    }\n  };\n  _KeyboardHandler.prototype._getCustomEditor = function (e, t, i) {\n    var o = e._getBindingColumn(e.cells, t, e.columns[i]);\n    return o && o._edt;\n  };\n  _KeyboardHandler.prototype._findNext = function (e, t) {\n    var i = this._g,\n      o = i.rows.length;\n    (e < 0 || 1 == this._search.length) && e++;\n    var n = this._search,\n      l = i.caseSensitiveSearch;\n    l || (n = n.toLowerCase());\n    for (var r = i.columns[t].isContentHtml, s = 0; s < o; s++) {\n      var a = (e + s) % o,\n        u = i.getCellData(a, t, !0).trim();\n      r && (u = toPlainText(u));\n      l || (u = u.toLowerCase());\n      if (0 == u.indexOf(n)) return a;\n    }\n    return -1;\n  };\n  _KeyboardHandler.prototype._moveSel = function (e, t, i) {\n    var o = this._g,\n      n = o.selectionMode,\n      l = o._selHdl;\n    if (n != SelectionMode.None) {\n      n == SelectionMode.MultiRange && l.extendedSelection.clear();\n      l.moveSelection(e, t, i);\n    }\n  };\n  _KeyboardHandler.prototype._deleteSel = function (e) {\n    var t = this,\n      i = this._g,\n      o = i.rows,\n      n = i.editableCollectionView,\n      l = i.selection,\n      r = [],\n      s = new CellRange(),\n      a = new CellEditEndingEventArgs(i.cells, s, e),\n      u = SelectionMode;\n    if (!i._edtHdl._allowEdit()) return !1;\n    if (i.allowDelete && (null == n || n.canRemove && !n.isAddingNew && !n.isEditingItem) && 0 == (r = o.filter(function (e) {\n      return e.isSelected;\n    })).length) switch (i.selectionMode) {\n      case u.CellRange:\n      case u.MultiRange:\n        var c = i._getDeleteColumnIndex();\n        i.selectedRanges.forEach(function (e) {\n          if (e.leftCol == c && e.rightCol == i.columns.length - 1) for (var t = e.topRow; t > -1 && t <= e.bottomRow; t++) {\n            var n = o[t];\n            r.indexOf(n) < 0 && r.push(n);\n          }\n        });\n        break;\n      case u.Row:\n        l.topRow > -1 && r.push(o[l.topRow]);\n        break;\n      case u.RowRange:\n        for (var d = l.topRow; d > -1 && d <= l.bottomRow; d++) r.push(o[d]);\n    }\n    if (r.length > 0) {\n      var h = 0;\n      i.deferUpdate(function () {\n        n && n.beginUpdate();\n        for (var e = r.length - 1; e >= 0; e--) {\n          var t = r[e];\n          if (!(t instanceof _NewRowTemplate)) {\n            s.setRange(t.index, -1);\n            if (i.onDeletingRow(a)) {\n              n && t.dataItem ? n.remove(t.dataItem) : i.rows.removeAt(t.index);\n              h++;\n              i.onDeletedRow(a);\n            }\n          }\n        }\n        n && n.endUpdate(!1);\n      });\n      if (h > 0) {\n        var p = l.topRow;\n        p = Math.min(p, i.rows.length - 1);\n        for (; p > 0 && i.rows[p] instanceof _NewRowTemplate;) p--;\n        l.row = l.row2 = p;\n        i.select(l, !1);\n        i.childItemsPath && n && n.refresh();\n      }\n      return !0;\n    }\n    if (0 == r.length) {\n      i.deferUpdate(function () {\n        var s = i.scrollPosition,\n          a = -1;\n        r = o.filter(function (e) {\n          return e.isSelected;\n        });\n        var c = i.selectedRanges.length > 1 || r.length > 1 || l.isValid && o[l.row].dataItem != o[l.row2].dataItem;\n        n && n.beginUpdate();\n        if (r.length) {\n          var d = new CellRange(0, 0, 0, i.columns.length - 1);\n          r.forEach(function (i) {\n            d.row = d.row2 = i.index;\n            t._deleteRange(e, d);\n            a = d.bottomRow;\n          });\n        } else {\n          t._deleteRange(e, l);\n          a = l.bottomRow;\n          i.selectionMode == u.MultiRange && i._selHdl.extendedSelection.forEach(function (i) {\n            t._deleteRange(e, i);\n            a = i.bottomRow;\n          });\n        }\n        i.select(l, !1);\n        i.scrollPosition = s;\n        if (n) {\n          if (c && n.currentEditItem) {\n            n.commitEdit();\n            var h = new CellRangeEventArgs(i.cells, new CellRange(a, -1));\n            i.onRowEditEnding(h);\n            i.onRowEditEnded(h);\n          }\n          n.endUpdate(!1);\n        }\n      });\n      return !0;\n    }\n    return !1;\n  };\n  _KeyboardHandler.prototype._deleteRange = function (e, t) {\n    for (var i = this._g, o = i.editableCollectionView, n = new CellRange(), l = new CellEditEndingEventArgs(i.cells, n, e), r = new CellRangeEventArgs(i.cells, new CellRange(t.topRow, -1)), s = t.topRow; s <= t.bottomRow; s++) {\n      var a = i.rows[s];\n      if (!a.isReadOnly) for (var u = t.leftCol; u <= t.rightCol; u++) {\n        var c = i._getBindingColumn(i.cells, s, i.columns[u]);\n        if (!c.getIsRequired(a) && !c.isReadOnly && i.getCellData(s, u, !0)) {\n          n.setRange(s, u);\n          l.cancel = !1;\n          if (i.onBeginningEdit(l)) {\n            var d = a.dataItem,\n              h = o ? o.currentEditItem : null;\n            if (h && d != h && u === t.rightCol) {\n              i.onRowEditEnding(r);\n              i.onRowEditEnded(r);\n            }\n            if (d != h && u === t.leftCol) {\n              r._rng.setRange(s, -1);\n              i.onRowEditStarting(r);\n              i.onRowEditStarted(r);\n            }\n            if (o) {\n              o.editItem(d);\n              i._edtHdl._edItem = d;\n            }\n            i.setCellData(s, u, \"\", !0, !1);\n            i.onCellEditEnding(l);\n            i.onCellEditEnded(l);\n          }\n        }\n      }\n    }\n  };\n  _KeyboardHandler.prototype._startEditing = function (e, t, i, o) {\n    return this._g._edtHdl.startEditing(e, i, o, !0, t);\n  };\n  return _KeyboardHandler;\n}();\nexport { _KeyboardHandler };\nvar _AR_ALLCELLS = 4,\n  _WJC_DRAGSRC = \"wj-state-dragsrc\",\n  _WJC_FLEXGRID = \"wj-flexgrid\";\nexport var AllowResizing;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Columns = 1] = \"Columns\";\n  e[e.Rows = 2] = \"Rows\";\n  e[e.Both = 3] = \"Both\";\n  e[e.ColumnsAllCells = e.Columns | _AR_ALLCELLS] = \"ColumnsAllCells\";\n  e[e.RowsAllCells = e.Rows | _AR_ALLCELLS] = \"RowsAllCells\";\n  e[e.BothAllCells = e.Both | _AR_ALLCELLS] = \"BothAllCells\";\n}(AllowResizing || (AllowResizing = {}));\nexport var AutoSizeMode;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Headers = 1] = \"Headers\";\n  e[e.Cells = 2] = \"Cells\";\n  e[e.Both = 3] = \"Both\";\n}(AutoSizeMode || (AutoSizeMode = {}));\nexport var AllowDragging;\n!function (e) {\n  e[e.None = 0] = \"None\";\n  e[e.Columns = 1] = \"Columns\";\n  e[e.Rows = 2] = \"Rows\";\n  e[e.Both = 3] = \"Both\";\n}(AllowDragging || (AllowDragging = {}));\nvar _MouseHandler = function () {\n  function _MouseHandler(e) {\n    var t = this,\n      i = e.hostElement,\n      o = e.addEventListener.bind(e),\n      n = e.removeEventListener.bind(e);\n    this._g = e;\n    this._dvMarker = createElement('<div class=\"wj-marker\">&nbsp;</div>');\n    o(i, \"mousedown\", function (i) {\n      e._rcBounds = null;\n      if (!i.defaultPrevented && 0 == i.button) {\n        var l = i.target;\n        if (!e.containsFocus()) {\n          var r = l instanceof HTMLElement && l.tabIndex > -1 ? l : e._eFocus;\n          e._setFocusNoScroll(r);\n        }\n        setTimeout(function () {\n          i.defaultPrevented || e.focus();\n        });\n        var s = closestClass(l, _WJC_FLEXGRID);\n        if (s && s != e.hostElement || !e.activeEditor && e._isInputElement(l) && !t._hasRadioMap(i) && !e._isNativeCheckbox(l)) {\n          var a = e.hitTest(i),\n            u = CellType;\n          switch (a.cellType) {\n            case u.Cell:\n              e.select(a.range, !1);\n              l instanceof HTMLElement && \"root\" != l.getAttribute(\"wj-part\") && l.focus();\n              break;\n            case u.ColumnHeader:\n            case u.ColumnFooter:\n              e.scrollIntoView(-1, a.col);\n              break;\n            case u.RowHeader:\n              e.scrollIntoView(a.row, -1);\n          }\n          isIE() && a.cellType != u.Cell && e._isInputElement(l) && l.focus();\n          return;\n        }\n        if (e._isNativeCheckbox(l) && hasClass(l, \"wj-column-selector\") && e.hitTest(i).cellType == CellType.RowHeader) return;\n        var c = document;\n        n(c, \"mousemove\");\n        n(c, \"mouseup\");\n        o(c, \"mousemove\", mouseMove);\n        o(c, \"mouseup\", mouseUp);\n        t._isDown = !0;\n        t._mousedown(i);\n      }\n    });\n    var mouseMove = function (e) {\n        t._mousemove(e);\n      },\n      mouseUp = function (e) {\n        t._isDown = !1;\n        n(document, \"mousemove\");\n        n(document, \"mouseup\");\n        t._mouseup(e);\n      };\n    o(i, \"mouseenter\", function (t) {\n      e._rcBounds = null;\n    });\n    o(i, \"mousemove\", this._hover.bind(this));\n    o(i, \"dblclick\", this._dblclick.bind(this));\n    o(i, \"click\", this._click.bind(this));\n    o(i, \"selectstart\", function (t) {\n      e._isInputElement(t.target) || t.preventDefault();\n    });\n    isSafari() && o(i, \"mousewheel\", function (t) {\n      t.defaultPrevented || !t.wheelDeltaY || t.ctrlKey || t.metaKey || (e._isScrollingByWheel = !0);\n    });\n    o(i, \"wheel\", function (t) {\n      if (!t.defaultPrevented && t.deltaY && !t.ctrlKey && !t.metaKey) {\n        var i = e._root,\n          o = t.deltaY;\n        if ((t.shiftKey ? i.scrollWidth > i.clientWidth : i.scrollHeight > i.clientHeight) && closestClass(t.target, _WJC_FLEXGRID) == e.hostElement) {\n          switch (t.deltaMode) {\n            case 1:\n              o = e.rows.defaultSize * (o < 0 ? -1 : 1);\n              break;\n            case 2:\n              o = (t.shiftKey ? i.clientWidth : i.clientHeight) * (o < 0 ? -1 : 1);\n              break;\n            case 0:\n            default:\n              isSafari() && (o = clamp(o, -150, 150));\n          }\n          e._isScrollingByWheel = !0;\n          e.finishEditing(!1) && (t.shiftKey ? i.scrollLeft += o : i.scrollTop += o);\n          t.preventDefault();\n          t.stopImmediatePropagation();\n        }\n      }\n    });\n    o(i, \"dragstart\", this._dragstart.bind(this));\n    o(i, \"dragover\", this._dragover.bind(this));\n    o(i, \"dragleave\", this._dragleave.bind(this));\n    o(i, \"drop\", this._drop.bind(this));\n    o(i, \"dragend\", this._dragend.bind(this));\n  }\n  _MouseHandler.prototype.resetMouseState = function () {\n    var e = this._g,\n      t = e.hostElement;\n    if (this._updating) {\n      this._updating = !1;\n      e.endUpdate();\n    }\n    this._dragSrc && removeClass(this._dragSrc, _WJC_DRAGSRC);\n    this._showDragMarker(null);\n    t && (t.style.cursor = \"\");\n    isSafari() && this._szRowCol && e.invalidate();\n    e.removeEventListener(document, \"mousemove\");\n    e.removeEventListener(document, \"mouseup\");\n    this._eMouse = null;\n    this._isDown = null;\n    this._htDown = null;\n    this._lbSelState = null;\n    this._lbSelStateRows = {};\n    this._lbSel = null;\n    this._szRowCol = null;\n    this._szArgs = null;\n    e._rcBounds = null;\n    this._anchorCol = -1;\n  };\n  _MouseHandler.prototype._mousedown = function (e) {\n    var t = this._g,\n      i = e.target,\n      o = t.hitTest(e),\n      n = o.cellType,\n      l = CellType,\n      r = e.ctrlKey || e.metaKey;\n    this._selDown = t.selection;\n    this._ignoreClick = !1;\n    if (null == o.panel && null == t.cells || o.panel && t.cells && o.panel._uid == t.cells._uid) {\n      if (closestClass(i, CellFactory._WJC_DROPDOWN)) {\n        var s = t.hitTest(i);\n        t._edtHdl._toggleListBox(e, s.range);\n        e.preventDefault();\n        this._ignoreClick = !0;\n        return;\n      }\n      var a = t.editRange;\n      if (a && a.contains(o.range)) return;\n    }\n    var u = getActiveElement();\n    if (i != u || !t._isInputElement(i)) if (n != l.None) {\n      this._htDown = o;\n      this._eMouse = e;\n      this._anchorCol = o.col;\n      if (null == this._szRowCol) {\n        var c = t.allowResizing,\n          d = AllowResizing;\n        if ((n == l.RowHeader || n == l.TopLeft) && o.edgeBottom && c & d.Rows && this._getResizeRowHt(o)) this._ignoreClick = !0;else if ((n == l.ColumnHeader || n == l.TopLeft) && o.edgeRight && c & d.Columns && this._getResizeColHt(o)) this._ignoreClick = !0;else {\n          var h = t.allowDragging,\n            p = AllowDragging;\n          switch (n) {\n            case l.Cell:\n            case l.RowHeader:\n              if (r && t.selectionMode == SelectionMode.ListBox) {\n                this._lbSelState = t.rows[o.row].isSelected;\n                closest(i, \".wj-elem-collapse\") && (this._lbSelState = !1);\n              }\n              this._mouseSelect(e, e.shiftKey);\n              if (n == l.RowHeader && !(h & p.Rows)) {\n                e.preventDefault();\n                t.focus();\n              }\n              break;\n            case l.ColumnHeader:\n              t.allowSorting || h & p.Columns || closest(i, \"button\") || this._mouseSelect(e, e.shiftKey);\n          }\n        }\n      } else {\n        var f = t._eFocus;\n        if (u != f) {\n          f.tabIndex = 0;\n          f.focus();\n        }\n        this._ignoreClick = !0;\n        this._handleResizing(e);\n      }\n    } else {\n      t.finishEditing();\n      i != t._root && i != t._fCt && t._edtHdl._commitRowEdits();\n    }\n  };\n  _MouseHandler.prototype._mousemove = function (e) {\n    if (this._htDown && !e.defaultPrevented) {\n      if (0 == e.buttons && this._eMouse && e.timeStamp - this._eMouse.timeStamp > 600) {\n        this.resetMouseState();\n        return;\n      }\n      this._eMouse = e;\n      if (this._szRowCol) this._handleResizing(e);else {\n        var t = this._g,\n          i = t.allowDragging,\n          o = AllowDragging,\n          n = CellType;\n        switch (this._htDown.cellType) {\n          case n.Cell:\n            this._mouseSelect(e, !0);\n            break;\n          case n.RowHeader:\n            i & o.Rows || this._mouseSelect(e, !0);\n            break;\n          case n.ColumnHeader:\n            i & o.Columns || t.allowSorting || this._mouseSelect(e, !0);\n        }\n      }\n    }\n  };\n  _MouseHandler.prototype._mouseup = function (e) {\n    var t = this._g;\n    if (!t.isTouching || !(this._dragSrc || e.target instanceof HTMLHtmlElement)) {\n      var i = t.hitTest(e),\n        o = this._htDown;\n      if (o && !e.defaultPrevented) {\n        this._szArgs && this._finishResizing(e);\n        if (!this._szArgs && (null == i.panel && null == o.panel || i.panel && o.panel && i.panel._uid == o.panel._uid) && i.row == o.row && i.col == o.col) {\n          var n = i.getColumn();\n          if (n) {\n            if (!(n._getFlag(RowColFlags.HasTemplate) && !n.cellTemplate)) {\n              var l = i.target;\n              if (l != o.target && l instanceof HTMLElement) {\n                if (o.target instanceof HTMLInputElement) {\n                  var r = i.point,\n                    s = o.point;\n                  Math.abs(r.x - s.x) + Math.abs(r.y - s.y) < 10 && (l = l.querySelector(\"input\") || l);\n                }\n                var a = document.createEvent(\"Event\");\n                a.initEvent(\"click\", !0, !0);\n                for (var u in e) /Key$|X$|Y$|^button|^(x|y|which)$/.test(u) && (a[u] = e[u]);\n                l.dispatchEvent(a);\n              }\n            }\n          }\n        }\n      }\n      this.resetMouseState();\n    }\n  };\n  _MouseHandler.prototype._click = function (e) {\n    if (this._ignoreClick) {\n      this._ignoreClick = !1;\n      e.preventDefault();\n    }\n    if (!e.defaultPrevented) {\n      var t = this._g,\n        i = e.target,\n        o = t.hitTest(i),\n        n = tryCast(i, HTMLInputElement),\n        l = \"input.\" + CellFactory._WJC_CHECKBOX;\n      if (!n) {\n        var r = closest(i, \"label\");\n        r && (n = r.querySelector(l));\n      }\n      !n && t.bigCheckboxes && (n = i.querySelector(l));\n      if (n != t.activeEditor && t._isNativeCheckbox(n)) {\n        if (null == o.panel && null == t.cells || o.panel && t.cells && o.panel._uid == t.cells._uid) {\n          var s = t.getCellData(o.row, o.col, !1);\n          if (t.startEditing(!1, o.row, o.col, !1, e)) {\n            t.activeEditor.checked = !s;\n            t.finishEditing();\n            t.focus();\n          } else \"boolean\" != typeof s && null != s || (n.checked = s);\n        }\n        return;\n      }\n      if (this._hasRadioMap(e)) {\n        this._handleClick(e);\n        return;\n      }\n      var a = e.ctrlKey || e.metaKey;\n      if (t.rows.maxGroupLevel > -1 && closestClass(i, CellFactory._WJC_COLLAPSE)) {\n        var u = t.rows[o.row];\n        if (null == o.panel && null == t.cells || o.panel && t.cells && o.panel._uid == t.cells._uid && u instanceof GroupRow) {\n          a ? t.collapseGroupsToLevel(u.isCollapsed ? u.level + 1 : u.level) : u.isCollapsed = !u.isCollapsed;\n          return;\n        }\n      }\n      if (!a && !e.shiftKey && !t.activeEditor && (null == o.panel && null == t.cells || o.panel && t.cells && o.panel._uid == t.cells._uid)) {\n        var c = t._selHdl.selection;\n        if (c.equals(this._selDown) && o.range.contains(c)) {\n          t.startEditing(!0, null, null, !0, e);\n          return;\n        }\n      }\n      this._handleClick(e);\n    }\n  };\n  _MouseHandler.prototype._handleClick = function (e) {\n    var t = this._g,\n      i = e.target,\n      o = t.hitTest(i),\n      n = e.ctrlKey || e.metaKey,\n      l = o.panel;\n    if (!e.defaultPrevented && o.grid && t && o.grid._uid == t._uid) {\n      if (l && t.cells && l._uid == t.cells._uid && this._hasRadioMap(e)) {\n        var r = closest(i, \"label\"),\n          s = r && r.querySelector(\"input\");\n        s && !s.disabled && t.startEditing(!1, o.row, o.col, !1, e) && t.finishEditing() && (t._edtHdl._edtCanceled ? e.preventDefault() : t.setCellData(o.row, o.col, r.textContent, !0, t.refreshOnEdit));\n        return;\n      }\n      if (!t._isInputElement(i)) {\n        if (l && t.topLeftCells && l._uid == t.topLeftCells._uid) {\n          var a = SelectionMode;\n          switch (t.selectionMode) {\n            case a.None:\n            case a.Cell:\n              break;\n            default:\n              t.selectAll();\n          }\n          return;\n        }\n        if (l && t.columnHeaders && l._uid == t.columnHeaders._uid) {\n          if (t.allowPinning && closestClass(i, CellFactory._WJC_PIN)) this._clickPin(e, o);else if (!t._isTransposed() && closestClass(e.target, CellFactory._WJC_COLLAPSE)) {\n            if (p = t._getColumnGroup(o.row, o.col)) if (n) {\n              for (var u = p.isCollapsed, c = p.level, d = [], h = 0; h < t.columns.length; h++) if ((p = t._getColumnGroup(o.row, h)) && p.collapseTo && p.level == c && d.indexOf(p) < 0) {\n                d.push(p);\n                p.isCollapsed = !u;\n              }\n            } else p.isCollapsed = !p.isCollapsed;\n          } else {\n            i instanceof HTMLSpanElement && i.parentElement instanceof HTMLLabelElement && (i = i.parentElement.querySelector(\"input\"));\n            i instanceof HTMLInputElement || this._clickSort(e, o);\n            t.focus();\n          }\n          return;\n        }\n        if (l && t.rowHeaders && l._uid == t.rowHeaders._uid) {\n          if (t._isTransposed() && closestClass(e.target, CellFactory._WJC_COLLAPSE)) {\n            var p;\n            if (p = t._getColumnGroup(o.row, o.col)) if (n) {\n              u = p.isCollapsed, c = p.level, d = [];\n              for (var f = 0; f < t.rows.length; f++) if ((p = t._getColumnGroup(f, o.col)) && p.collapseTo && p.level == c && d.indexOf(p) < 0) {\n                d.push(p);\n                p.isCollapsed = !u;\n              }\n            } else p.isCollapsed = !p.isCollapsed;\n          }\n          return;\n        }\n        if (l && t.cells && l._uid == t.cells._uid) {\n          if (o.row < 0) {\n            this._clickSort(e, o);\n            return;\n          }\n          if (closestClass(i, CellFactory._WJC_COLLAPSE)) {\n            var g = t.rows[o.row];\n            g instanceof GroupRow && (n ? t.collapseGroupsToLevel(g.isCollapsed ? g.level + 1 : g.level) : g.isCollapsed = !g.isCollapsed);\n            return;\n          }\n          closestClass(i, CellFactory._WJC_DROPDOWN) && t._edtHdl._toggleListBox(e, o.range);\n        }\n      }\n    }\n  };\n  _MouseHandler.prototype._hasRadioMap = function (e) {\n    var t = e.target;\n    if (closest(t, \"label\")) {\n      var i = closestClass(t, CellFactory._WJC_RADIOMAP);\n      return closestClass(i, _WJC_FLEXGRID) == this._g.hostElement;\n    }\n    return !1;\n  };\n  _MouseHandler.prototype._clickSort = function (e, t) {\n    var i = this._g,\n      o = i.allowSorting,\n      n = i.collectionView,\n      l = n ? n.sortDescriptions : null,\n      r = e.ctrlKey || e.metaKey,\n      s = e.shiftKey;\n    if (n && n.canSort && o != AllowSorting.None) {\n      var a = t.panel.columns[t.col],\n        u = i._getBindingColumn(t.panel, t.row, a),\n        c = u ? u._getBindingSort() : null;\n      if (u.allowSorting && c) {\n        if (a && u && a._uid == u._uid) {\n          var d = i.getMergedRange(t.panel, t.row, t.col, !1);\n          if (d && d.columnSpan > 1) return;\n        }\n        var h = new CellRangeEventArgs(t.panel, t.range, e);\n        if (i.onSortingColumn(h)) {\n          i._edtHdl._commitRowEdits();\n          for (var p = -1, f = null, g = 0; g < l.length; g++) if (l[g].property == c) {\n            p = g;\n            f = l[g];\n            break;\n          }\n          l.deferUpdate(function () {\n            if (r && s) l.clear();else if (f) {\n              var e = r;\n              !e && i.isTouching && (e = 0 == f.ascending);\n              e ? l.removeAt(p) : l[p] = new SortDescription(c, !f.ascending);\n            } else {\n              o != AllowSorting.MultiColumn && l.clear();\n              var t = new SortDescription(c, !0);\n              l.push(t);\n            }\n          });\n          i.onSortedColumn(h);\n        }\n      }\n    }\n  };\n  _MouseHandler.prototype._clickPin = function (e, t) {\n    var i = this._g,\n      o = i.columns,\n      n = o.frozen,\n      l = i.allowPinning;\n    l == AllowPinning.Both && (l = e.shiftKey ? AllowPinning.ColumnRange : AllowPinning.SingleColumn);\n    var r = new CellRangeEventArgs(i.cells, t.range);\n    if (i.onPinningColumn(r)) {\n      if (l == AllowPinning.SingleColumn) if (t.col >= n) {\n        o.moveElement(t.col, n, !1);\n        o.frozen++;\n      } else {\n        o.moveElement(t.col, n - 1, !1);\n        o.frozen--;\n      }\n      l == AllowPinning.ColumnRange && (t.col + 1 != n ? o.frozen = t.col + 1 : o.frozen = 0);\n      i.onPinnedColumn(r);\n    }\n  };\n  _MouseHandler.prototype._dblclick = function (e) {\n    if (!e.defaultPrevented) {\n      var t,\n        i = this._g,\n        o = i.hitTest(e),\n        n = e.ctrlKey || e.metaKey,\n        l = o.range,\n        r = o.cellType,\n        s = CellType,\n        a = i.selection,\n        u = i.allowResizing,\n        c = AllowResizing;\n      if (o.edgeRight && u & c.Columns) {\n        if (r == s.TopLeft) {\n          if (o.panel.columns[o.col].allowResizing) {\n            t = new CellRangeEventArgs(o.panel, new CellRange(-1, o.col));\n            if (i.onAutoSizingColumn(t) && i.onResizingColumn(t)) {\n              this._ignoreClick = !0;\n              i.autoSizeColumn(o.col, !0);\n              i.onAutoSizedColumn(t);\n              i.onResizedColumn(t);\n              e.preventDefault();\n            }\n          }\n        } else if (r == s.ColumnHeader || u & _AR_ALLCELLS) {\n          r == s.ColumnHeader && n && a.containsColumn(o.col) && (l = a);\n          for (var d = r == s.RowHeader || r == s.BottomLeft, h = l.leftCol; h <= l.rightCol; h++) if (o.panel.columns[h].allowResizing) {\n            t = new CellRangeEventArgs(o.panel, new CellRange(-1, h));\n            if (i.onAutoSizingColumn(t) && i.onResizingColumn(t)) {\n              this._ignoreClick = !0;\n              i.autoSizeColumn(h, d);\n              i.onResizedColumn(t);\n              i.onAutoSizedColumn(t);\n              e.preventDefault();\n            }\n          }\n        }\n        this.resetMouseState();\n      } else if (o.edgeBottom && u & c.Rows) {\n        if (r == s.TopLeft || r == s.BottomLeft) {\n          if (o.getRow().allowResizing) {\n            d = r == s.TopLeft || null;\n            t = new CellRangeEventArgs(o.panel, new CellRange(o.row, -1));\n            if (i.onAutoSizingRow(t) && i.onResizingRow(t)) {\n              this._ignoreClick = !0;\n              i.autoSizeRow(o.row, d);\n              i.onResizedRow(t);\n              i.onAutoSizedRow(t);\n              e.preventDefault();\n            }\n          }\n        } else if (r == s.RowHeader || u & _AR_ALLCELLS) {\n          var p = o.panel;\n          d = p == i.columnHeaders || p == i.columnFooters && null;\n          n && a.containsRow(o.row) && p && i.cells && p._uid == i.cells._uid && (l = a);\n          for (var f = l.topRow; f <= l.bottomRow; f++) if (p.rows[f].allowResizing) {\n            t = new CellRangeEventArgs(p, new CellRange(f, -1));\n            if (i.onAutoSizingRow(t) && i.onResizingRow(t)) {\n              this._ignoreClick = !0;\n              i.autoSizeRow(f, d);\n              i.onResizedRow(t);\n              i.onAutoSizedRow(t);\n              e.preventDefault();\n            }\n          }\n        }\n        this.resetMouseState();\n      } else ;\n    }\n  };\n  _MouseHandler.prototype._hover = function (e) {\n    if (!this._isDown) {\n      var t = this._g,\n        i = t.hitTest(e),\n        o = \"\";\n      this._szRowCol = this._getResizeColHt(i) || this._getResizeRowHt(i);\n      this._szRowCol instanceof Column ? o = \"col-resize\" : this._szRowCol instanceof Row && (o = \"row-resize\");\n      this._szStart = this._szRowCol ? this._szRowCol.renderSize : 0;\n      t.hostElement.style.cursor = o;\n      return i;\n    }\n    return null;\n  };\n  _MouseHandler.prototype._getResizeColHt = function (e) {\n    var t,\n      i = this._g.allowResizing,\n      o = e.cellType,\n      n = CellType;\n    if (i & AllowResizing.Columns && (o == n.ColumnHeader || o == n.TopLeft || i & _AR_ALLCELLS)) {\n      e.edgeRight && (t = e.getColumn());\n      e.edgeFarRight && (t = this._getResizeCol(e.panel, e.col) || e.getColumn());\n      e.edgeLeft && (t = this._getResizeCol(e.panel, e.col, !0) || t);\n    }\n    return t && t.allowResizing ? t : null;\n  };\n  _MouseHandler.prototype._getResizeRowHt = function (e) {\n    var t,\n      i = this._g.allowResizing,\n      o = AllowResizing,\n      n = e.cellType,\n      l = CellType;\n    if (i & o.Rows && (n == l.RowHeader || n == l.TopLeft || i & _AR_ALLCELLS)) {\n      e.edgeBottom && (t = e.getRow());\n      e.edgeFarBottom && (t = this._getResizeRow(e.panel, e.row) || e.getRow());\n      e.edgeTop && (t = this._getResizeRow(e.panel, e.row, !0) || t);\n    }\n    return t && t.allowResizing ? t : null;\n  };\n  _MouseHandler.prototype._getResizeCol = function (e, t, i) {\n    void 0 === i && (i = !1);\n    var o = this._g,\n      n = e.columns;\n    if (i) {\n      for (var l = t - 1; l >= 0; l--) {\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n      if (n == o.columns && 0 != (o.headersVisibility & HeadersVisibility.Row)) for (l = (n = o.rowHeaders.columns).length - 1; l >= 0; l--) {\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n      return null;\n    }\n    for (l = t + 1; l < n.length; l++) {\n      if ((r = n[l]).isVisible) return this._asResizable(r);\n    }\n    if (t == n.length - 1 && n == o.rowHeaders.columns) {\n      n = o.columns;\n      for (l = 0; l < n.length; l++) {\n        var r;\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n    }\n    return null;\n  };\n  _MouseHandler.prototype._getResizeRow = function (e, t, i) {\n    void 0 === i && (i = !1);\n    var o = this._g,\n      n = e.rows;\n    if (i) {\n      for (var l = t - 1; l >= 0; l--) {\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n      if (n == o.rows && 0 != (o.headersVisibility & HeadersVisibility.Column)) for (l = (n = o.columnHeaders.rows).length - 1; l >= 0; l--) {\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n      return null;\n    }\n    for (l = t + 1; l < n.length; l++) {\n      if ((r = n[l]).isVisible) return this._asResizable(r);\n    }\n    if (t == n.length - 1 && n == o.columnHeaders.rows) {\n      n = o.rows;\n      for (l = 0; l < n.length; l++) {\n        var r;\n        if ((r = n[l]).isVisible) return this._asResizable(r);\n      }\n    }\n    return null;\n  };\n  _MouseHandler.prototype._asResizable = function (e) {\n    return 0 == e.renderSize && e.allowResizing ? e : null;\n  };\n  _MouseHandler.prototype._mouseSelect = function (e, t) {\n    var i = this,\n      o = this._g;\n    if (e && this._htDown && this._htDown.panel && o.selectionMode != SelectionMode.None) {\n      var n = new HitTestInfo(this._htDown.panel, e);\n      this._handleSelection(n, t);\n      !isIE9() && e.button >= 0 && e.target != o._root && ((n = new HitTestInfo(o, e)).panel || setTimeout(function () {\n        i._isDown && i._eMouse && i._mouseSelect(i._eMouse, t);\n      }, 100));\n    }\n  };\n  _MouseHandler.prototype._handleResizing = function (e) {\n    \"mousedown\" == e.type && (isSafari() ? setAttribute(e.target, \"draggable\", null) : e.preventDefault());\n    var t = this._szRowCol,\n      i = CellType;\n    if (t instanceof Column) {\n      var o = this._g,\n        n = mouseToPage(e).x,\n        l = Math.round(Math.max(_MouseHandler._SZ_MIN, this._szStart + (n - this._htDown.point.x) * (o.rightToLeft ? -1 : 1)));\n      if (t.renderSize != l) {\n        if (null == this._szArgs) {\n          var r = o.rowHeaders.columns.indexOf(t) > -1 ? o.rowHeaders : o.cells;\n          this._szArgs = new CellRangeEventArgs(r, new CellRange(-1, t.index));\n        }\n        this._szArgs.cancel = !1;\n        if (o.onResizingColumn(this._szArgs)) if (o.deferResizing) this._showResizeMarker(l);else {\n          var s = o.columns.indexOf(t);\n          if (o.columns.isFrozen(s) && this._htDown.cellType == i.ColumnHeader) {\n            for (var a = 0, u = 0; u < o.columns.frozen; u++) u != s && (a += null == o.columns[u].width ? o.columns[u].renderWidth : o.columns[u].width);\n            o._szClient.width <= a + l && (l = o._szClient.width - a - 5);\n          }\n          t.width = l;\n        }\n      }\n    }\n    var c = this._szRowCol;\n    if (c instanceof Row) {\n      o = this._g;\n      var d = mouseToPage(e).y;\n      l = Math.round(Math.max(_MouseHandler._SZ_MIN, this._szStart + (d - this._htDown.point.y)));\n      if (c.renderSize != l) {\n        if (null == this._szArgs) {\n          r = o.columnHeaders.rows.indexOf(c) > -1 ? o.columnHeaders : o.columnFooters.rows.indexOf(c) > -1 ? o.columnFooters : o.cells;\n          this._szArgs = new CellRangeEventArgs(r, new CellRange(c.index, -1));\n        }\n        this._szArgs.cancel = !1;\n        if (o.onResizingRow(this._szArgs)) if (o.deferResizing) this._showResizeMarker(l);else {\n          var h = o.rows.indexOf(c);\n          if (o.rows.isFrozen(h) && this._htDown.cellType == i.RowHeader) {\n            var p = 0;\n            for (u = 0; u < o.rows.frozen; u++) u != h && (p += null == o.rows[u].height ? o.rows[u].renderHeight : o.rows[u].height);\n            o._szClient.height <= p + l && (l = o._szClient.height - p - 5);\n          }\n          c.height = l;\n        }\n      }\n    }\n    this._szArgs && e.preventDefault();\n  };\n  _MouseHandler.prototype._dragstart = function (e) {\n    var t = this._g,\n      i = this._htDown,\n      o = AllowDragging,\n      n = CellType;\n    if (i) {\n      this._dragSrc = null;\n      this._htDrag = null;\n      this._chldColGrpMarker = !1;\n      if (!this._szRowCol) {\n        var l = new CellRangeEventArgs(i.panel, i.range),\n          r = t.allowDragging,\n          s = i.cellType,\n          a = i.panel.rows,\n          u = i.getColumn(!0);\n        u && u.allowDragging && (s == n.ColumnHeader || s == n.TopLeft) && r & o.Columns && (t.onDraggingColumn(l) ? this._dragSrc = e.target : e.preventDefault());\n        if (!this._dragSrc && i.row > -1 && a[i.row].allowDragging) {\n          var c = a[i.row];\n          c instanceof GroupRow || c instanceof _NewRowTemplate || s == n.RowHeader && r & o.Rows && (t.onDraggingRow(l) ? this._dragSrc = e.target : e.preventDefault());\n        }\n      }\n      if (this._dragSrc && e.dataTransfer && !e.defaultPrevented) {\n        this._htDrag = i;\n        _startDrag(e.dataTransfer, \"move\");\n        e.stopPropagation();\n        addClass(this._dragSrc, _WJC_DRAGSRC);\n        t.beginUpdate();\n        this._updating = !0;\n      }\n    }\n  };\n  _MouseHandler.prototype._dragend = function (e) {\n    this._dragSrc = null;\n    this._htDrag = null;\n    this.resetMouseState();\n  };\n  _MouseHandler.prototype._dragover = function (e) {\n    var t = this._g,\n      i = this._hitTest(e),\n      o = this._dragSrc ? this._htDrag : null,\n      n = CellType,\n      l = !1;\n    if (o && i.cellType == o.cellType) {\n      var r = new CellRangeEventArgs(i.panel, i.range, o);\n      if (i.cellType == n.ColumnHeader && t._hasColumnGroups()) {\n        r.cancel = !t._canMoveColumnGroup(o.row, o.col, i.row, i.col);\n        l = t.onDraggingColumnOver(r);\n      } else if (i.cellType == n.ColumnHeader) {\n        r.cancel = !t.columns.canMoveElement(o.col, i.col);\n        l = t.onDraggingColumnOver(r);\n      } else if (i.cellType == n.RowHeader) {\n        r.cancel = !t.rows.canMoveElement(o.row, i.row);\n        l = t.onDraggingRowOver(r);\n      } else if (i.cellType == n.TopLeft) {\n        r.cancel = !t.topLeftCells.columns.canMoveElement(o.col, i.col);\n        l = t.onDraggingColumnOver(r);\n      }\n    }\n    if (l) {\n      e.dataTransfer.dropEffect = \"move\";\n      e.preventDefault();\n      e.stopPropagation();\n      this._showDragMarker(i);\n    } else this._showDragMarker(null);\n    if (o && t.autoScroll) {\n      var s = t.controlRect,\n        a = t.scrollPosition,\n        u = Control._DRAG_SCROLL_EDGE,\n        c = Control._DRAG_SCROLL_STEP;\n      if (o.panel == t.columnHeaders) {\n        e.pageX - s.left < u && (a.x += c);\n        s.right - e.pageX < u && (a.x -= c);\n      } else if (o.panel == t.rowHeaders) {\n        e.pageY - s.top < u && (a.y += c);\n        s.bottom - e.pageY < u && (a.y -= c);\n      }\n      if (!a.equals(t._ptScrl)) {\n        t.scrollPosition = a;\n        t._rcBounds = null;\n      }\n    }\n  };\n  _MouseHandler.prototype._dragleave = function (e) {\n    this._showDragMarker(null);\n  };\n  _MouseHandler.prototype._drop = function (e) {\n    var t = this._g,\n      i = this._hitTest(e),\n      o = this._dragSrc ? this._htDrag : null,\n      n = CellType;\n    if (o && i.cellType == o.cellType) {\n      var l = t.selection,\n        r = new CellRangeEventArgs(i.panel, i.range, o);\n      if (i.cellType == n.ColumnHeader && t._hasColumnGroups()) {\n        var s = t._getColumnGroup(o.row, o.col).columns.length,\n          a = s > 0 ? s : 1,\n          u = t.columns.frozen;\n        t._moveColumnGroup(o.row, o.col, i.row, i.col, this._chldColGrpMarker);\n        o.col < u && i.col >= u ? t.columns.frozen -= a : o.col >= u && i.col < u && (t.columns.frozen += a);\n        t.select(l.row, i.col);\n        t.onDraggedColumn(r);\n      } else if (i.cellType == n.ColumnHeader) {\n        t.columns.moveElement(o.col, i.col);\n        t.select(l.row, i.col);\n        t.onDraggedColumn(r);\n      } else if (i.cellType == n.RowHeader) {\n        t.rows.moveElement(o.row, i.row);\n        t.select(i.row, l.col);\n        t.onDraggedRow(r);\n      } else if (i.cellType == n.TopLeft) {\n        t.topLeftCells.columns.moveElement(o.col, i.col);\n        t.onDraggedColumn(r);\n      }\n    }\n    this.resetMouseState();\n  };\n  _MouseHandler.prototype._hitTest = function (e) {\n    var t = this._g;\n    t._rcBounds = null;\n    return t.hitTest(e);\n  };\n  _MouseHandler.prototype._showResizeMarker = function (e) {\n    var t,\n      i = this._g,\n      o = i._ptScrl,\n      n = this._szArgs.panel.cellType,\n      l = CellType,\n      r = this._dvMarker,\n      s = i.cells.hostElement;\n    r.parentElement != s && s.appendChild(r);\n    if (this._szRowCol instanceof Column) {\n      t = {\n        left: this._szRowCol.pos + e - 1,\n        top: -1e3,\n        right: \"\",\n        bottom: 0,\n        width: 3,\n        height: \"\"\n      };\n      n != l.TopLeft && n != l.RowHeader || (t.left -= i._eTL.offsetWidth + o.x);\n      n == l.Cell && this._szRowCol.index < i.frozenColumns && (t.left -= o.x);\n      i.rightToLeft && (t.left = s.clientWidth - t.left - t.width);\n    } else {\n      t = {\n        left: -1e3,\n        top: this._szRowCol.pos + e - 1,\n        right: 0,\n        bottom: \"\",\n        width: \"\",\n        height: 3\n      };\n      n != l.TopLeft && n != l.ColumnHeader || (t.top -= i._eTL.offsetHeight + o.y);\n      n == l.Cell && this._szRowCol.index < i.frozenRows && (t.top -= o.y);\n    }\n    setCss(r, t);\n  };\n  _MouseHandler.prototype._showDragMarker = function (e) {\n    var t = this._dvMarker;\n    if (e && e.panel) {\n      if (!e.range.equals(this._rngTarget)) {\n        this._rngTarget = e.range;\n        var i = e.panel.hostElement;\n        t.parentElement != i && i.appendChild(t);\n        var o = this._g,\n          n = o._ptScrl,\n          l = CellType,\n          r = {\n            left: 0,\n            top: 0,\n            width: 6,\n            height: 6,\n            right: \"\",\n            bottom: \"\"\n          };\n        switch (e.cellType) {\n          case l.ColumnHeader:\n            var s = o._getColumnGroup(e.row, e.col);\n            if (s) {\n              var a = s._rng,\n                u = e.panel.rows,\n                c = e.panel.columns;\n              if (s.isEmpty && null === s.binding) {\n                var d = u[a.bottomRow],\n                  h = c[a.leftCol],\n                  p = o.rightToLeft,\n                  f = p ? t.parentElement.clientWidth - e.point.x : e.point.x,\n                  g = Math.max(h.renderWidth / 5, _MouseHandler._SZ_MAX_COLGRP_EDGE),\n                  _ = h.pos + g,\n                  m = h.pos + h.renderWidth - g,\n                  C = this._htDown && e.col > this._htDown.col;\n                if (!C && f > _ || C && f < m) {\n                  r.top = d.pos - r.height / 2 + d.renderHeight;\n                  r.left = p ? t.parentElement.clientWidth - h.pos - h.renderWidth : h.pos;\n                  r.width = h.renderWidth;\n                  this._chldColGrpMarker = !0;\n                  break;\n                }\n              }\n              this._chldColGrpMarker = !1;\n              r.top = 0;\n              r.height = 0;\n              for (var w = 0; w < a.topRow; w++) r.top += u[w].renderHeight;\n              for (w = a.topRow; w <= a.bottomRow; w++) r.height += u[w].renderHeight;\n              r.left = 0;\n              if (this._htDown && e.col > this._htDown.col) {\n                var v = c[a.rightCol];\n                r.left = v.pos - r.width / 2 + v.renderWidth;\n              } else {\n                var y = c[a.leftCol];\n                r.left = y.pos - r.width / 2;\n              }\n              o.rightToLeft && (r.left = t.parentElement.clientWidth - r.left - r.width);\n              break;\n            }\n          case l.TopLeft:\n          case l.ColumnHeader:\n            var b = e.panel.columns[e.col];\n            r.left = b.pos - r.width / 2;\n            r.height = e.panel.height;\n            this._htDown && e.col > this._htDown.col && (r.left += b.renderWidth);\n            e.cellType == l.ColumnHeader && e.col < o.frozenColumns && (r.left -= n.x);\n            o.rightToLeft && (r.left = t.parentElement.clientWidth - r.left - r.width);\n            break;\n          case l.RowHeader:\n            var R = e.getRow();\n            r.top = R.pos - r.height / 2;\n            r.width = e.panel.width;\n            e.row > this._htDown.row && (r.top += R.renderHeight);\n            e.row < o.frozenRows && (r.top -= n.y);\n        }\n        setCss(t, r);\n      }\n    } else {\n      removeChild(t);\n      this._rngTarget = null;\n    }\n  };\n  _MouseHandler.prototype._finishResizing = function (e) {\n    var t = this._g,\n      i = t.selection,\n      o = this._szArgs,\n      n = this._eMouse,\n      l = n && (n.ctrlKey || n.metaKey),\n      r = CellType;\n    if (o && !o.cancel) {\n      if (o.col > -1) {\n        var s = o.col,\n          a = mouseToPage(e).x,\n          u = Math.round(Math.max(_MouseHandler._SZ_MIN, this._szStart + (a - this._htDown.point.x) * (this._g.rightToLeft ? -1 : 1)));\n        if (t.columns.isFrozen(s) && this._htDown.cellType == r.ColumnHeader) {\n          for (var c = 0, d = 0; d < t.columns.frozen; d++) d != s && (c += null == t.columns[d].width ? t.columns[d].renderWidth : t.columns[d].width);\n          t._szClient.width <= c + u && (u = t._szClient.width - c - 5);\n        }\n        o.panel.columns[s].width = Math.round(u);\n        t.onResizedColumn(o);\n        if (l && this._htDown.cellType == r.ColumnHeader && i.containsColumn(s)) {\n          for (var h = t.columns[s].size, p = i.leftCol; p <= i.rightCol; p++) if (t.columns[p].allowResizing && p != s) {\n            o = new CellRangeEventArgs(t.cells, new CellRange(-1, p));\n            if (t.onResizingColumn(o)) {\n              if (t.columns.isFrozen(p)) {\n                c = t.columns[s].size * t.columns.frozen;\n                t._szClient.width <= c && (h = t._szClient.width / t.columns.frozen - 5);\n              }\n              t.columns[p].size = h;\n              t.onResizedColumn(o);\n            }\n          }\n          t.columns.isFrozen(s) && (t.columns[s].size = h);\n        }\n        e.preventDefault();\n      }\n      if (o.row > -1) {\n        var f = o.row,\n          g = mouseToPage(e).y;\n        u = Math.round(Math.max(_MouseHandler._SZ_MIN, this._szStart + (g - this._htDown.point.y)));\n        if (t.rows.isFrozen(f) && this._htDown.cellType == r.RowHeader) {\n          var _ = 0;\n          for (d = 0; d < t.rows.frozen; d++) d != f && (_ += null == t.rows[d].height ? t.rows[d].renderHeight : t.rows[d].height);\n          t._szClient.height <= _ + u && (u = t._szClient.height - _ - 5);\n        }\n        o.getRow().height = Math.round(u);\n        t.onResizedRow(o);\n        if (l && this._htDown.cellType == r.RowHeader && i.containsRow(f)) {\n          for (var m = t.rows[f].size, C = i.topRow; C <= i.bottomRow; C++) if (t.rows[C].allowResizing && C != f) {\n            o = new CellRangeEventArgs(t.cells, new CellRange(C, -1));\n            if (t.onResizingRow(o)) {\n              if (t.rows.isFrozen(C)) {\n                var w = t.rows[f].size * t.rows.frozen;\n                t._szClient.height <= w && (m = t._szClient.height / t.rows.frozen - 5);\n              }\n              t.rows[C].size = m;\n              t.onResizedRow(o);\n            }\n          }\n          t.rows.isFrozen(f) && (t.rows[f].size = m);\n        }\n        t.rows[f].resizedManually = !0;\n        e.preventDefault();\n      }\n    }\n  };\n  _MouseHandler.prototype._handleSelection = function (e, t) {\n    var i = this._g,\n      o = i._selHdl.selection,\n      n = new CellRange(e.row, e.col),\n      l = CellType,\n      r = SelectionMode,\n      s = null,\n      a = e.col >= this._anchorCol;\n    if (n.isValid) if (null == this._lbSelState) {\n      e.cellType != l.ColumnHeader && i._clearAnchorCell();\n      switch (e.cellType) {\n        case l.RowHeader:\n          n.col = 0;\n          n.col2 = i.columns.length - 1;\n          break;\n        case l.ColumnHeader:\n          switch (i.selectionMode) {\n            case r.Row:\n            case r.Cell:\n              n.row = n.row2 = o.row;\n              t = !1;\n              break;\n            default:\n              n.row = 0;\n              n.row2 = i.rows.length - 1;\n              if (null != (s = i._getColumnGroup(e.row, e.col))) {\n                if (i.anchorCursor) {\n                  s._rng.col <= this._anchorCol && this._anchorCol <= s._rng.col2 && (this._anchorCol = s._rng.col2);\n                  i._setAnchorCell(0, this._anchorCol);\n                } else s._rng.col < this._anchorCol && this._anchorCol <= s._rng.col2 && (this._anchorCol = s._rng.col);\n                if (a) {\n                  n.col = s._rng.col2;\n                  n.col2 = s._rng.col;\n                } else {\n                  n.col = s._rng.col;\n                  n.col2 = s._rng.col2;\n                  o.col2 < n.col2 && (o.col2 = n.col2);\n                }\n              }\n          }\n      }\n      if (t) {\n        if (e.cellType == l.ColumnHeader) {\n          i.anchorCursor ? null == i._getAnchorCell() && i.selectionMode != SelectionMode.Row && i.selectionMode != SelectionMode.Cell && i._setAnchorCell(o.row, o.col) : i._clearAnchorCell();\n          n.row2 = o.row2;\n          !a && o.col > o.col2 ? n.col2 = o.col : n.col2 = o.col2;\n          null != s && a && n.col2 > s._rng.col && (n.col2 = s._rng.col);\n        } else if (i.anchorCursor) {\n          n.row = o.row;\n          n.col = o.col;\n        } else {\n          n.row2 = o.row2;\n          n.col2 = o.col2;\n        }\n        if (!n.isValid) {\n          var u = this._htDown;\n          u && (n = new CellRange(u.row, u.col));\n        }\n      }\n      if (i.selectionMode == SelectionMode.MultiRange) {\n        var c = i._mouseHdl._eMouse,\n          d = c && (c.ctrlKey || c.metaKey),\n          h = i._selHdl,\n          p = h.selection,\n          f = h.extendedSelection,\n          g = e.panel != i.cells;\n        closest(c.target, \".wj-elem-collapse\") && (d = !1);\n        if (d) {\n          if (!t && h._deselectRange(n)) h.selection.isValid && (n = null);else if (p.isValid && (g || !p.intersects(n))) {\n            (g ? this._splitRange(p) : [p.clone()]).forEach(function (e) {\n              for (var t = !1, i = 0; i < f.length && !t; i++) f[i].equals(e) && (t = !0);\n              t || f.push(e);\n            });\n          }\n        } else f.clear();\n      }\n      if (n) {\n        i.select(n, !1);\n        switch (e.cellType) {\n          case l.RowHeader:\n            i.scrollIntoView(e.row, -1);\n            break;\n          case l.ColumnHeader:\n            i.scrollIntoView(-1, e.col);\n            break;\n          default:\n            i.scrollIntoView(e.row, e.col);\n        }\n      } else {\n        var _ = new CellRangeEventArgs(i.cells, new CellRange(e.row, e.col));\n        i.onSelectionChanging(_);\n        i.onSelectionChanged(_);\n        i.invalidate();\n      }\n    } else {\n      var m = this._htDown.row,\n        C = e.row,\n        w = this._lbSel;\n      if (m > C) {\n        C = m;\n        m = e.row;\n      }\n      var v = this._lbSelStateRows || {};\n      if (this._lbSel) for (var y = w.row; y <= w.row2; y++) (y < m || y > C) && (i.rows[y].isSelected = v[y]);\n      for (y = m; y <= C; y++) {\n        v.hasOwnProperty(y) || (v[y] = i.rows[y].isSelected);\n        i.rows[y].isSelected = !this._lbSelState;\n      }\n      this._lbSel = new CellRange(m, 0, C, 0);\n      i.scrollIntoView(e.row, e.col);\n    }\n  };\n  _MouseHandler.prototype._splitRange = function (e) {\n    var t = this._g,\n      i = t.columns.length,\n      o = t.rows.length,\n      n = [];\n    if (e.columnSpan == i) for (var l = e.topRow; l <= e.bottomRow; l++) n.push(new CellRange(l, 0, l, i - 1));else if (e.rowSpan == o) for (var r = e.leftCol; r <= e.rightCol; r++) n.push(new CellRange(0, r, o - 1, r));else n.push(e.clone());\n    return n;\n  };\n  _MouseHandler._SZ_MIN = 0;\n  _MouseHandler._SZ_MAX_COLGRP_EDGE = 50;\n  return _MouseHandler;\n}();\nexport { _MouseHandler };\n_registerModule(\"wijmo.grid\", selfModule);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}